<%
// Define Navigation Structure
const navMap = [
    {
        id: 'intro',
        label: 'Introduction',
        isFolder: false,
        href: '/',
        showInUser: true
    },
    {
        id: 'imd',
        label: 'Indoor Map Digitalizer',
        isFolder: true,
        showInUser: false,
        children: [
            { label: 'Overview', href: '/imd/overview' },
            { label: 'Quickstart', href: '/imd/quickstart' }
        ]
    },
    {
        id: 'server',
        label: 'Server',
        isFolder: true,
        showInUser: false,
        children: [
            { label: 'Overview', href: '/server/overview' },
            { label: 'Quickstart', href: '/server/quickstart' },
            {
                label: 'Security',
                isFolder: true, // Level 2 nesting
                children: [
                    { label: 'Session Settings', href: '/server/session' },
                    { label: 'Password', href: '/server/password' }
                ]
            }
        ]
    },
    {
        id: 'app',
        label: 'User App',
        isFolder: true,
        showInUser: true,
        children: [
            { label: 'Overview', href: '/app/overview' },
            { label: 'Quickstart', href: '/app/quickstart' }
        ]
    }
];

// Recursive helper to draw links
function drawNav(items) {
items.forEach(item => {
    // Filter based on sidebarType
    if (sidebarType === 'user' && !item.showInUser && !item.showAlways) return;

    // Helper to check active state (simple string matching)
    const isActive = currentPath === item.href;

if (item.isFolder && item.children) { %>
    <div class="nav-group">
        <div class="nav-group-title"><%= item.label %></div>
        <div class="nav-children">
            <% drawNav(item.children); %>
        </div>
    </div>
<% } else { %>
    <!-- Adjust href relative to baseRoute logic if needed, or assume absolute paths from navMap -->
    <a href="<%= baseRoute %><%= item.href === '/' ? '' : item.href %>"
       class="nav-link <%= isActive ? 'active' : '' %>"
       data-i18n="<%= item.i18nKey || '' %>">
    >
        <%= item.label %>
    </a>
<% }
});
}
%>

<nav class="sidebar-left">
    <% drawNav(navMap); %>
</nav>
import{s as k,b as ot,c as K}from"./index-COThXori.js";const B=150,F=50,Y=4;function st(m,S,g,t,p,j){const b="http://www.w3.org/2000/svg",x=m.slice(0,m.length-1),c=m.map(o=>`${o[0]+F},${o[1]+B}`).join(" "),s=document.createElementNS(b,"polygon");s.setAttribute("points",c),s.setAttribute("fill",j),s.setAttribute("stroke",g),s.setAttribute("stroke-width",String(Y)),S.appendChild(s);const A=[];for(let o=0;o<x.length;o++){const i=x[o],h=x[(o+1)%x.length],L=[i[0]+F,i[1]+B],$=[h[0]+F,h[1]+B],M=[i,h,$,L].map(H=>H.join(",")).join(" "),_=(i[1]+h[1])/2<3e3;A.push({wallPoints:M,isBackWall:_})}A.sort((o,i)=>o.isBackWall===i.isBackWall?0:o.isBackWall?-1:1),A.forEach(({wallPoints:o})=>{const i=document.createElementNS(b,"polygon");i.setAttribute("points",o),i.setAttribute("fill",p),i.setAttribute("stroke",g),i.setAttribute("stroke-width",String(Y)),S.appendChild(i)});const d=m.map(o=>o.join(",")).join(" "),f=document.createElementNS(b,"polygon");f.setAttribute("points",d),f.setAttribute("fill",t),f.setAttribute("stroke",g),f.setAttribute("stroke-width",String(Y)),S.appendChild(f)}function it(m,S,g,t){const p="http://www.w3.org/2000/svg",j=m.map(s=>`${s[0]+F},${s[1]+B}`).join(" "),b=document.createElementNS(p,"polyline");b.setAttribute("points",j),b.setAttribute("fill","none"),b.setAttribute("stroke",t),b.setAttribute("stroke-width","2"),b.setAttribute("stroke-opacity","0.5"),S.appendChild(b);for(let s=0;s<m.length-1;s++){const A=m[s],d=m[s+1],f=[A[0]+F,A[1]+B],o=[d[0]+F,d[1]+B],i=[A,d,o,f].map(L=>L.join(",")).join(" "),h=document.createElementNS(p,"polygon");h.setAttribute("points",i),h.setAttribute("fill",t),h.setAttribute("stroke",g),h.setAttribute("stroke-width","1"),S.appendChild(h)}const x=m.map(s=>s.join(",")).join(" "),c=document.createElementNS(p,"polyline");c.setAttribute("points",x),c.setAttribute("fill","none"),c.setAttribute("stroke",g),c.setAttribute("stroke-width",String(Y)),c.setAttribute("stroke-linecap","round"),S.appendChild(c)}function at(m,S){const g=document.getElementById(S);if(!g){console.error(`Container mit der ID "${S}" nicht gefunden.`);return}g.innerHTML="";const t="http://www.w3.org/2000/svg",p=document.createElementNS(t,"svg");p.setAttribute("width","100%"),p.setAttribute("height","100%"),p.setAttribute("viewBox","-500 -500 4000 4000");const j=getComputedStyle(document.body).getPropertyValue("--color-surface").trim()||"#ffffff",b=getComputedStyle(document.body).getPropertyValue("--color-secondary").trim()||"#f6ebfc",x=document.createElementNS(t,"defs"),c=document.createElementNS(t,"linearGradient");c.id="bgGrad",c.setAttribute("x1","0"),c.setAttribute("y1","0"),c.setAttribute("x2","0"),c.setAttribute("y2","1");const s=document.createElementNS(t,"stop");s.setAttribute("offset","0%"),s.setAttribute("stop-color",b);const A=document.createElementNS(t,"stop");A.setAttribute("offset","100%"),A.setAttribute("stop-color",j),c.appendChild(s),c.appendChild(A);const d=document.createElementNS(t,"filter");d.id="softShadow",d.setAttribute("x","-20%"),d.setAttribute("y","-20%"),d.setAttribute("width","140%"),d.setAttribute("height","140%");const f=document.createElementNS(t,"feGaussianBlur");f.setAttribute("in","SourceAlpha"),f.setAttribute("stdDeviation","6");const o=document.createElementNS(t,"feOffset");o.setAttribute("dx","6"),o.setAttribute("dy","6"),o.setAttribute("result","offsetblur");const i=document.createElementNS(t,"feMerge"),h=document.createElementNS(t,"feMergeNode"),L=document.createElementNS(t,"feMergeNode");L.setAttribute("in","SourceGraphic"),i.appendChild(h),i.appendChild(L),d.appendChild(f),d.appendChild(o),d.appendChild(i),x.appendChild(c),x.appendChild(d),p.appendChild(x);const $=document.createElementNS(t,"rect");$.setAttribute("x","-500"),$.setAttribute("y","-500"),$.setAttribute("width","4000"),$.setAttribute("height","4000"),$.setAttribute("fill","url(#bgGrad)"),p.appendChild($);const M=document.createElementNS(t,"g");M.id="interactive-3d-group",M.setAttribute("transform",`translate(${k.threeDPan.x}, ${k.threeDPan.y}) scale(${k.threeDScale})`),M.setAttribute("filter","url(#softShadow)"),p.appendChild(M);const _=ot(),H=m.features.filter(n=>n.properties.floor===k.activeFloorId&&["Polygon","LineString","Point"].includes(n.geometry.type)&&!n.properties.isPlaceholder);if(H.length===0){g.appendChild(p);return}let w=1/0,C=1/0,v=-1/0,I=-1/0;H.forEach(n=>{if(n.geometry.type==="Polygon"){const e=K(n.geometry);w=Math.min(w,e.x),C=Math.min(C,e.y),v=Math.max(v,e.x+e.width),I=Math.max(I,e.y+e.height)}else if(n.geometry.type==="LineString")n.geometry.coordinates.forEach(r=>{w=Math.min(w,r[0]),C=Math.min(C,r[1]),v=Math.max(v,r[0]),I=Math.max(I,r[1])});else if(n.geometry.type==="Point"){const e=n.geometry.coordinates;w=Math.min(w,e[0]),C=Math.min(C,e[1]),v=Math.max(v,e[0]),I=Math.max(I,e[1])}}),(!isFinite(w)||!isFinite(C))&&(w=0,C=0,v=1e3,I=1e3);const R=Math.max(1,v-w),O=Math.max(1,I-C),q=Math.max(.2,Math.min(3,Math.min(3600/R,3600/O))),J=1500,Q=1500,U=w+R/2,Z=C+O/2,tt=J-U,et=Q-Z;k.threeDPan={x:tt,y:et},k.threeDScale=q,M.setAttribute("transform",`translate(${k.threeDPan.x}, ${k.threeDPan.y}) scale(${k.threeDScale})`);const E=document.createElementNS(t,"g");E.setAttribute("transform","translate(0, 0)");function G(n,e){const r=n.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(r){const N=parseInt(r[1],10),D=parseInt(r[2],10),P=parseInt(r[3],10);return`rgba(${N}, ${D}, ${P}, ${e})`}const u=n.trim();if(/^#([\da-f]{6})$/i.test(u)){const N=parseInt(u.slice(1,3),16),D=parseInt(u.slice(3,5),16),P=parseInt(u.slice(5,7),16);return`rgba(${N}, ${D}, ${P}, ${e})`}return`rgba(0,0,0,${e})`}H.forEach(n=>{const e=_[n.properties.subType]||_.default,r=e.stroke||"#54176e";if(n.geometry.type==="Polygon"){const u=n.geometry,N=e.fill?G(e.fill,.45):"rgba(53,138,216,0.35)",D=G(r,.25),P=G(r,.12);st(u.coordinates[0],E,r,N,D,P);const T=document.createElementNS(t,"polygon"),W=u.coordinates[0].map(a=>`${a[0]+F+15},${a[1]+B+15}`).join(" ");T.setAttribute("points",W),T.setAttribute("fill","rgba(0,0,0,0.06)"),T.setAttribute("stroke","none"),E.appendChild(T);const y=n.properties.label;if(y){const a=K(u),z=a.x+a.width/2,X=a.y+a.height/2,l=document.createElementNS(t,"text");l.setAttribute("x",String(z)),l.setAttribute("y",String(X)),l.setAttribute("text-anchor","middle"),l.setAttribute("dominant-baseline","middle");const V=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333";l.setAttribute("fill",V),l.setAttribute("stroke",k.activeTheme==="dark"?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.7)"),l.setAttribute("stroke-width","1.5");const nt=e.fontSize?Math.max(12,e.fontSize*2):24;l.setAttribute("style",`font-weight:bold; font-size:${nt}px;`),l.textContent=y,E.appendChild(l)}}else if(n.geometry.type==="LineString"){const u=n.geometry.coordinates,N=G(r,.3);it(u,E,r,N)}else if(n.geometry.type==="Point"){const u=n.geometry.coordinates,N=u[0]+F,D=u[1]+B,P=u[0],T=u[1],W=document.createElementNS(t,"ellipse");W.setAttribute("cx",String(N)),W.setAttribute("cy",String(D)),W.setAttribute("rx","15"),W.setAttribute("ry","8"),W.setAttribute("fill","rgba(0,0,0,0.2)"),E.appendChild(W);const y=document.createElementNS(t,"line");y.setAttribute("x1",String(N)),y.setAttribute("y1",String(D)),y.setAttribute("x2",String(P)),y.setAttribute("y2",String(T)),y.setAttribute("stroke",r),y.setAttribute("stroke-width","2"),y.setAttribute("stroke-dasharray","4,2"),E.appendChild(y);const a=document.createElementNS(t,"circle");a.setAttribute("cx",String(P)),a.setAttribute("cy",String(T)),a.setAttribute("r","20");const z=e.fill?G(e.fill,.9):r;a.setAttribute("fill",z),a.setAttribute("stroke",r),a.setAttribute("stroke-width","3"),a.style.cursor="pointer",E.appendChild(a);const X=n.properties.label;if(X){const l=document.createElementNS(t,"text");l.setAttribute("x",String(P)),l.setAttribute("y",String(T-35)),l.setAttribute("text-anchor","middle");const V=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333";l.setAttribute("fill",V),l.setAttribute("style","font-weight:bold; font-size:20px; text-shadow: 0px 0px 4px rgba(255,255,255,0.8);"),l.textContent=X,E.appendChild(l)}}}),M.appendChild(E),g.appendChild(p)}export{at as render3DFloorStack};

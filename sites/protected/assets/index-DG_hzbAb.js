const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/3d-_d8bCFHN.js","assets/floor3D-hyBvWXzO.js"])))=>i.map(i=>d[i]);
(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();const Qo="modulepreload",er=function(t){return"/"+t},In={},vt=function(o,n,r){let l=Promise.resolve();if(n&&n.length>0){let m=function(p){return Promise.all(p.map(v=>Promise.resolve(v).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");l=m(n.map(p=>{if(p=er(p),p in In)return;In[p]=!0;const v=p.endsWith(".css"),g=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${g}`))return;const b=document.createElement("link");if(b.rel=v?"stylesheet":Qo,v||(b.as="script"),b.crossOrigin="",b.href=p,a&&b.setAttribute("nonce",a),document.head.appendChild(b),v)return new Promise((c,d)=>{b.addEventListener("load",c),b.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${p}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return l.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return o().catch(i)})},Y={raum:{fill:"rgba(53, 138, 216, 0.4)",stroke:"#5e5bb1"},buero:{fill:"rgba(141, 35, 166, 0.3)",stroke:"#54176e"},toiletten:{fill:"rgba(236, 240, 241, 0.5)",stroke:"#c0392b"},gang:{fill:"rgba(246, 235, 252, 0.2)",stroke:"#bdc3c7"},lager:{fill:"rgba(255, 255, 255, 0.3)",stroke:"#7f8c8d"},default:{fill:"rgba(189, 195, 199, 0.3)",stroke:"#95a5a6"}},H="#358ad8",Xe={eingang:"M12 3L4 9v12h5v-7h6v7h5V9l-8-6zm-2 14H8v-5h2v5zm4 0h-2v-5h2v5z",feuerloescher:"M12 2c-3.31 0-6 2.69-6 6v10c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V8c0-3.31-2.69-6-6-6zm0 2c2.21 0 4 1.79 4 4h-8c0-2.21 1.79-4 4-4zm-1 6h2v6h-2z",treppe:"M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 14h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z",aufzug:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12.5L7.5 12H9V8h6v4h1.5L13 15.5V17h-2v-1.5z",beacon:"M12 2C7.03 2 3 6.03 3 11c0 6.08 9 11 9 11s9-4.92 9-11c0-4.97-4.03-9-9-9zm0 5c2.21 0 4 1.79 4 4 0 .73-.2 1.41-.55 2l-1.45-1.45c.26-.41.4-.9.4-1.41 0-1.38-1.12-2.5-2.5-2.5S9.5 8.62 9.5 10c0 .51.14 1 .4 1.41L8.45 12.86C8.2 12.41 8 11.73 8 11c0-2.21 1.79-4 4-4zm0 8l4 4-4 4-4-4 4-4z",default:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"},xt={info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z",warning:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z","meeting-point":"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z",coffee:"M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.9 2-2V5c0-1.11-.89-2-2-2zm-2 5h-2V5h2v3zM4 19h16v2H4z",printer:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zM18 3H6v4h12V3z",restroom:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"};function Q(t){if(!e.isGridVisible||!e.isSnapEnabled)return t;const o=e.gridSize;return{x:Math.round(t.x/o)*o,y:Math.round(t.y/o)*o}}function dt(t){const o=10/e.scale,n=e.project.features.filter(l=>l.properties.floor===e.activeFloorId&&!l.properties.isPlaceholder);let r=null;for(const l of n)if(l.geometry.type==="Point"||l.properties.type==="connector"){const[i,s]=l.geometry.coordinates,a=Math.hypot(t.x-i,t.y-s);a<o&&(!r||a<r.d)&&(r={x:i,y:s,d:a})}else if(l.geometry.type==="LineString"){const i=l.geometry.coordinates;for(const s of i){const a=s[0],m=s[1],p=Math.hypot(t.x-a,t.y-m);p<o&&(!r||p<r.d)&&(r={x:a,y:m,d:p})}}return r?{x:r.x,y:r.y}:t}function mo(t){const o=t.coordinates[0];let[n,r]=o[0],[l,i]=o[0];for(const[s,a]of o)s<n&&(n=s),a<r&&(r=a),s>l&&(l=s),a>i&&(i=a);return{x:n,y:r,width:l-n,height:i-r}}function J(t,o){const n=mo(o);if(t.x<n.x||t.x>n.x+n.width||t.y<n.y||t.y>n.y+n.height)return!1;let r=!1;const l=o.coordinates[0];for(let i=0,s=l.length-1;i<l.length;s=i++){const[a,m]=l[i],[p,v]=l[s];m>t.y!=v>t.y&&t.x<(p-a)*(t.y-m)/(v-m)+a&&(r=!r)}return r}function nn(t,o,n){return{x:2*n.x-.5*(t.x+o.x),y:2*n.y-.5*(t.y+o.y)}}function De(t,o,n,r=20){const l=[];for(let i=0;i<=r;i++){const s=i/r,a=Math.pow(1-s,2)*t.x+2*(1-s)*s*n.x+Math.pow(s,2)*o.x,m=Math.pow(1-s,2)*t.y+2*(1-s)*s*n.y+Math.pow(s,2)*o.y;l.push([a,m])}return l}function Sn(t,o){let n=1/0,r=-1;const l=16/e.scale,i=o.coordinates[0];for(let s=0;s<i.length-1;s++){const a={x:i[s][0],y:i[s][1]},m={x:i[s+1][0],y:i[s+1][1]},p=m.x-a.x,v=m.y-a.y;if(p===0&&v===0)continue;const g=((t.x-a.x)*p+(t.y-a.y)*v)/(p*p+v*v),b=g<0?a:g>1?m:{x:a.x+g*p,y:a.y+g*v},c=Math.sqrt((t.x-b.x)**2+(t.y-b.y)**2);c<n&&(n=c,r=s)}return n<l?{index:r,distance:n}:{index:-1,distance:1/0}}function on(t,o,n,r){const l=o.x-t.x,i=o.y-t.y,s=r.x-n.x,a=r.y-n.y,m=l*a-i*s;if(m===0)return null;const p=((n.x-t.x)*a-(n.y-t.y)*s)/m,v=((n.x-t.x)*i-(n.y-t.y)*l)/m;return p<0||p>1||v<0||v>1?null:{x:t.x+p*l,y:t.y+p*i}}let q,f,ye,j,ge,_;function tr(){q=document.getElementById("canvas"),f=q.getContext("2d"),ye=document.getElementById("ruler-top"),j=ye.getContext("2d"),ge=document.getElementById("ruler-left"),_=ge.getContext("2d")}function M(){if(!(!f||!q.parentElement)){if(q.width=q.parentElement.clientWidth,q.height=q.parentElement.clientHeight,ye.width=q.width,ge.height=q.height,nr(),f.save(),f.translate(e.pan.x,e.pan.y),f.scale(e.scale,e.scale),e.activeFloorId){const t=e.cachedFloorPlanImages[e.activeFloorId];t&&f.drawImage(t,0,0),e.isGridVisible&&or(),e.project.features.filter(n=>n.properties.floor===e.activeFloorId&&e.visibleLayers[n.properties.type]).forEach(n=>{const r=e.selectedFeatureIds.includes(n.properties.id);switch(f.lineWidth=(r?3:2)/e.scale,n.geometry.type){case"Polygon":rr(n,r);break;case"Point":ir(n,r);break;case"LineString":sr(n,r);break}})}e.tempShape&&(e.currentMode==="area"&&cr(),e.currentMode==="square"&&dr(),e.currentMode==="line"&&pr(),e.currentMode==="polygon"&&ur(),e.currentMode==="arc"&&mr(),e.currentMode==="circle"&&yr()),e.showBeaconHeatmap&&ar(),f.restore(),e.isShiftPressed&&gr()}}function yo(t){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);return o?{r:parseInt(o[1]),g:parseInt(o[2]),b:parseInt(o[3]),a:o[4]!==void 0?parseFloat(o[4]):1}:null}function go(t,o,n,r){if(n)return H;if(r)return r;const l=t?yo(t):null,s=(l&&l.a>.4?t:o??(e.activeTheme==="dark"?"#e6e1ef":"#333333")).match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(s){const a=parseInt(s[1]),m=parseInt(s[2]),p=parseInt(s[3]),v=(.299*a+.587*m+.114*p)/255,g=.5;return e.activeTheme==="dark"?v<g?"#e6e1ef":"#333333":v>g?"#333333":"#e6e1ef"}return e.activeTheme==="dark"?"#e6e1ef":"#333333"}function nr(){const t=getComputedStyle(document.body).getPropertyValue("--ruler-text").trim(),o=getComputedStyle(document.body).getPropertyValue("--ruler-border").trim(),n=getComputedStyle(document.body).getPropertyValue("--crosshair-color").trim()||"rgba(53, 138, 216, 0.9)";j.clearRect(0,0,ye.width,ye.height),_.clearRect(0,0,ge.width,ge.height),j.font="12px sans-serif",_.font="12px sans-serif",j.fillStyle=t,_.fillStyle=t,j.strokeStyle=o,_.strokeStyle=o;const{scale:r,pan:l}=e,i=r>1.5?50:r<.4?200:100;for(let m=0;m<ye.width;m+=10){const p=(m-l.x)/r;j.beginPath(),j.moveTo(m+.5,25),j.lineTo(m+.5,30),j.stroke(),Math.round(p)%i===0&&(j.beginPath(),j.moveTo(m+.5,22),j.lineTo(m+.5,30),j.stroke(),j.fillText(String(Math.round(p)),m+2,14))}for(let m=0;m<ge.height;m+=10){const p=(m-l.y)/r;_.beginPath(),_.moveTo(25,m+.5),_.lineTo(30,m+.5),_.stroke(),Math.round(p)%i===0&&(_.beginPath(),_.moveTo(22,m+.5),_.lineTo(30,m+.5),_.stroke(),_.fillText(String(Math.round(p)),2,m+12))}const{x:s,y:a}=e.mousePosScreen;j.fillStyle=n,_.fillStyle=n,j.beginPath(),j.moveTo(s,0),j.lineTo(s-3,5),j.lineTo(s+3,5),j.closePath(),j.fill(),_.beginPath(),_.moveTo(0,a),_.lineTo(5,a-3),_.lineTo(5,a+3),_.closePath(),_.fill()}function or(){const{scale:t,pan:o,gridSize:n}=e,r=e.activeTheme==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",l=e.activeTheme==="dark"?"rgba(255, 255, 255, 0.15)":"rgba(0, 0, 0, 0.15)";f.lineWidth=1/t;const i=-o.x/t,s=-o.y/t,a=(q.width-o.x)/t,m=(q.height-o.y)/t;let p=n;const v=40;for(;p*t<v;)p*=2;for(;p*t>v*2;)p/=2;const g=p,b=g/4;if(b*t>10){f.strokeStyle=r;const h=Math.floor(i/b)*b,x=Math.floor(s/b)*b;for(let I=h;I<a;I+=b)f.beginPath(),f.moveTo(I,s),f.lineTo(I,m),f.stroke();for(let I=x;I<m;I+=b)f.beginPath(),f.moveTo(i,I),f.lineTo(a,I),f.stroke()}f.strokeStyle=l,f.lineWidth=1.5/t;const c=Math.floor(i/g)*g,d=Math.floor(s/g)*g;for(let h=c;h<a;h+=g)f.beginPath(),f.moveTo(h,s),f.lineTo(h,m),f.stroke();for(let h=d;h<m;h+=g)f.beginPath(),f.moveTo(i,h),f.lineTo(a,h),f.stroke()}function rr(t,o){if(t.properties.isPlaceholder)return;const{subType:n,label:r}=t.properties,i=(e.styleOverrides||K())[n];let s=Y.default.fill,a=Y.default.stroke,p=t.properties.fontSize||i?.fontSize||14,v=t.properties.fontColor||i?.fontColor;i&&i.baseType==="area"&&(s=i.fill||s,a=i.stroke||a);const g=t.geometry.coordinates[0];f.fillStyle=s,f.strokeStyle=o?H:a,f.lineWidth=(o?3:2)/e.scale,f.beginPath(),f.moveTo(g[0][0],g[0][1]);for(let b=1;b<g.length;b++)f.lineTo(g[b][0],g[b][1]);if(f.closePath(),f.fill(),f.stroke(),r){const b=mo(t.geometry);f.fillStyle=go(s,a,o,v),f.font=`bold ${p/e.scale}px sans-serif`,f.textAlign="center",f.textBaseline="middle",f.fillText(r,b.x+b.width/2,b.y+b.height/2)}if(o){const b=5/e.scale;if((e.isAltPressed||e.currentMode==="scissors")&&e.hoveredFeatureId===t.properties.id&&e.hoveredEdgeIndex!==-1){const c=g[e.hoveredEdgeIndex],d=g[(e.hoveredEdgeIndex+1)%(g.length-1)];f.beginPath(),f.moveTo(c[0],c[1]),f.lineTo(d[0],d[1]),f.strokeStyle="#3498db",f.lineWidth=4/e.scale,f.stroke()}f.fillStyle="#fff",f.strokeStyle=H,f.lineWidth=1.5/e.scale;for(let c=0;c<g.length-1;c++){const d=g[c];f.beginPath(),f.arc(d[0],d[1],b,0,2*Math.PI),f.fill(),f.stroke()}}}function lr(t,o,n,r,l){const i=new Path2D(t);f.save(),f.translate(o,n),f.scale(1/e.scale,1/e.scale),f.translate(-12,-12),f.fillStyle=r?H:l||"#34495e",f.fill(i),f.restore()}function ir(t,o){const[n,r]=t.geometry.coordinates,{subType:l,label:i}=t.properties,a=(e.styleOverrides||K())[l];let m=Xe.default,p="#34495e",g=t.properties.fontSize||a?.fontSize||12,b=t.properties.fontColor||a?.fontColor;a&&a.baseType==="point"&&(m=a.icon||m,p=a.iconColor||p),o&&(f.fillStyle="rgba(231, 76, 60, 0.3)",f.beginPath(),f.arc(n,r,18/e.scale,0,2*Math.PI),f.fill()),lr(m,n,r,o,p);const c=go(void 0,p,o,b);f.fillStyle=c,f.font=`${g/e.scale}px sans-serif`,f.textAlign="center",f.fillText(i,n,r-22/e.scale)}function sr(t,o){const{coordinates:n}=t.geometry;if(!(n.length<2)&&(f.beginPath(),f.moveTo(n[0][0],n[0][1]),n.slice(1).forEach(r=>f.lineTo(r[0],r[1])),f.strokeStyle=o?H:t.properties.isAccessible?"#3498db":"#8e44ad",f.lineWidth=(o?5:3)/e.scale,f.lineCap="round",f.stroke(),o)){const r=6/e.scale;f.fillStyle="#fff",f.strokeStyle=H,f.lineWidth=2/e.scale;let l=[];if(t.properties.subType==="arc"&&t.properties.controlPoints){const{p0:i,p1:s,p2:a}=t.properties.controlPoints;l=[i,s,a],f.setLineDash([4/e.scale,4/e.scale]),f.beginPath(),f.moveTo(i.x,i.y),f.lineTo(s.x,s.y),f.lineTo(a.x,a.y),f.strokeStyle="#7f8c8d",f.stroke(),f.setLineDash([])}else l=n.map(i=>({x:i[0],y:i[1]}));l.forEach(i=>{f.beginPath(),f.arc(i.x,i.y,r,0,2*Math.PI),f.fill(),f.stroke()})}}function ar(){const t=e.project.features.filter(n=>n.properties.floor===e.activeFloorId&&n.geometry.type==="Point"&&n.properties.subType==="beacon"),o=8;t.forEach(n=>{const[r,l]=n.geometry.coordinates,s=(typeof n.properties.beacon_range=="number"?n.properties.beacon_range:o)*(e.gridSize/e.metersPerGridCell),a=f.createRadialGradient(r,l,0,r,l,s);a.addColorStop(0,"rgba(46, 204, 113, 0.35)"),a.addColorStop(.5,"rgba(241, 196, 15, 0.25)"),a.addColorStop(1,"rgba(231, 76, 60, 0.15)"),f.fillStyle=a,f.beginPath(),f.arc(r,l,s,0,Math.PI*2),f.fill()})}function cr(){if(!e.tempShape?.start)return;f.strokeStyle=H,f.lineWidth=1.5/e.scale,f.setLineDash([6/e.scale,6/e.scale]);const{start:t}=e.tempShape,o=Q(e.mousePos);f.strokeRect(t.x,t.y,o.x-t.x,o.y-t.y),f.setLineDash([])}function dr(){if(!e.tempShape?.start)return;f.strokeStyle=H,f.lineWidth=1.5/e.scale,f.setLineDash([6/e.scale,6/e.scale]);const{start:t}=e.tempShape,o=Q(e.mousePos),n=Math.max(Math.abs(o.x-t.x),Math.abs(o.y-t.y)),r=o.x>=t.x?t.x:t.x-n,l=o.y>=t.y?t.y:t.y-n;f.strokeRect(r,l,n,n),f.setLineDash([])}function pr(){if(!e.tempShape?.start)return;f.strokeStyle=H,f.lineWidth=2/e.scale,f.beginPath(),f.moveTo(e.tempShape.start.x,e.tempShape.start.y);const t=dt(Q(e.mousePos));f.lineTo(t.x,t.y),f.stroke()}function ur(){if(!e.tempShape?.nodes||e.tempShape.nodes.length===0)return;f.strokeStyle=H,f.lineWidth=2/e.scale,f.beginPath();const t=e.tempShape.nodes[0];f.moveTo(t.x,t.y);for(let n=1;n<e.tempShape.nodes.length;n++)f.lineTo(e.tempShape.nodes[n].x,e.tempShape.nodes[n].y);const o=Q(e.mousePos);f.lineTo(o.x,o.y),f.stroke()}function mr(){if(!e.tempShape?.start)return;const t=dt(Q(e.mousePos));if(f.strokeStyle=H,f.lineWidth=2/e.scale,f.setLineDash([6/e.scale,6/e.scale]),f.beginPath(),!e.tempShape.end)f.moveTo(e.tempShape.start.x,e.tempShape.start.y),f.lineTo(t.x,t.y);else{const o=e.tempShape.start,n=e.tempShape.end,l=nn(o,n,t),i=De(o,n,l);f.moveTo(i[0][0],i[0][1]);for(let s=1;s<i.length;s++)f.lineTo(i[s][0],i[s][1])}f.stroke(),f.setLineDash([])}function yr(){if(!e.tempShape?.start)return;const t=e.tempShape.start,o=Q(e.mousePos),n=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2)),r=K(),i=document.getElementById("element-type-select")?.value||"default",s=r[i];let a=s&&s.baseType==="area"&&s.fill||Y.default.fill;const m=yo(a);if(m){const p=Math.max(m.a,.65);a=`rgba(${m.r}, ${m.g}, ${m.b}, ${p})`}f.beginPath(),f.arc(t.x,t.y,n,0,2*Math.PI),f.fillStyle=a,f.fill(),f.strokeStyle=H,f.lineWidth=1.5/e.scale,f.setLineDash([6/e.scale,6/e.scale]),f.stroke(),f.setLineDash([])}function gr(){const{x:r,y:l}=e.mousePosScreen,i=document.body.getAttribute("data-theme")||"light";f.save(),f.beginPath(),f.arc(r,l,75,0,Math.PI*2),f.strokeStyle=i==="dark"?"#333":"#a0a0a0",f.lineWidth=3,f.stroke(),f.clip(),f.globalAlpha=1,f.drawImage(q,r-75/2.5,l-75/2.5,150/2.5,150/2.5,r-75,l-75,150,150),f.globalAlpha=1,f.restore()}let fo="de";function y(t,o){return{de:t,en:o}}const fr={file:y("Datei","File"),output:y("Ausgabe","Output"),overview:y("Übersicht","Overview"),darkMode:y("Dunkles Thema","Dark Theme"),lightMode:y("Helles Thema","Light Theme"),backToApp:y("Zurück zur Anwendung","Back to Application"),filePanelTitle:y("Datei","File"),newProject:y("Neues Projekt","New Project"),loadProject:y("Projekt laden","Load Project"),saveProject:y("Projekt speichern","Save Project"),introduction:y("Einleitung","Introduction"),outputPanelTitle:y("Ausgabe","Output"),exportGeoJson:y("GeoJSON exportieren","Export GeoJSON"),showLiveCode:y("Live Code anzeigen","Show Live Code"),hideCode:y("Code ausblenden","Hide Code"),overviewPanelTitle:y("Projektübersicht","Project Overview"),unnamedProject:y("Unbenanntes Projekt","Unnamed Project"),stat_project:y("Projekt","Project"),stat_floors:y("Etagen","Floors"),stat_areas:y("Flächen","Areas"),stat_points:y("Punkte","Points"),project:y("Projekt","Project"),projectName:y("Projektname","Project Name"),enterProjectName:y("Projektname eingeben...","Enter project name..."),edit:y("Bearbeiten","Edit"),undo:y("Rückgängig","Undo"),redo:y("Wiederherstellen","Redo"),floors:y("Etagen","Floors"),currentFloor:y("Aktuelle Etage","Current Floor"),newFloor:y("Neue Etage","New Floor"),floorplan:y("Grundriss...","Floorplan..."),prompt_newFloorName:y("Name der neuen Etage:","Name of the new floor:"),renameFloor:y("Etage umbenennen","Rename Floor"),prompt_renameFloor:y('Neuen Namen für die Etage "{0}" eingeben:','Enter new name for floor "{0}":'),defaultFloorName:y("Standard-Etage","Default Floor"),tools:y("Werkzeuge","Tools"),pan:y("Bewegen","Pan"),select:y("Auswählen","Select"),moveElement:y("Verschieben","Move Element"),merge:y("Zusammenfügen","Merge"),scissors:y("Schere","Scissors"),delete:y("Löschen","Delete"),areas:y("Flächen","Areas"),rectangle:y("Viereck","Rectangle"),square:y("Quadrat","Square"),polygon:y("Polygon","Polygon"),circle:y("Kreis","Circle"),linesAndPoints:y("Linien & Punkte","Lines & Points"),line:y("Linie","Line"),arc:y("Bogen","Arc"),point:y("Punkt","Point"),elementType:y("Element-Typ","Element Type"),manageTypes:y("Typen verwalten...","Manage Types..."),newAreaType:y("Neue Fläche","New Area Type"),newPointType:y("Neuer Punkt","New Point Type"),lineLabel:y("Linie","Line"),arcLabel:y("Bogen","Arc"),defaultRoomLabel:y("Beispielraum","Sample Room"),customIndicatorSuffix:y(" (Benutzerdefiniert)"," (Custom)"),alert_selectAtLeastTwo:y("Bitte mindestens zwei Elemente auswählen.","Please select at least two elements."),alert_notEnoughPoints:y("Nicht genug Punkte für eine Fläche.","Not enough points for an area."),fontSettings:y("Schrift-Einstellungen","Font Settings"),fontSize:y("Schriftgröße","Font Size"),fontColor:y("Schriftfarbe","Font Color"),fontSizeDesc:y("Bestimmt die Schriftgröße für Beschriftungen dieses Typs.","Controls the label font size for this type."),fontColorDesc:y("Legt die Textfarbe der Beschriftung fest.","Defines the text color of the label."),optgroupAreas:y("Flächen","Areas"),optgroupPointElements:y("Punkt-Elemente","Point Elements"),optgroupConnectors:y("Konnektoren","Konnektoren"),properties:y("Eigenschaften","Properties"),label:y("Bezeichnung","Label"),enterElementLabel:y("Bezeichnung des Elements...","Enter element label..."),noElementSelected:y("Kein Element ausgewählt.","No element selected."),viewAndLayers:y("Ansicht & Layer","View & Layers"),grid:y("Raster","Grid"),layers:y("Layer","Layers"),showGrid:y("Raster anzeigen","Show Grid"),snapToGrid:y("Am Raster ausrichten","Snap to Grid"),size:y("Size:","Size:"),metersPerCell:y("Meter/Kasten:","Meters per cell:"),layersAreas:y("Flächen","Areas"),layersPaths:y("Wege/Linien","Paths/Lines"),layersPoints:y("Punktelemente","Point Elements"),preview3D:y("3D-Vorschau","3D Preview"),welcomeTitle:y("Willkommen beim IMD Editor!","Welcome to IMD Editor!"),welcomeText:y("Dies ist ein Werkzeug zur Digitalisierung von Indoor-Karten.","This is a tool for digitizing indoor maps."),basicsTitle:y("Grundlagen der Bedienung:","Basic Operation:"),basicsTools:y("Werkzeuge: Wählen Sie links ein Werkzeug (z.B. Fläche, Punkt), um Elemente auf der Karte zu erstellen.","Tools: Select a tool on the left (e.g., Area, Point) to create elements on the map."),basicsZoom:y("Zoomen: Benutzen Sie das Mausrad, um in die Karte hinein- und herausuzoomen.","Zooming: Use the mouse wheel to zoom in and out of the map."),basicsPan:y("Verschieben der Ansicht: Halten Sie die mittlere Maustaste gedrückt und bewegen Sie die Maus, um die Kartenansicht zu verschieben.","Panning the view: Hold down the middle mouse button and move the mouse to pan the map view."),basicsMove:y("Elemente verschieben: Wählen Sie ein Element aus und ziehen Sie es mit der Maus an eine neue Position.","Move elements: Select an element and drag it with the mouse to a new position."),basicsSave:y('Speichern: Vergessen Sie nicht, Ihr Projekt über das "Datei"-Menü zu speichern.',`Saving: Don't forget to save your project via the "File" menu.`),intro_welcomeTitle:y("Willkommen im Editor!","Welcome to the Editor!"),intro_startText:y("Starten Sie, indem Sie Ihrem Projekt oben links einen Namen geben und rechts unter „Etagen“ einen Grundriss laden.","Start by entering a project name at the top left and loading a floor plan under “Floors” on the right."),intro_sectionTitle:y("So bedienen Sie die Karte:","How to use the map:"),intro_zoom:y("Zoomen: Drehen Sie das Mausrad.","Zoom: Scroll the mouse wheel."),intro_pan:y("Verschieben: Halten Sie das Mausrad gedrückt und bewegen Sie die Maus.","Pan: Hold the middle mouse button and move the mouse."),intro_preview3d:y("3D-Vorschau: Nutzen Sie den Button unten links, um Ihr Modell räumlich zu sehen.","3D preview: Use the button at the bottom left to view your model in 3D."),intro_draw_title:y("Zeichnen & Bearbeiten:","Drawing & Editing:"),intro_finishShape:y("Form beenden: Ein Doppelklick schließt eine gezeichnete Fläche ab.","Finish shape: Double-click to close a drawn area."),intro_escape:y("Abbrechen (ESC): Drücken Sie die ESC-Taste, um ein Werkzeug wegzulegen oder die Auswahl aufzuheben.","Cancel (ESC): Press ESC to put away a tool or clear the selection."),intro_merge:y("Zusammenfügen: Wählen Sie im Werkzeug „Zusammenfügen“ mehrere Flächen aus und drücken Sie Enter, um sie zu verschmelzen.","Merge: In the “Merge” tool, select multiple areas and press Enter to combine them."),intro_shortcuts_title:y("Wichtige Tastenkürzel:","Key shortcuts:"),intro_undo_redo:y("Strg + Z / Y: Fehler rückgängig machen / wiederherstellen.","Ctrl + Z / Y: Undo / redo mistakes."),intro_copy_paste:y("Strg + C / V: Elemente kopieren und einfügen.","Ctrl + C / V: Copy and paste elements."),intro_delete:y("Entf: Das ausgewählte Element löschen.","Del: Delete the selected element."),intro_shift_zoom:y("Shift (Umschalt): Gedrückt halten, um die Lupe zu aktivieren.","Shift: Hold to activate the magnifier."),intro_alt_click:y("Alt + Klick: Fügt einer bestehenden Linie einen neuen Punkt hinzu.","Alt + Click: Adds a new point to an existing line."),intro_save_reminder:y("Vergessen Sie nicht, Ihr Projekt regelmäßig über das Menü „Datei“ zu speichern!","Remember to save your project regularly via the “File” menu!"),mergeHintShort:y("Klicke mindestens zwei Flächen auf derselben Etage an und drücke Enter, um sie zu einer neuen Fläche zusammenzufassen.","Click at least two areas on the same floor and press Enter to merge them into a new area."),alert_selectTwo:y("Bitte genau zwei Elemente auswählen.","Please select exactly two elements."),alert_sameFloor:y("Beide Elemente müssen auf derselben Etage liegen.","Both elements must be on the same floor."),alert_noOverlap:y("Kein Schnittbereich gefunden.","No overlap found."),manageTypesTitle:y("Element-Typen verwalten","Manage Element Types"),types:y("Typen","Types"),newType:y("+ Neuer Typ","+ New Type"),typeName:y("Typ-Name","Type Name"),exampleMarketing:y("z.B. Marketing","e.g. Marketing"),textStyle:y("Schrift-Stil","Font Style"),areaStyle:y("Flächen-Stil","Area Style"),pointStyle:y("Punkt-Stil","Point Style"),fillColor:y("Füllfarbe","Fill Color"),fillColorDesc:y("Farbe der Innenfläche des Elements (z.B. Raum).","Color of the element's inner area (e.g., room)."),fillOpacity:y("Deckkraft der Füllung","Fill Opacity"),fillOpacityDesc:y("Transparenz der Füllfarbe (0.0 = transparent, 1.0 = opak).","Transparency of the fill color (0.0 = transparent, 1.0 = opaque)."),strokeColor:y("Rahmenfarbe","Border Color"),strokeColorDesc:y("Farbe des Rahmens/der Umrandung des Elements.","Color of the element's border/outline."),currentFillColor:y("Aktuelle Füllfarbe","Current Fill Color"),currentStrokeColor:y("Aktuelle Rahmenfarbe","Current Border Color"),iconSelection:y("Icon Auswahl","Icon Selection"),iconSelectionDesc:y("Wählen Sie ein Symbol für diesen Punkt-Typ.","Select an icon for this point type."),iconColor:y("Icon-Farbe","Icon Color"),iconColorDesc:y("Farbe des Icons auf der Karte.","Color of the icon on the map."),deleteType:y("Typ löschen","Delete Type"),typeManagerPlaceholder:y("Wählen Sie links einen Typ aus oder erstellen Sie einen neuen.","Select a type on the left or create a new one."),saveChangesAndClose:y("Änderungen übernehmen & schließen","Apply Changes & Close"),typePreview:y("Vorschau","Preview"),previewAreaLabel:y("Beispielraum","Sample Room"),previewPointLabel:y("Beispielpunkt","Sample Point"),areasGroup:y("Flächen","Areas"),pointsConnectorsGroup:y("Punkte & Konnektoren","Points & Connectors"),createNewElementType:y("Neuen Element-Typ erstellen","Create New Element Type"),chooseBaseType:y("Wählen Sie den Basis-Typ aus:","Choose the base type:"),choiceArea:y("Fläche","Area"),choicePoint:y("Punkt","Point"),cancel:y("Abbrechen","Cancel"),ok:y("OK","OK"),rename:y("Umbenennen...","Rename..."),copy:y("Kopieren","Copy"),changeType:y("Typ ändern","Change Type"),ctxAddOverlapPoint:y("Punkt im Schnittbereich setzen","Place point at overlap"),alert_deleteTypeConfirm:y('Möchten Sie den Typ "{0}" wirklich löschen?','Do you really want to delete the type "{0}"?'),alert_renameSelectOne:y("Bitte wählen Sie genau ein Element zum Umbenennen aus.","Please select exactly one element to rename."),prompt_renameElement:y("Neuen Namen eingeben:","Enter new name:"),alert_noActiveFloor:y("Bitte zuerst eine Etage auswählen oder erstellen.","Please select or create a floor first."),alert_floorNameExists:y("Dieser Etagenname ist bereits vergeben.","This floor name already exists."),alert_newProjectConfirm:y("Möchten Sie wirklich ein neues Projekt starten? Nicht gespeicherte Änderungen gehen verloren.","Do you really want to start a new project? Unsaved changes will be lost."),confirm_deleteElement_single:y("Möchten Sie das ausgewählte Element wirklich löschen?","Do you really want to delete the selected element?"),confirm_deleteElement_multi:y("Möchten Sie die {0} ausgewählten Elemente wirklich löschen?","Do you really want to delete the {0} selected elements?"),area_raum_label:y("Raum","Room"),area_buero_label:y("Büro","Office"),area_toiletten_label:y("Toiletten","Restrooms"),area_gang_label:y("Gang","Corridor"),area_lager_label:y("Lager","Storage"),point_eingang_label:y("Eingang","Entrance"),point_feuerloescher_label:y("Feuerlöscher","Fire Extinguisher"),point_treppe_label:y("Treppe","Stairs"),point_aufzug_label:y("Aufzug","Elevator"),point_beacon_label:y("Beacon","Beacon"),beacon_uuid_label:y("Beacon UUID","Beacon UUID"),beacon_major_label:y("Beacon Major","Beacon Major"),beacon_minor_label:y("Beacon Minor","Beacon Minor"),beacon_installation_label:y("Installationsdatum/-zeit","Installation Date/Time"),beacon_range_label:y("Reichweite (m)","Range (m)"),beacon_number_label:y("Nummer","Number"),beacon_note_de_label:y("Notiz (DE)","Note (DE)"),beacon_note_en_label:y("Notiz (EN)","Note (EN)"),threeD_fullscreen_title:y("3D-Ansicht","3D View"),pdf_convert:y("Konvertiere PDF, dies kann einen Moment dauern...","Converting PDF, this may take a moment..."),image_load:y("Lade Bild...","Loading image...")};function hr(t){fo=t}function u(t,o=fo,...n){const r=fr[t];if(!r)return console.warn(`Missing translation key: ${t}`),t;let l=r[o]||r.en||t;return n.forEach((i,s)=>{l=l.replace(new RegExp(`\\{${s}\\}`,"g"),String(i))}),l}function ho(){e.project.floorplanImages||(e.project.floorplanImages={});const t=Object.keys(e.project.floorplanImages);t.length===0&&(e.project.floorplanImages[X]=null),e.activeFloorId||(e.activeFloorId=t.length>0?t[0]:X)}function br(){bo(!1),document.getElementById("mode-area")?.click(),ue()}function bo(t=!0,o){if(t&&!confirm(u("alert_newProjectConfirm")))return;e.project.type="FeatureCollection",e.project.features=[],e.project.properties={projectName:u("unnamedProject"),elementTypeStyles:{}};const n=o&&o.trim()!==""?o.trim():X;e.project.floorplanImages={[n]:null};const r=document.getElementById("projectName");r&&(r.value=e.project.properties.projectName),e.cachedFloorPlanImages={},e.selectedFeatureIds=[],vo(),e.activeFloorId=n,ho(),vr(),k(),pe(),U(),B(),ue(),M()}function wn(t,o=!0){if(!t||t.trim()===""){alert("Der Etagenname darf nicht leer sein.");return}const n=t.trim();if(oe().includes(n)){alert(u("alert_floorNameExists"));return}e.activeFloorId=n,e.selectedFeatureIds=[],e.project.floorplanImages||(e.project.floorplanImages={}),e.project.floorplanImages[e.activeFloorId]=null;const l={type:"Feature",geometry:{type:"Polygon",coordinates:[[[100,100],[700,100],[700,500],[100,500],[100,100]]]},properties:{id:`feat_${Date.now()}`,floor:e.activeFloorId,type:"area",subType:"raum",label:u("defaultRoomLabel")}};e.project.features.push(l),o&&k(),pe(),U(),B(),M()}function Pn(t){const o=e.activeFloorId;if(!o){alert(u("alert_noActiveFloor"));return}const n=t.trim();if(!n||n===o)return;if(oe().filter(l=>l!==o).includes(n)){alert(u("alert_floorNameExists"));return}e.project.features.forEach(l=>{l.properties.floor===o&&(l.properties.floor=n)}),e.project.floorplanImages&&Object.prototype.hasOwnProperty.call(e.project.floorplanImages,o)&&(e.project.floorplanImages[n]=e.project.floorplanImages[o],delete e.project.floorplanImages[o]),Object.prototype.hasOwnProperty.call(e.cachedFloorPlanImages,o)&&(e.cachedFloorPlanImages[n]=e.cachedFloorPlanImages[o],delete e.cachedFloorPlanImages[o]),e.activeFloorId=n,k(),pe(),U(),B(),M()}function oe(){const t=new Set;return e.project.features.forEach(o=>t.add(o.properties.floor)),e.project.floorplanImages&&Object.keys(e.project.floorplanImages).forEach(o=>t.add(o)),Array.from(t).sort((o,n)=>o.localeCompare(n,void 0,{numeric:!0}))}function pe(){const t=oe(),o=e.activeFloorId,n=document.getElementById("floor-select");if(!n)return;if(n.innerHTML="",t.length===0){const l=document.createElement("option");l.textContent=u("currentFloor"),n.appendChild(l),e.activeFloorId=null}else t.forEach(l=>{const i=document.createElement("option");i.value=l,i.textContent=l,n.appendChild(i)}),o&&t.includes(o)?n.value=o:(e.activeFloorId=t[0],n.value=t[0]);const r=document.getElementById("floor-preview");r&&e.activeFloorId&&e.cachedFloorPlanImages[e.activeFloorId]?(r.src=e.cachedFloorPlanImages[e.activeFloorId].src,r.style.display="block"):r&&(r.style.display="none")}function vr(){if(e.project.features.length>0)return;const t={type:"Feature",geometry:{type:"Polygon",coordinates:[[[100,100],[700,100],[700,500],[100,500],[100,100]]]},properties:{id:`feat_default_${Date.now()}`,floor:e.activeFloorId||X,type:"area",subType:"raum",label:u("defaultRoomLabel"),isDefaultSeed:!0}};e.project.features.push(t)}function K(){const t={},o={raum:u("area_raum_label"),buero:u("area_buero_label"),toiletten:u("area_toiletten_label"),gang:u("area_gang_label"),lager:u("area_lager_label")};for(const l in Y)o[l]&&(t[l]={label:o[l],baseType:"area",fill:Y[l].fill,stroke:Y[l].stroke,isDefault:!0});const n={eingang:u("point_eingang_label"),feuerloescher:u("point_feuerloescher_label"),treppe:u("point_treppe_label"),aufzug:u("point_aufzug_label"),beacon:u("point_beacon_label")};for(const l in Xe)n[l]&&(t[l]={label:n[l],baseType:"point",icon:Xe[l],iconColor:"#34495e",isDefault:!0});const r=e.project.properties.elementTypeStyles;if(r)for(const l in r)t[l]={...t[l],...r[l],isDefault:!1};return t}function ue(){const t=document.getElementById("element-type-select");if(!t)return;const o=K(),n=t.value,r=[],l=[],i=[];for(const g in o){const b=o[g];b.baseType==="area"?r.push({key:g,style:b}):b.baseType==="point"&&(["treppe","aufzug"].includes(g)?i.push({key:g,style:b}):l.push({key:g,style:b}))}const s=(g,b)=>g.style.label.localeCompare(b.style.label);r.sort(s),l.sort(s),i.sort(s);const a=document.createElement("optgroup");a.label=u("optgroupAreas");const m=document.createElement("optgroup");m.label=u("optgroupPointElements");const p=document.createElement("optgroup");p.label=u("optgroupConnectors");const v=(g,b)=>{b.forEach(({key:c,style:d})=>{const h=document.createElement("option");h.value=c;const x=d.isDefault?"":u("customIndicatorSuffix");h.textContent=d.label+x,h.dataset.type=d.baseType,g.appendChild(h)})};v(a,r),v(m,l),v(p,i),t.innerHTML="",t.appendChild(a),t.appendChild(m),i.length>0&&t.appendChild(p),n&&t.querySelector(`option[value="${n}"]`)?t.value=n:r.length>0?t.value=r[0].key:l.length>0&&(t.value=l[0].key)}function de(t,o){e.project.features.push({type:"Feature",geometry:t,properties:o}),k(),U(),B(),M()}async function ht(){if(e.selectedFeatureIds.length===0)return;const t=e.selectedFeatureIds.length>1?u("confirm_deleteElement_multi",void 0,e.selectedFeatureIds.length):u("confirm_deleteElement_single");if(await pt(t)){e.project.features=e.project.features.filter(r=>!e.selectedFeatureIds.includes(r.properties.id)),e.selectedFeatureIds=[];const n=document.getElementById("deleteBtn");n&&(n.disabled=!0),k(),U(),B(),M()}}let me=null,Et=null,re=null,qe=null,He=null,Pe=null,It=null,Re=null,Ve=null,_e=null,St=null,wt=null;function xr(t){me=t.inputPromptModal,Et=t.inputPromptLabel,re=t.inputPromptInput,qe=t.inputPromptOk,He=t.inputPromptCancel,Pe=t.confirmModal,It=t.confirmMessage,Re=t.confirmOk,Ve=t.confirmCancel,_e=t.loadingModal,St=t.loadingMessage,wt=t.loadingOk}function ie(t,o=""){return!me||!Et||!re||!qe||!He?Promise.resolve(null):(Et.textContent=t,re.value=o,me.classList.remove("hidden"),re.focus(),new Promise(n=>{const r=()=>{me.classList.add("hidden"),qe.removeEventListener("click",l),He.removeEventListener("click",i),re.removeEventListener("keydown",s),a&&a.removeEventListener("click",i)},l=()=>{const m=re.value.trim();r(),n(m||null)},i=()=>{r(),n(null)},s=m=>{m.key==="Enter"?l():m.key==="Escape"&&i()};qe.addEventListener("click",l),He.addEventListener("click",i),re.addEventListener("keydown",s);const a=me?me.querySelector(".modal-overlay"):null;a&&a.addEventListener("click",i)}))}function pt(t){return!Pe||!It||!Re||!Ve?Promise.resolve(!1):(It.textContent=t,Pe.classList.remove("hidden"),new Promise(o=>{const n=()=>{Pe.classList.add("hidden"),Re.removeEventListener("click",r),Ve.removeEventListener("click",l),s?.removeEventListener("click",l),window.removeEventListener("keydown",i)},r=()=>{n(),o(!0)},l=()=>{n(),o(!1)},i=a=>{a.key==="Escape"&&l(),a.key==="Enter"&&r()};Re.addEventListener("click",r),Ve.addEventListener("click",l),window.addEventListener("keydown",i);const s=Pe.querySelector(".modal-overlay");s&&s.addEventListener("click",l)}))}function Er(t){!_e||!St||!wt||(St.textContent=t,_e.classList.remove("hidden"),wt.onclick=()=>Ge())}function Ge(){_e&&_e.classList.add("hidden")}function kn(t){e.project.properties.projectName=t.trim(),U(),B();const o=new Blob([JSON.stringify(e.project,null,2)],{type:"application/geo+json"}),n=document.createElement("a");n.href=URL.createObjectURL(o);const r=(e.project.properties.projectName||"projekt").replace(/[^a-z0-9]/gi,"_").toLowerCase();n.download=`${r}.geojson`,n.click(),URL.revokeObjectURL(n.href)}function Ir(t){const o=new FileReader;o.onload=n=>{try{const r=JSON.parse(n.target?.result);vo(),ut(r),k()}catch(r){alert("Fehler beim Laden der Projektdatei."),console.error(r)}},o.readAsText(t)}function ut(t){if(t.type!=="FeatureCollection"||!t.features)throw new Error("Ungültiges GeoJSON-Projektformat.");e.project=t,ho();const o=document.getElementById("projectName");o&&(o.value=e.project.properties.projectName||""),e.cachedFloorPlanImages={},e.project.floorplanImages&&Object.entries(e.project.floorplanImages).forEach(([r,l])=>{if(l){const i=new Image;i.onload=()=>{e.cachedFloorPlanImages[r]=i,r===e.activeFloorId&&M()},i.src=l}});const n=oe();e.activeFloorId=n.includes(e.activeFloorId)?e.activeFloorId:n[0]||null,pe(),ue(),U(),B(),M()}async function Sr(t){try{const o=await vt(()=>import("./pdf-DcE_ssc1.js"),[]);o.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${o.version}/pdf.worker.mjs`;const n=await t.arrayBuffer(),r=new Uint8Array(n),i=await(await o.getDocument(r).promise).getPage(1),s=i.getViewport({scale:2}),a=document.createElement("canvas");if(!a.getContext("2d"))throw new Error("Canvas-Kontext konnte nicht erstellt werden.");return a.height=s.height,a.width=s.width,await i.render({canvas:a,viewport:s}).promise,a.toDataURL("image/png")}catch(o){throw console.error("Fehler beim Konvertieren des PDFs:",o),new Error("Das PDF konnte nicht verarbeitet werden.")}}function wr(t,o){e.project.floorplanImages||(e.project.floorplanImages={}),e.project.floorplanImages[o]=t;const n=new Image;n.onload=()=>{e.cachedFloorPlanImages[o]=n,k(),pe(),M()},n.src=t}async function Pr(t){return new Promise((o,n)=>{const r=new FileReader;r.onload=()=>o(r.result),r.onerror=()=>n(new Error("Fehler beim Lesen der Bilddatei.")),r.readAsDataURL(t)})}async function kr(t){if(!e.activeFloorId){alert("Bitte zuerst eine Etage auswählen oder erstellen.");return}const o=e.activeFloorId,n=t.type;try{let r;if(Er(u(n==="application/pdf"?"pdf_convert":"image_load")),n.startsWith("image/"))r=await Pr(t);else if(n==="application/pdf")r=await Sr(t);else{Ge(),alert("Nicht unterstützter Dateityp. Bitte wählen Sie eine Bild- oder PDF-Datei.");return}wr(r,o),Ge()}catch(r){Ge();const l=r instanceof Error?r.message:"Ein unbekannter Fehler ist aufgetreten.";alert(`Der Grundriss konnte nicht geladen werden: ${l}`)}}const X="EG";function Cr(){return{type:"FeatureCollection",features:[],properties:{projectName:"Unbenanntes Projekt",elementTypeStyles:{}},floorplanImages:{[X]:null}}}const e={project:Cr(),worldSize:{width:8e3,height:6e3},pan:{x:0,y:0},scale:1,threeDPan:{x:50,y:50},threeDScale:.8,threeDIsDragging:!1,threeDStartPos:{x:0,y:0},activeFloorId:X,activeLanguage:"de",activeTheme:"light",currentMode:"select",tempShape:null,mousePos:{x:0,y:0},mousePosScreen:{x:0,y:0},gridSize:40,isGridVisible:!0,isSnapEnabled:!0,metersPerGridCell:1,selectedFeatureIds:[],cachedFloorPlanImages:{},clipboard:null,isShiftPressed:!1,isCtrlPressed:!1,isAltPressed:!1,styleOverrides:null,isMovingElement:!1,dragStartPos:{x:0,y:0},originalGeometriesOnMove:new Map,isEditingPath:!1,editedFeatureId:null,editedNodeIndex:-1,hoveredFeatureId:null,hoveredEdgeIndex:-1,panStart:{x:0,y:0},isPanning:!1,visibleLayers:{area:!0,path:!0,point:!0,connector:!0},showBeaconHeatmap:!1},ce=[];let W=-1;window.state=e;function k(){W<ce.length-1&&ce.splice(W+1),ce.push(JSON.parse(JSON.stringify(e.project))),W++}function Cn(){W>0&&(W--,ut(JSON.parse(JSON.stringify(ce[W]))))}function Bn(){W<ce.length-1&&(W++,ut(JSON.parse(JSON.stringify(ce[W]))))}function vo(){ce.length=0,W=-1}function xo(t,o){const n=8/e.scale;for(let r=0;r<o.coordinates.length-1;r++){const l={x:o.coordinates[r][0],y:o.coordinates[r][1]},i={x:o.coordinates[r+1][0],y:o.coordinates[r+1][1]},s=i.x-l.x,a=i.y-l.y;if(s===0&&a===0)continue;const m=((t.x-l.x)*s+(t.y-l.y)*a)/(s*s+a*a),p=m<0?l:m>1?i:{x:l.x+m*s,y:l.y+m*a};if(Math.sqrt((t.x-p.x)**2+(t.y-p.y)**2)<n)return!0}return!1}function ne(t){const o=e.project.features.filter(n=>n.properties.floor===e.activeFloorId&&!n.properties.isPlaceholder);for(const n of[...o].reverse()){if(n.geometry.type==="Polygon"&&J(t,n.geometry))return n;if(n.geometry.type==="Point"||n.properties.type==="connector"){const[r,l]=n.geometry.coordinates;if(Math.sqrt((t.x-r)**2+(t.y-l)**2)*e.scale<15)return n}if(n.geometry.type==="LineString"&&xo(t,n.geometry))return n}return null}function Ae(t){if(!e.activeFloorId){alert(u("alert_noActiveFloor"));return}const o=document.getElementById("element-type-select");let n=o?.value||"";const r=K();let l=r[n];if(!l){const v=t.type==="Polygon"?"area":t.type==="Point"?"point":null;if(v){const g=Object.keys(r).find(b=>r[b].baseType===v);g&&(n=g,l=r[g],o&&o.querySelector(`option[value="${g}"]`)&&(o.value=g))}if(!l)return}const i=l.baseType,s=l.label,a=e.project.features.filter(v=>v.properties.subType===n).length+1,m=`${s} ${a}`,p={id:`feat_${Date.now()}`,floor:e.activeFloorId,type:i==="area"?"area":"point",subType:n,label:m};if(i==="point"&&["treppe","aufzug"].includes(n)?p.type="connector":t.type==="LineString"&&(p.type="path"),de(t,p),p.type==="connector"){const v=oe(),g=e.activeFloorId,b=v.find(c=>c!==g)||null;if(b){const c=`Soll ich das Gegenstück in ${b} automatisch erstellen?`;pt(c).then(d=>{if(d&&t.type==="Point"){const h=t.coordinates.slice(),x={id:`feat_${Date.now()}_link`,floor:b,type:"connector",subType:n,label:m,linksTo:{floor:g,connectorId:p.id}};de({type:"Point",coordinates:h},x)}})}}}function Br(t){if(!e.tempShape)e.tempShape={start:t};else{const{start:o}=e.tempShape,n=Math.min(o.x,t.x),r=Math.min(o.y,t.y),l=Math.abs(t.x-o.x),i=Math.abs(t.y-o.y);if(l<e.gridSize/2||i<e.gridSize/2){e.tempShape=null;return}const s=[[[n,r],[n+l,r],[n+l,r+i],[n,r+i],[n,r]]];Ae({type:"Polygon",coordinates:s}),e.tempShape=null}}function Mr(t){if(!e.tempShape)e.tempShape={start:t};else{const o=e.tempShape.start,n=Math.abs(t.x-o.x),r=Math.abs(t.y-o.y),l=Math.max(n,r),i=Math.min(o.x,t.x),s=Math.min(o.y,t.y);if(l<e.gridSize/2){e.tempShape=null;return}const a=[[[i,s],[i+l,s],[i+l,s+l],[i,s+l],[i,s]]];Ae({type:"Polygon",coordinates:a}),e.tempShape=null}}function Lr(t){if(!e.tempShape)e.tempShape={start:t};else{const o=e.tempShape.start,n=Math.sqrt((t.x-o.x)**2+(t.y-o.y)**2);if(n<2){e.tempShape=null;return}const r=64,l=Array.from({length:r},(i,s)=>{const a=s/r*2*Math.PI;return[o.x+n*Math.cos(a),o.y+n*Math.sin(a)]});l.push(l[0]),Ae({type:"Polygon",coordinates:[l]}),e.tempShape=null}}function Tr(t){if(!e.tempShape)e.tempShape={start:t};else{const o=[[e.tempShape.start.x,e.tempShape.start.y],[t.x,t.y]],n={id:`F_${Date.now()}`,floor:e.activeFloorId,type:"path",subType:"line",label:u("lineLabel")};de({type:"LineString",coordinates:o},n),e.currentMode="select",document.getElementById("mode-select")?.classList.add("active"),document.getElementById("mode-line")?.classList.remove("active"),e.tempShape=null}}function Fr(t){e.tempShape?e.tempShape.nodes.push(t):e.tempShape={nodes:[t]}}function jr(t){Ae({type:"Point",coordinates:[t.x,t.y]})}function _r(t){if(!e.tempShape)e.tempShape={start:t};else if(!e.tempShape.end)e.tempShape.end=t;else{const o=e.tempShape.start,n=e.tempShape.end,l=nn(o,n,t),i=De(o,n,l),s={id:`F_${Date.now()}`,floor:e.activeFloorId,type:"path",subType:"arc",label:u("arcLabel"),controlPoints:{p0:o,p1:l,p2:n}};de({type:"LineString",coordinates:i},s),e.tempShape=null}}function zr(){if(!e.activeFloorId||!e.tempShape?.nodes||e.tempShape.nodes.length<3){e.tempShape=null;return}const t=[...e.tempShape.nodes.map(o=>[o.x,o.y]),[e.tempShape.nodes[0].x,e.tempShape.nodes[0].y]];Ae({type:"Polygon",coordinates:[t]}),document.getElementById("mode-select")?.click(),e.tempShape=null}function Nr(){if(!e.activeFloorId||!e.tempShape)return null;const t=K();let n=document.getElementById("element-type-select")?.value||"raum";const l=t[n]?.label||"Preview",i="preview_feature",s=e.activeFloorId,a=e.mousePos||{x:0,y:0},m=Q(a);if(e.currentMode==="area"&&e.tempShape.start){const p=e.tempShape.start,v=Math.min(p.x,m.x),g=Math.min(p.y,m.y),b=Math.abs(m.x-p.x),c=Math.abs(m.y-p.y);return b<1||c<1?null:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[v,g],[v+b,g],[v+b,g+c],[v,g+c],[v,g]]]},properties:{id:i,floor:s,type:"area",subType:n,label:l,isPlaceholder:!0}}}if(e.currentMode==="square"&&e.tempShape.start){const p=e.tempShape.start,v=Math.abs(m.x-p.x),g=Math.abs(m.y-p.y),b=Math.max(v,g),c=Math.min(p.x,m.x),d=Math.min(p.y,m.y);return b<1?null:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[c,d],[c+b,d],[c+b,d+b],[c,d+b],[c,d]]]},properties:{id:i,floor:s,type:"area",subType:n,label:l,isPlaceholder:!0}}}if(e.currentMode==="polygon"&&e.tempShape.nodes&&e.tempShape.nodes.length>=1){const p=[...e.tempShape.nodes.map(v=>[v.x,v.y]),[m.x,m.y]];return p.length<3?null:(p.push(p[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[p]},properties:{id:i,floor:s,type:"area",subType:n,label:l,isPlaceholder:!0}})}if(e.currentMode==="circle"&&e.tempShape.start){const p=e.tempShape.start,v=Math.sqrt((m.x-p.x)**2+(m.y-p.y)**2);if(v<1)return null;const g=64,b=Array.from({length:g},(c,d)=>{const h=d/g*2*Math.PI;return[p.x+v*Math.cos(h),p.y+v*Math.sin(h)]});return b.push(b[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[b]},properties:{id:i,floor:s,type:"area",subType:n,label:l,isPlaceholder:!0}}}if(e.currentMode==="line"&&e.tempShape.start){const p=e.tempShape.start;return{type:"Feature",geometry:{type:"LineString",coordinates:[[p.x,p.y],[m.x,m.y]]},properties:{id:i,floor:s,type:"path",subType:n,label:l,isPlaceholder:!0}}}if(e.currentMode==="arc"&&e.tempShape.start){const p=e.tempShape.start;if(e.tempShape.end){const v=e.tempShape.start,g=e.tempShape.end,b=nn(v,g,m);return{type:"Feature",geometry:{type:"LineString",coordinates:De(v,g,b)},properties:{id:i,floor:s,type:"path",subType:"arc",label:l,isPlaceholder:!0}}}else return{type:"Feature",geometry:{type:"LineString",coordinates:[[p.x,p.y],[m.x,m.y]]},properties:{id:i,floor:s,type:"path",subType:"arc",label:l,isPlaceholder:!0}}}return e.currentMode==="point"?{type:"Feature",geometry:{type:"Point",coordinates:[m.x,m.y]},properties:{id:i,floor:s,type:"point",subType:n,label:l,isPlaceholder:!0}}:null}function B(){const t=document.getElementById("live-geojson-output");if(t){const o=Nr(),n=o?{...e.project,features:[...e.project.features,o]}:e.project;t.textContent=JSON.stringify(n,null,2)}}function Dr(t){const n=[...t.coordinates[0]];if(n.length<4)return!1;const r=n[0],l=n[n.length-1];(Math.abs(r[0]-l[0])>1e-4||Math.abs(r[1]-l[1])>1e-4)&&n.push([r[0],r[1]]);for(let i=0;i<n.length-1;i++){const s=n[i],a=n[i+1],m=Math.abs(s[1]-a[1])<1e-4,p=Math.abs(s[0]-a[0])<1e-4;if(!m&&!p)return!1}return!0}function Ar(t){const n=d=>Math.round(d/1e-4)*1e-4,r=new Map,l=new Map,i=(d,h,x)=>{const I=Math.min(h,x),w=Math.max(h,x),P=n(d);r.has(P)||r.set(P,[]),r.get(P).push({x1:n(I),x2:n(w)})},s=(d,h,x)=>{const I=Math.min(h,x),w=Math.max(h,x),P=n(d);l.has(P)||l.set(P,[]),l.get(P).push({y1:n(I),y2:n(w)})};for(const d of t){const h=d.coordinates[0];for(let x=0;x<h.length-1;x++){const I=h[x],w=h[x+1];Math.abs(I[1]-w[1])<1e-4?i(I[1],I[0],w[0]):s(I[0],I[1],w[1])}}const a=new Map,m=(d,h,x,I)=>{const w=`${n(d)},${n(h)}`,P=`${n(x)},${n(I)}`;return w<P?`${w}|${P}`:`${P}|${w}`};r.forEach((d,h)=>{const x=Array.from(new Set(d.flatMap(I=>[I.x1,I.x2]))).sort((I,w)=>I-w);for(const I of d)for(let w=0;w<x.length-1;w++){const P=x[w],C=x[w+1];if(P>=I.x1-1e-4&&C<=I.x2+1e-4){const T=m(P,h,C,h);a.set(T,(a.get(T)||0)+1)}}}),l.forEach((d,h)=>{const x=Array.from(new Set(d.flatMap(I=>[I.y1,I.y2]))).sort((I,w)=>I-w);for(const I of d)for(let w=0;w<x.length-1;w++){const P=x[w],C=x[w+1];if(P>=I.y1-1e-4&&C<=I.y2+1e-4){const T=m(h,P,h,C);a.set(T,(a.get(T)||0)+1)}}});const p=[];if(a.forEach((d,h)=>{if(d%2===1){const[x,I]=h.split("|"),[w,P]=x.split(",").map(Number),[C,T]=I.split(",").map(Number);p.push({x1:w,y1:P,x2:C,y2:T})}}),p.length===0)return[];const v=new Map;for(const d of p){const h=`${d.x1},${d.y1}`,x=`${d.x2},${d.y2}`;v.has(h)||v.set(h,[]),v.has(x)||v.set(x,[]),v.get(h).push({x:d.x2,y:d.y2}),v.get(x).push({x:d.x1,y:d.y1})}const g=new Set(p.map(d=>m(d.x1,d.y1,d.x2,d.y2))),b=[];for(;g.size>0;){const d=Array.from(g)[0].split("|")[0],[h,x]=d.split(",").map(Number),I={x:h,y:x},w=[I];let P=I,C=null;for(;;){const F=v.get(`${P.x},${P.y}`)||[];let D=null;for(const O of F){const ee=m(P.x,P.y,O.x,O.y);if(g.has(ee)&&(!C||O.x!==C.x||O.y!==C.y)){D=O;break}}if(!D||(g.delete(m(P.x,P.y,D.x,D.y)),C=P,P=D,w.push(P),P.x===I.x&&P.y===I.y))break}const T=w.map(F=>[F.x,F.y]);T.length>=4&&b.push(T)}if(b.length===0)return[];const c=d=>{let h=0;for(let x=0;x<d.length-1;x++){const[I,w]=d[x],[P,C]=d[x+1];h+=I*C-P*w}return Math.abs(h)/2};return b.sort((d,h)=>c(h)-c(d)),b[0]}function Or(t){const o=[...t].sort((i,s)=>i.x===s.x?i.y-s.y:i.x-s.x),n=(i,s,a)=>(s.x-i.x)*(a.y-i.y)-(s.y-i.y)*(a.x-i.x),r=[];for(const i of o){for(;r.length>=2&&n(r[r.length-2],r[r.length-1],i)<=0;)r.pop();r.push(i)}const l=[];for(let i=o.length-1;i>=0;i--){const s=o[i];for(;l.length>=2&&n(l[l.length-2],l[l.length-1],s)<=0;)l.pop();l.push(s)}return l.pop(),r.pop(),r.concat(l)}let we=null;function $r(){const t=document.getElementById("file-menu-trigger"),o=document.getElementById("output-menu-trigger"),n=document.getElementById("overview-menu-trigger"),r=document.getElementById("backstage-panel"),l=document.getElementById("backstage-close-btn"),i=document.getElementById("backstage-title"),s=document.getElementById("backstage-file-content"),a=document.getElementById("backstage-output-content"),m=document.getElementById("backstage-overview-content");if(!t||!o||!n||!r){console.error("Menü-Elemente konnten nicht gefunden werden!");return}const p=g=>{s.style.display="none",a.style.display="none",m.style.display="none",g==="file"?(s.style.display="block",i.textContent=u("filePanelTitle")):g==="output"?(a.style.display="block",i.textContent=u("outputPanelTitle")):g==="overview"&&(m.style.display="block",i.textContent=u("overviewPanelTitle")),r.classList.add("visible"),document.body.classList.add("backstage-visible"),we=g,t.classList.remove("active"),o.classList.remove("active"),n.classList.remove("active"),document.getElementById(`${g}-menu-trigger`)?.classList.add("active")},v=()=>{r.classList.remove("visible"),document.body.classList.remove("backstage-visible"),we=null,t.classList.remove("active"),o.classList.remove("active"),n.classList.remove("active")};t.addEventListener("click",g=>{g.stopPropagation(),we==="file"?v():p("file")}),o.addEventListener("click",g=>{g.stopPropagation(),we==="output"?v():p("output")}),n.addEventListener("click",g=>{g.stopPropagation(),we==="overview"?v():p("overview")}),l.addEventListener("click",v)}function ke(){const t=document.getElementById("gridInfo");if(!t)return;const o=Math.round(e.gridSize*e.scale),n=e.metersPerGridCell,r=e.activeLanguage==="de"?"Kasten":"cell";t.textContent=`1 ${r} ≈ ${o} px · ≈ ${n} m`}function qr(t){const o=document.getElementById("toggleGridBtn"),n=document.getElementById("toggleSnapBtn"),r=document.getElementById("gridSizeInput"),l=document.getElementById("gridMinusBtn"),i=document.getElementById("gridPlusBtn"),s=document.getElementById("gridMetersInput"),a=document.getElementById("gridMetersMinusBtn"),m=document.getElementById("gridMetersPlusBtn");o&&o.addEventListener("change",()=>{e.isGridVisible=o.checked,t()}),n&&n.addEventListener("change",()=>{e.isSnapEnabled=n.checked}),r&&r.addEventListener("input",()=>{const p=parseInt(r.value,10);!isNaN(p)&&p>=5&&(e.gridSize=p,t())}),l&&l.addEventListener("click",()=>{const p=Math.max(5,(e.gridSize||40)-5);e.gridSize=p,r&&(r.value=String(p)),t()}),i&&i.addEventListener("click",()=>{const p=Math.min(400,(e.gridSize||40)+5);e.gridSize=p,r&&(r.value=String(p)),t()}),s&&s.addEventListener("input",()=>{const p=parseFloat(s.value);!isNaN(p)&&p>=.1&&(e.metersPerGridCell=Math.round(p*100)/100,ke())}),a&&a.addEventListener("click",()=>{const p=Math.max(.1,(e.metersPerGridCell||1)-.1),v=Math.round(p*100)/100;e.metersPerGridCell=v,s&&(s.value=String(v)),ke()}),m&&m.addEventListener("click",()=>{const p=Math.min(100,(e.metersPerGridCell||1)+.1),v=Math.round(p*100)/100;e.metersPerGridCell=v,s&&(s.value=String(v)),ke()}),document.querySelectorAll(".layer-toggle").forEach(p=>{p.addEventListener("change",v=>{const g=v.target,b=g.dataset.layer;b&&(e.visibleLayers[b]=g.checked,t())})}),ke()}let se=null,We=null,Pt=null;function Hr(t){se=t.contextMenu,We=t.ctxMenuTypeSubmenu,Pt=t.ctxMenuAddOverlapPoint}function Rr(t,o){if(!We)return;We.innerHTML="";const n=K(),r=t.geometry.type==="Polygon"||t.geometry.type==="Point"?n[t.properties.subType]?.baseType:null;if(r){for(const l in n)if(n[l].baseType===r){const i=document.createElement("li");i.textContent=n[l].label,i.dataset.typeKey=l,i.addEventListener("click",()=>{e.project.features.forEach(s=>{if(e.selectedFeatureIds.includes(s.properties.id)){const a=n[s.properties.subType];a&&a.baseType===r&&(s.properties.subType=l)}}),k(),M(),o()}),We.appendChild(i)}}}function Vr(t,o,n){se&&(Pt&&(Pt.style.display=n===2?"":"none"),se.style.display="block",se.style.left=`${t}px`,se.style.top=`${o}px`)}function Eo(){se&&(se.style.display="none")}function Gr(){const t=e.project.features.filter(o=>e.selectedFeatureIds.includes(o.properties.id));t.length!==0&&(e.clipboard=t.map(o=>JSON.parse(JSON.stringify(o))))}function Wr(t){if(!e.clipboard||e.clipboard.length===0)return;const o=e.gridSize||20,n=e.clipboard.map(r=>{const l=JSON.parse(JSON.stringify(r.geometry)),i=m=>{m.forEach(p=>{Array.isArray(p[0])?i(p):(p[0]+=o,p[1]+=o)})};"coordinates"in l&&i(l.coordinates);const s=`feat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=`${r.properties.label}`;return{type:"Feature",geometry:l,properties:{...r.properties,id:s,label:a,floor:e.activeFloorId}}});e.project.features.push(...n),e.selectedFeatureIds=n.map(r=>r.properties.id),k(),M(),t(),B()}let Ce=null,Be=null,kt=null,Me=null;function Kr(t){Ce=t.propertiesContent,Be=t.propertiesPlaceholder,kt=t.propertiesLabelInput,Me=t.propertiesTypeSelect}function R(){if(!Ce||!Be||!kt||!Me)return;if(e.selectedFeatureIds.length!==1){Ce.style.display="none",Be.style.display="block";return}Ce.style.display="block",Be.style.display="none";const t=e.selectedFeatureIds[0],o=e.project.features.find(h=>h.properties.id===t);if(!o){Ce.style.display="none",Be.style.display="block";return}kt.value=o.properties.label,Me.innerHTML="";const n=K(),r=o.geometry.type==="Polygon"||o.geometry.type==="Point"?n[o.properties.subType]?.baseType:null;if(r){for(const h in n)if(n[h].baseType===r){const x=document.createElement("option");x.value=h,x.textContent=n[h].label,Me.appendChild(x)}Me.value=o.properties.subType}const l=document.getElementById("beacon-fields"),i=document.getElementById("beacon-uuid-input"),s=document.getElementById("beacon-major-input"),a=document.getElementById("beacon-minor-input"),m=document.getElementById("beacon-installation-input"),p=document.getElementById("beacon-range-input"),v=document.getElementById("beacon-number-input"),g=document.getElementById("beacon-note-de-input"),b=document.getElementById("beacon-note-en-input");if(l){const h=o.geometry.type==="Point"&&o.properties.subType==="beacon";l.style.display=h?"block":"none",h&&(i&&(i.value=o.properties.beacon_uuid||""),s&&(s.value=o.properties.beacon_major?.toString()||""),a&&(a.value=o.properties.beacon_minor?.toString()||""),m&&(m.value=o.properties.beacon_installation||""),p&&(p.value=o.properties.beacon_range!==void 0?String(o.properties.beacon_range):""),v&&(v.value=o.properties.beacon_number!==void 0?String(o.properties.beacon_number):""),g&&(g.value=o.properties.beacon_note_de||""),b&&(b.value=o.properties.beacon_note_en||""))}const c=document.getElementById("properties-description-input"),d=document.getElementById("properties-opening-hours-input");c&&(c.value=o.properties.description||""),d&&(d.value=o.properties.opening_hours||"")}function rn(){const t=document.getElementById("mode-merge");if(!t)return;const o=t.querySelector("span"),l=e.project.features.filter(s=>s.properties.floor===e.activeFloorId).filter(s=>e.selectedFeatureIds.includes(s.properties.id)&&(s.geometry.type==="Polygon"||s.geometry.type==="LineString"&&s.properties.subType==="arc")).length,i=u("merge");o&&(o.textContent=l>0?`${i} (${l})`:i),l>=2?t.classList.add("merge-ready"):t.classList.remove("merge-ready")}let N=null,fe=null,he=null,be=null,ve=null,Ct={x:0,y:0},Bt={x:0,y:0},ln=!1,sn=!1;function Ur(t){N=t.canvas,fe=t.scrollbarX,he=t.scrollbarY,be=t.thumbX,ve=t.thumbY}function Ze(t){return{x:(t.x-e.pan.x)/e.scale,y:(t.y-e.pan.y)/e.scale}}function Ee(){const{scale:t,worldSize:o}=e;if(!N||!N.parentElement)return;const n=N.parentElement.clientWidth,r=N.parentElement.clientHeight,l=o.width*t,i=o.height*t;if(l<n)e.pan.x=(n-l)/2;else{const a=n-l;e.pan.x=Math.min(e.pan.x,0),e.pan.x=Math.max(e.pan.x,a)}if(i<r)e.pan.y=(r-i)/2;else{const a=r-i;e.pan.y=Math.min(e.pan.y,0),e.pan.y=Math.max(e.pan.y,a)}}function Qe(){const{scale:t,pan:o,worldSize:n}=e;if(!N||!N.parentElement||!fe||!he||!be||!ve)return;const{clientWidth:r,clientHeight:l}=N.parentElement,i=n.width*t,s=i>r&&r>0;if(fe.style.display=s?"block":"none",s){const p=fe.clientWidth,v=r/i*p,g=Math.max(v,20),b=Math.max(i-r,0),c=10,d=Math.max(p-g-2*c,0),h=b>0?-o.x/b*d:0;be.style.width=`${g}px`;const x=1,I=Math.abs(o.x-(r-i))<=x,w=Math.abs(o.x-0)<=x&&i>=r,P=I?c+d:w?c:c+Math.max(0,Math.min(h,d));be.style.left=`${P}px`}const a=n.height*t,m=a>l&&l>0;if(he.style.display=m?"block":"none",m){const p=he.clientHeight,v=l/a*p,g=Math.max(v,20),b=Math.max(a-l,0),c=10,d=Math.max(p-g-2*c,0),h=b>0?-o.y/b*d:0;ve.style.height=`${g}px`;const x=1,I=Math.abs(o.y-(l-a))<=x,w=Math.abs(o.y-0)<=x&&a>=l,P=I?c+d:w?c:c+Math.max(0,Math.min(h,d));ve.style.top=`${P}px`}}function Jr(t){t.preventDefault(),e.isPanning=!0,e.panStart={x:t.clientX,y:t.clientY},N&&(N.style.cursor="grabbing")}function Yr(t){if(!e.isPanning)return;const o=t.clientX-e.panStart.x,n=t.clientY-e.panStart.y;e.pan.x+=o,e.pan.y+=n,e.panStart={x:t.clientX,y:t.clientY},Ee(),M(),Qe()}function Xr(){!e.isPanning||!N||(e.isPanning=!1,e.currentMode==="pan"||e.currentMode==="move-element"?N.style.cursor="grab":e.currentMode==="select"?N.style.cursor="default":N.style.cursor="crosshair")}function Mn(t){t.stopPropagation(),Ct={x:t.clientX,y:t.clientY},Bt={...e.pan},t.target===be&&(ln=!0),t.target===ve&&(sn=!0),document.addEventListener("mousemove",Io),document.addEventListener("mouseup",Zr,{once:!0})}function Io(t){if(!(!fe||!he)){if(ln){const o=t.clientX-Ct.x,n=fe.clientWidth,r=N?.parentElement?.clientWidth||0,l=e.worldSize.width*e.scale,i=be?.clientWidth||0,s=Math.max(l-r,0),m=Math.max(n-i-2*10,1);if(n>0&&s>0){const p=o/m*s;e.pan.x=Bt.x-p}Ee(),M(),Qe()}if(sn){const o=t.clientY-Ct.y,n=he.clientHeight,r=N?.parentElement?.clientHeight||0,l=e.worldSize.height*e.scale,i=ve?.clientHeight||0,s=Math.max(l-r,0),m=Math.max(n-i-2*10,1);if(n>0&&s>0){const p=o/m*s;e.pan.y=Bt.y-p}Ee(),M(),Qe()}}}function Zr(){ln=!1,sn=!1,document.removeEventListener("mousemove",Io)}let Z=null;function Qr(t){Z=t.canvas}function el(t){e.selectedFeatureIds.length>0&&(e.isMovingElement=!0,e.dragStartPos=t,e.originalGeometriesOnMove.clear(),e.project.features.forEach(o=>{e.selectedFeatureIds.includes(o.properties.id)&&(e.originalGeometriesOnMove.set(o.properties.id,JSON.parse(JSON.stringify(o.geometry))),o.properties.controlPoints&&(o.properties.originalControlPoints=JSON.parse(JSON.stringify(o.properties.controlPoints))))}),Z&&(Z.style.cursor="move"))}function tl(t){if(!e.isMovingElement||e.selectedFeatureIds.length===0)return;const o=t.x-e.dragStartPos.x,n=t.y-e.dragStartPos.y,r=(l,i,s)=>{l.forEach(a=>{Array.isArray(a[0])?r(a,i,s):(a[0]+=i,a[1]+=s)})};e.project.features.forEach(l=>{if(e.selectedFeatureIds.includes(l.properties.id)){const i=e.originalGeometriesOnMove.get(l.properties.id);if(i){const a=JSON.parse(JSON.stringify(i));"coordinates"in a&&(r(a.coordinates,o,n),l.geometry=a)}const s=l.properties.originalControlPoints;s&&(l.properties.controlPoints={p0:{x:s.p0.x+o,y:s.p0.y+n},p1:{x:s.p1.x+o,y:s.p1.y+n},p2:{x:s.p2.x+o,y:s.p2.y+n}})}}),M()}function nl(){e.isMovingElement&&(e.isMovingElement=!1,e.originalGeometriesOnMove.clear(),e.project.features.forEach(t=>delete t.properties.originalControlPoints),Z&&(Z.style.cursor="default"),k())}function ol(t){if(e.selectedFeatureIds.length!==1)return!1;const o=e.project.features.find(l=>l.properties.id===e.selectedFeatureIds[0]);if(!o||o.geometry.type!=="LineString"&&o.geometry.type!=="Polygon")return!1;const n=8/e.scale;let r=[];if(o.geometry.type==="LineString"&&o.properties.subType==="arc"&&o.properties.controlPoints){const{p0:l,p1:i,p2:s}=o.properties.controlPoints;r=[l,i,s]}else{const l=o.geometry.type==="LineString"?o.geometry.coordinates:o.geometry.coordinates[0];r=(o.geometry.type==="Polygon"?l.slice(0,-1):l).map(s=>({x:s[0],y:s[1]}))}for(let l=0;l<r.length;l++)if(Math.sqrt((t.x-r[l].x)**2+(t.y-r[l].y)**2)<n)return e.isEditingPath=!0,e.editedFeatureId=o.properties.id,e.editedNodeIndex=l,Z&&(Z.style.cursor="grabbing"),!0;return!1}function rl(t){if(!e.isEditingPath||!e.editedFeatureId)return;const o=e.project.features.find(r=>r.properties.id===e.editedFeatureId);if(!o)return;const n=dt(Q(t));if(o.geometry.type==="LineString"&&o.properties.subType==="arc"&&o.properties.controlPoints){const r=o.properties.controlPoints;e.editedNodeIndex===0?r.p0=n:e.editedNodeIndex===1?r.p1=n:e.editedNodeIndex===2&&(r.p2=n),o.geometry.coordinates=De(r.p0,r.p2,r.p1)}else if(o.geometry.type==="LineString")o.geometry.coordinates[e.editedNodeIndex]=[n.x,n.y];else if(o.geometry.type==="Polygon"){const r=o.geometry.coordinates[0];r[e.editedNodeIndex]=[n.x,n.y],e.editedNodeIndex===0&&(r[r.length-1]=[n.x,n.y])}M()}function ll(){!e.isEditingPath||!Z||(e.isEditingPath=!1,Z.style.cursor="default",k())}function il(t,o){const n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),l=parseInt(t.slice(5,7),16);return`rgba(${n}, ${r}, ${l}, ${o})`}let mt=null,le=null,an=null,cn=null,te=null,Mt=null,dn=null,So=null,pn=null,un=null,wo=null,Lt=null,Ke=null,mn=null,yn=null,Po=null,gn=null,fn=null,Tt=null,Ft=null,jt=null,Ue=null,_t=null,Le=null,Te=null,zt=null,Fe=null,Je=null,Ye=null,z=null;function sl(t){mt=t.typeManagerModal,le=t.typeManagerList,an=t.typeManagerDetailsContent,cn=t.typeManagerPlaceholder,te=t.typeNameInput,Mt=t.typeEditorArea,dn=t.typeFillColorInput,So=t.typeFillColorSwatch,pn=t.typeFillOpacitySlider,un=t.typeStrokeColorInput,wo=t.typeStrokeColorSwatch,Lt=t.typeEditorPoint,Ke=t.typeIconLibrary,mn=t.typeIconColorInput,yn=t.typeManagerDeleteBtn,Po=t.newTypeChoiceModal,gn=t.typeFontColorInput,fn=t.typeFontSizeInput,Tt=t.typeTextStyleHeader,Ft=t.typeAreaStyleHeader,jt=t.typePointStyleHeader,Ue=t.typePreviewContainer,_t=t.typePreviewHeader,Le=t.typePreviewArea,Te=t.typePreviewAreaRect,zt=t.typePreviewAreaLabel,Fe=t.typePreviewPoint,Je=t.typePreviewPointIcon,Ye=t.typePreviewPointLabel}function al(){e.styleOverrides=JSON.parse(JSON.stringify(K())),Oe(),pl(),Mo(),mt.classList.remove("hidden")}function Ln(){mt.classList.add("hidden"),z=null,e.styleOverrides=null,yt(void 0),M()}function cl(){if(!e.styleOverrides)return;e.project.properties.elementTypeStyles||(e.project.properties.elementTypeStyles={});const t=e.project.properties.elementTypeStyles;Object.keys(e.styleOverrides).forEach(o=>{const n=e.styleOverrides[o];n.isDefault?delete t[o]:t[o]={label:n.label,baseType:n.baseType,fill:n.fill,stroke:n.stroke,icon:n.icon,iconColor:n.iconColor,fontSize:n.fontSize,fontColor:n.fontColor}}),Object.keys(t).forEach(o=>{e.styleOverrides[o]||delete t[o]}),k(),ue(),B(),e.styleOverrides=null,M(),mt.classList.add("hidden")}function Oe(){if(!e.styleOverrides||!le)return;le.innerHTML="";const t={},o={};for(const l in e.styleOverrides){const i=e.styleOverrides[l];i.baseType==="area"?t[l]=i:o[l]=i}const n=l=>{const i=document.createElement("li");return i.textContent=l,i.style.cssText="font-weight: bold; padding: 12px 8px 4px; color: var(--color-primary); background-color: var(--color-secondary); border-bottom: 1px solid var(--color-border);",i},r=(l,i)=>{const s=document.createElement("li");if(s.style.cssText="cursor: pointer; padding: 8px; border-bottom: 1px solid var(--color-border); display: flex; align-items: center; gap: 8px;",i.baseType==="area"){const p=document.createElement("div");p.style.cssText=`width: 16px; height: 16px; border-radius: 4px; background-color: ${i.fill||"transparent"}; border: 1px solid ${i.stroke||"black"}; flex-shrink: 0;`,s.appendChild(p)}else if(i.baseType==="point"&&i.icon){const p="http://www.w3.org/2000/svg",v=document.createElementNS(p,"svg");v.setAttribute("viewBox","0 0 24 24"),v.style.cssText=`width: 16px; height: 16px; fill: ${i.iconColor||"black"}; flex-shrink: 0;`;const g=document.createElementNS(p,"path");g.setAttribute("d",i.icon),v.appendChild(g),s.appendChild(v)}const a=document.createElement("span"),m=i.isDefault?"":" (Cust.)";if(a.textContent=i.label+m,s.appendChild(a),s.dataset.subType=l,l===z){s.style.backgroundColor="var(--color-accent)",s.style.color="white";const p=s.querySelector("svg");p&&(p.style.fill="white")}return s.addEventListener("click",()=>{z=l,Oe(),ko(l)}),s};Object.keys(t).length>0&&(le.appendChild(n(u("areasGroup"))),Object.keys(t).sort((i,s)=>t[i].label.localeCompare(t[s].label)).forEach(i=>le.appendChild(r(i,t[i])))),Object.keys(o).length>0&&(le.appendChild(n(u("pointsConnectorsGroup"))),Object.keys(o).sort((i,s)=>o[i].label.localeCompare(o[s].label)).forEach(i=>le.appendChild(r(i,o[i]))))}function ko(t){if(!e.styleOverrides)return;cn.classList.add("hidden"),an.classList.remove("hidden");const o=e.styleOverrides[t];if(te.value=o.label,fn.value=(o.fontSize||(o.baseType==="area"?14:12)).toString(),gn.value=o.fontColor||(e.activeTheme==="dark"?"#e6e1ef":"#000000"),Tt&&(Tt.style.display="block"),Ft&&(Ft.style.display=o.baseType==="area"?"block":"none"),jt&&(jt.style.display=o.baseType==="point"?"block":"none"),o.baseType==="area"){Mt.style.display="block",Lt.style.display="none";const{hex:n,alpha:r}=ml(o.fill||"rgba(0,0,0,0.5)");dn.value=n,pn.value=r.toString(),un.value=o.stroke||"#000000"}else Mt.style.display="none",Lt.style.display="block",mn.value=o.iconColor||"#34495e",document.querySelectorAll("#type-icon-library div").forEach(n=>{const r=n.querySelector("svg");r&&r.dataset.iconPath===o.icon?n.classList.add("active"):n.classList.remove("active")});Bo(),yt(o),te.disabled=!!o.isDefault,yn.style.display=o.isDefault?"none":"block"}function Co(){if(!z||!e.styleOverrides)return;const t=e.styleOverrides[z];if(t.isDefault&&(t.isDefault=!1,te.disabled=!1,yn.style.display="block"),te.value=te.value.trim(),!!te.value){t.label=te.value,t.fontSize=parseInt(fn.value)||(t.baseType==="area"?14:12),t.fontColor=gn.value,t.baseType==="area"?(t.fill=il(dn.value,parseFloat(pn.value)),t.stroke=un.value):t.iconColor=mn.value,Bo(),yt(t);try{Oe()}catch{}M()}}async function Tn(t){if(!e.styleOverrides)return;Po.classList.add("hidden");const o=u("prompt_newFloorName"),n=u(t==="area"?"newAreaType":"newPointType"),r=await Lo(o,n);if(!r||r.trim()==="")return;const l=`custom_${r.trim().toLowerCase().replace(/[^a-z0-9]/gi,"_")}_${Date.now()}`,i=e.activeTheme==="dark";t==="area"?e.styleOverrides[l]={label:r.trim(),baseType:"area",fill:"rgba(128, 128, 128, 0.5)",stroke:"#808080",fontSize:14,fontColor:i?"#e6e1ef":"#000000",isDefault:!1}:e.styleOverrides[l]={label:r.trim(),baseType:"point",icon:xt.info,iconColor:"#34495e",fontSize:12,fontColor:i?"#e6e1ef":"#000000",isDefault:!1},z=l,Oe(),ko(l)}async function dl(){!z||!e.styleOverrides||e.styleOverrides[z].isDefault||!await To(u("alert_deleteTypeConfirm",e.activeLanguage,e.styleOverrides[z].label))||!z||!e.styleOverrides||(delete e.styleOverrides[z],Mo(),Oe(),M())}function pl(){if(Ke){Ke.innerHTML="";for(const t in xt){const o=xt[t],n=document.createElement("div");n.style.cssText="padding: 4px; border: 1px solid transparent; border-radius: 4px; cursor: pointer;";const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox","0 0 24 24"),r.style.width="32px",r.style.height="32px",r.style.fill="currentColor";const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",o),r.appendChild(l),r.dataset.iconPath=o,n.appendChild(r),n.addEventListener("click",()=>{!z||!e.styleOverrides||(e.styleOverrides[z].icon=o,document.querySelectorAll("#type-icon-library > div").forEach(i=>i.classList.remove("active")),n.classList.add("active"),Co())}),Ke.appendChild(n)}}}function Bo(){if(!z||!e.styleOverrides)return;const t=e.styleOverrides[z];t.baseType==="area"&&(So.style.backgroundColor=t.fill||"transparent",wo.style.backgroundColor=t.stroke||"transparent")}function ul(){return e.activeTheme==="dark"?"#e6e1ef":"#1f2933"}function yt(t){if(!Ue||!Le||!Fe)return;if(!t){Ue.classList.add("hidden"),Le.style.display="none",Fe.style.display="none";return}Ue.classList.remove("hidden"),_t&&(_t.textContent=u("typePreview"));const o=t.fontColor||ul(),n=t.baseType==="area"?u("previewAreaLabel"):u("previewPointLabel");if(t.baseType==="area"){if(Le.style.display="block",Fe.style.display="none",Te){const r=t.fill||Y.default.fill,l=t.stroke||Y.default.stroke;Te.style.background=r,Te.style.borderColor=l,Te.style.color=o}zt&&(zt.textContent=t.label||n)}else{Le.style.display="none",Fe.style.display="flex";const r=t.icon||Xe.default,l=t.iconColor||"#34495e";if(Je){Je.innerHTML=`<svg viewBox="0 0 24 24" role="img" aria-hidden="true"><path d="${r}"></path></svg>`;const i=Je.querySelector("svg");i&&(i.style.width="36px",i.style.height="36px",i.style.fill=l)}Ye&&(Ye.textContent=t.label||n,Ye.style.color=o)}}function Mo(){cn.classList.remove("hidden"),an.classList.add("hidden"),z=null,yt(void 0)}function ml(t){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(!o)return{hex:"#000000",alpha:1};const n=i=>("0"+i.toString(16)).slice(-2),r=`#${n(parseInt(o[1]))}${n(parseInt(o[2]))}${n(parseInt(o[3]))}`,l=o[4]!==void 0?parseFloat(o[4]):1;return{hex:r,alpha:l}}let Lo=async()=>null,To=async()=>!1;function yl(t){Lo=t.showInputPrompt,To=t.showConfirm}function gl(t){if(t.length<1)return t;const o=t[0],n=t[t.length-1];return(o[0]!==n[0]||o[1]!==n[1])&&t.push([o[0],o[1]]),t}function fl(t,o){const n=t.slice(0,-1),r=o.slice(0,-1),l=r.map((a,m)=>({a:{x:a[0],y:a[1]},b:{x:r[(m+1)%r.length][0],y:r[(m+1)%r.length][1]}})),i=[];for(let a=0;a<n.length;a++){const m={x:n[a][0],y:n[a][1]},p={x:n[(a+1)%n.length][0],y:n[(a+1)%n.length][1]},v=[];l.forEach(b=>{const c=on(m,p,b.a,b.b);if(c){const d=p.x-m.x,h=p.y-m.y,x=d*d+h*h,I=x===0?0:((c.x-m.x)*d+(c.y-m.y)*h)/x;I>=0&&I<=1&&v.push({t:I,p:c})}}),v.sort((b,c)=>b.t-c.t);const g=[{x:m.x,y:m.y},...v.map(b=>b.p),{x:p.x,y:p.y}];for(let b=0;b<g.length-1;b++){const c=g[b],d=g[b+1],h={x:(c.x+d.x)/2,y:(c.y+d.y)/2};J(h,{coordinates:[o]})||(i.length===0&&i.push([c.x,c.y]),i.push([d.x,d.y]))}}const s=[];for(let a=0;a<i.length;a++){const m=s[s.length-1],p=i[a];(!m||m[0]!==p[0]||m[1]!==p[1])&&s.push(p)}return s}function Fo(t,o){const n=t.slice(0,-1),r=o.slice(0,-1),l=[];for(let b=0;b<n.length;b++){const c={x:n[b][0],y:n[b][1]},d={x:n[(b+1)%n.length][0],y:n[(b+1)%n.length][1]};for(let h=0;h<r.length;h++){const x={x:r[h][0],y:r[h][1]},I={x:r[(h+1)%r.length][0],y:r[(h+1)%r.length][1]},w=on(c,d,x,I);w&&l.push(w)}}const i={coordinates:[t]},s={coordinates:[o]};if(n.forEach(b=>{J({x:b[0],y:b[1]},s)&&l.push({x:b[0],y:b[1]})}),r.forEach(b=>{J({x:b[0],y:b[1]},i)&&l.push({x:b[0],y:b[1]})}),l.length===0)return null;const a=l.reduce((b,c)=>b+c.x,0)/l.length,m=l.reduce((b,c)=>b+c.y,0)/l.length,p={x:a,y:m};if(J(p,i)&&J(p,s))return[p.x,p.y];const g=l.find(b=>J(b,i)&&J(b,s));return g?[g.x,g.y]:null}function hl(t,o){const r=[t[0]];for(let i=0;i<t.length-1;i++){const s={x:t[i][0],y:t[i][1]},a={x:t[i+1][0],y:t[i+1][1]},m=a.x-s.x,p=a.y-s.y,v=Math.sqrt(m*m+p*p);if(v<1e-6)continue;const g=m/v,b=p/v,c=[];for(let x=0;x<o.length-1;x++){const I={x:o[x][0],y:o[x][1]},w={x:o[x+1][0],y:o[x+1][1]},P=w.x-I.x,C=w.y-I.y,T=m*C-p*P,F=(I.x-s.x)*p-(I.y-s.y)*m;if(Math.abs(T)<1e-6&&Math.abs(F)<1e-6){const D=(I.x-s.x)*g+(I.y-s.y)*b,O=(w.x-s.x)*g+(w.y-s.y)*b,ee=Math.max(0,Math.min(D,O)),Ie=Math.min(v,Math.max(D,O));Ie-ee>1e-6&&c.push({a:ee,b:Ie})}}if(c.length===0){r.push([a.x,a.y]);continue}c.sort((x,I)=>x.a-I.a);const d=[];for(const x of c)d.length===0||x.a>d[d.length-1].b+1e-6?d.push({a:x.a,b:x.b}):d[d.length-1].b=Math.max(d[d.length-1].b,x.b);let h=0;for(const x of d){if(x.a-h>1e-6){const I=s.x+g*h,w=s.y+b*h,P=s.x+g*x.a,C=s.y+b*x.a;(r.length===0||r[r.length-1][0]!==I||r[r.length-1][1]!==w)&&r.push([I,w]),r.push([P,C])}h=Math.max(h,x.b)}if(v-h>1e-6){const x=s.x+g*h,I=s.y+b*h,w=a.x,P=a.y;(r.length===0||r[r.length-1][0]!==x||r[r.length-1][1]!==I)&&r.push([x,I]),r.push([w,P])}}const l=[];for(let i=0;i<r.length;i++){const s=l[l.length-1],a=r[i];(!s||s[0]!==a[0]||s[1]!==a[1])&&l.push(a)}return l}function jo(t,o){for(let r=0;r<t.length-1;r++){const l={x:t[r][0],y:t[r][1]},i={x:t[r+1][0],y:t[r+1][1]};for(let s=0;s<o.length-1;s++){const a={x:o[s][0],y:o[s][1]},m={x:o[s+1][0],y:o[s+1][1]},p=on(l,i,a,m);if(p)return[p.x,p.y];const v=i.x-l.x,g=i.y-l.y,b=m.x-a.x,c=m.y-a.y,d=v*c-g*b,h=(a.x-l.x)*g-(a.y-l.y)*v;if(Math.abs(d)<1e-6&&Math.abs(h)<1e-6){const x=Math.sqrt(v*v+g*g);if(x<1e-6)continue;const I=v/x,w=g/x,P=(a.x-l.x)*I+(a.y-l.y)*w,C=(m.x-l.x)*I+(m.y-l.y)*w,T=Math.max(0,Math.min(P,C)),F=Math.min(x,Math.max(P,C));if(F-T>1e-6){const D=(T+F)/2,O=l.x+I*D,ee=l.y+w*D;return[O,ee]}}}}return null}let je=null,V=null,$,Fn,jn,Nt,Dt,_o,zo,At,ae,Ot,xe,No,Do,A,Ao,Oo,_n,zn,et,tt,$t,qt,Nn,Ht,$o,qo,Dn,Rt,Vt,Gt,nt,An,On,$n,qn,Hn,Rn,Vn,Gn,Wn,Kn,Un,Jn,Wt,Ho,Yn,Xn,Zn,Kt,Qn,Ut,eo,Jt,Yt,to,no,oo,Xt,Ro,Zt,Vo,Go,ot,Wo,Ko,Uo,Qt,G,hn,bn,ze,Ne,en,tn,rt,lt,it,ro,st,lo,io,at,so,ao,ct,vn;function bl(t,o){let n;return function(){clearTimeout(n),n=window.setTimeout(t,o)}}const bt=bl(M,50);function xn(){const t=`mode-${e.currentMode}`,o=document.getElementById(t);e.tempShape&&e.currentMode!=="select"&&e.currentMode!=="pan"&&e.currentMode!=="move-element"?(document.querySelectorAll(".tool-btn").forEach(n=>n.classList.remove("has-temp-shape")),o&&o.classList.add("has-temp-shape")):document.querySelectorAll(".tool-btn").forEach(n=>n.classList.remove("has-temp-shape"))}function L(){M(),Qe(),xn(),ke();const t=document.getElementById("floor3DView"),o=document.getElementById("floor3DRenderer");t&&t.style.display==="flex"&&o&&je&&je.render3DFloorStack(e.project,"floor3DRenderer")}function vl(t){t.preventDefault();const o=.1,n=e.scale,r={x:t.offsetX,y:t.offsetY},l=Ze(r),i=t.deltaY<0?n*(1+o):n/(1+o);e.scale=Math.max(.1,Math.min(i,10)),e.pan.x=r.x-l.x*e.scale,e.pan.y=r.y-l.y*e.scale,Ee(),L()}function xl(t){if(e.currentMode==="scissors"){const r=e.project.features.filter(a=>a.properties.floor===e.activeFloorId&&a.properties.type==="area"&&!a.properties.isPlaceholder&&a.geometry.type==="Polygon"&&J(t,a.geometry)),l=e.project.features.filter(a=>a.properties.floor===e.activeFloorId&&a.geometry.type==="LineString"&&xo(t,a.geometry));let i,s;if(e.selectedFeatureIds.length===1){const a=e.project.features.find(m=>m.properties.id===e.selectedFeatureIds[0]);a?.geometry.type==="Polygon"?(i=a,s=r.find(m=>m.properties.id!==i?.properties.id)):a?.geometry.type==="LineString"&&(i=a,s=l.find(m=>m.properties.id!==i?.properties.id))}else{i=r[0]||l[0];const a=i&&i.geometry.type==="Polygon"?r:l;s=a&&a.length>1?a[1]:void 0}if(i&&s){if(i.geometry.type==="Polygon"&&s.geometry.type==="Polygon"){const a=i.geometry.coordinates[0],m=s.geometry.coordinates[0],p=fl(a,m);if(p.length>=4){const v=Fo(a,m);i.geometry.coordinates[0]=gl(p),v&&e.activeFloorId&&de({type:"Point",coordinates:v},{id:`feat_${Date.now()}`,floor:e.activeFloorId,type:"point",subType:"meeting-point",label:u("previewPointLabel")}),k(),e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,L(),B();return}}else if(i.geometry.type==="LineString"&&s.geometry.type==="LineString"){const a=i.geometry.coordinates,m=s.geometry.coordinates,p=jo(a,m),v=hl(a,m);if(v.length>=2){i.geometry.coordinates=v,p&&e.activeFloorId&&de({type:"Point",coordinates:p},{id:`feat_${Date.now()}`,floor:e.activeFloorId,type:"point",subType:"meeting-point",label:u("previewPointLabel")}),k(),e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,L(),B();return}}}else{const a=e.hoveredFeatureId||ne(t)?.properties.id||null;if(a){const m=e.project.features.find(p=>p.properties.id===a);if(m&&m.geometry.type==="Polygon"&&e.hoveredEdgeIndex!==-1){const p=m.geometry.coordinates[0],v=e.hoveredEdgeIndex+1;if(p.length>4&&v>0&&v<p.length){p.splice(v,1),p[p.length-1]=p[0],k(),e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,L(),B();return}}}}}if(e.currentMode==="select"&&e.isAltPressed&&e.hoveredEdgeIndex!==-1&&e.hoveredFeatureId){const r=e.project.features.find(l=>l.properties.id===e.hoveredFeatureId);if(r&&r.geometry.type==="Polygon"){const l=[t.x,t.y];r.geometry.coordinates[0].splice(e.hoveredEdgeIndex+1,0,l),k(),e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,L();return}}const o=Q(t),n=e.currentMode==="line"||e.currentMode==="arc"||e.currentMode==="point"?dt(o):o;switch(e.currentMode){case"area":Br(n);break;case"square":Mr(n);break;case"polygon":Fr(n);break;case"circle":Lr(n);break;case"line":Tr(n);break;case"arc":_r(n);break;case"point":jr(n);break;case"select":Il(t);break;case"merge":{const r=ne(t);if(r){const l=r.properties.id,i=e.selectedFeatureIds.indexOf(l);i>-1?e.selectedFeatureIds.splice(i,1):e.selectedFeatureIds.push(l),xe.disabled=e.selectedFeatureIds.length===0,R(),rn(),L()}break}}xn()}function El(){const t=e.selectedFeatureIds.slice(),o=e.project.features.filter(g=>t.includes(g.properties.id)&&g.properties.floor===e.activeFloorId),n=o.filter(g=>g.geometry.type==="Polygon"),r=o.filter(g=>g.geometry.type==="LineString");if(n.length<1||n.length+r.length<2){alert(u("alert_selectAtLeastTwo"));return}let l=null;if(n.length>0&&r.length===0&&n.every(g=>Dr(g.geometry))){const g=Ar(n.map(b=>b.geometry));g&&g.length>=4&&(l=g)}if(!l){const g=[];for(const d of n){const h=d.geometry.coordinates[0];for(let x=0;x<h.length-1;x++)g.push({x:h[x][0],y:h[x][1]})}for(const d of r)if(d.properties.subType==="arc"&&d.properties.controlPoints){const{p0:h,p1:x,p2:I}=d.properties.controlPoints;De(h,I,x,24).forEach(([P,C])=>g.push({x:P,y:C}))}else d.geometry.coordinates.forEach(([x,I])=>g.push({x,y:I}));if(g.length<3){alert(u("alert_notEnoughPoints"));return}const b=Or(g);if(b.length<3){alert(u("alert_notEnoughPoints"));return}const c=b.map(d=>[d.x,d.y]);c.push([b[0].x,b[0].y]),l=c}const s=K(),a=Object.keys(s).find(g=>s[g].baseType==="area")||"raum",m=s[a]?.label||"Raum",p=e.project.features.filter(g=>g.properties.type==="area").length+1,v={type:"Feature",geometry:{type:"Polygon",coordinates:[l]},properties:{id:`feat_${Date.now()}`,floor:e.activeFloorId,type:"area",subType:a,label:`${m} ${p}`}};e.project.features.push(v),k(),L(),B()}function Il(t){const o=ne(t),n=o?o.properties.id:null;if(e.isCtrlPressed){if(n){const r=e.selectedFeatureIds.indexOf(n);r>-1?e.selectedFeatureIds.splice(r,1):e.selectedFeatureIds.push(n)}}else e.selectedFeatureIds=n?[n]:[];xe.disabled=e.selectedFeatureIds.length===0,R(),rn(),L()}function co(t){const o=Ot.querySelector(`option[data-type="${t}"]`);Ot.querySelectorAll("optgroup").forEach(n=>{let r=!1;n.querySelectorAll("option").forEach(l=>{l.dataset.type===t?(l.style.display="",r=!0):l.style.display="none"}),n.style.display=r?"":"none"}),o&&(o.selected=!0)}function $e(){Eo()}function Sl(t){t.preventDefault(),Eo();const o=Ze({x:t.offsetX,y:t.offsetY}),n=ne(o);n&&(e.selectedFeatureIds.includes(n.properties.id)||(e.selectedFeatureIds=[n.properties.id],L(),R()),e.selectedFeatureIds.length!==0&&(Rr(n,()=>R()),Vr(t.clientX,t.clientY,e.selectedFeatureIds.length)))}async function wl(){if(e.selectedFeatureIds.length!==1){alert(u("alert_renameSelectOne"));return}const t=e.project.features.find(n=>n.properties.id===e.selectedFeatureIds[0]);if(!t)return;const o=await ie(u("prompt_renameElement"),t.properties.label);o&&o.trim()!==""&&(t.properties.label=o.trim(),k(),M(),R(),B())}function po(){const t=[],o=e.gridSize||20,n=e.project.features.filter(r=>e.selectedFeatureIds.includes(r.properties.id));n.length!==0&&(n.forEach(r=>{const l=`feat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i=`${r.properties.label} - Kopie`,s=JSON.parse(JSON.stringify(r.geometry)),a=p=>{p.forEach(v=>{Array.isArray(v[0])?a(v):(v[0]+=o,v[1]+=o)})};"coordinates"in s&&a(s.coordinates);const m={type:"Feature",properties:{...r.properties,id:l,label:i},geometry:s};t.push(m)}),e.project.features.push(...t),e.selectedFeatureIds=t.map(r=>r.properties.id),k(),L(),R(),B())}function Pl(){Gr()}function kl(){if(!e.activeFloorId)return;if(e.selectedFeatureIds.length!==2){alert(u("alert_selectTwo"));return}const[t,o]=e.selectedFeatureIds,n=e.project.features.find(i=>i.properties.id===t),r=e.project.features.find(i=>i.properties.id===o);if(!n||!r)return;if(n.properties.floor!==e.activeFloorId||r.properties.floor!==e.activeFloorId){alert(u("alert_sameFloor"));return}let l=null;if(n.geometry.type==="Polygon"&&r.geometry.type==="Polygon"){const i=n.geometry.coordinates[0],s=r.geometry.coordinates[0];l=Fo(i,s)}else n.geometry.type==="LineString"&&r.geometry.type==="LineString"&&(l=jo(n.geometry.coordinates,r.geometry.coordinates));if(!l){alert(u("alert_noOverlap"));return}de({type:"Point",coordinates:l},{id:`feat_${Date.now()}`,floor:e.activeFloorId,type:"point",subType:"meeting-point",label:u("previewPointLabel")}),k(),B(),M()}function Cl(){Wr(()=>R())}function U(){const t=document.getElementById("overview-stats-panel");if(!t)return;const o=e.project.properties.projectName||u("unnamedProject"),n=oe(),r=n.length,l=e.project.features.filter(m=>m.properties.type==="area"&&!m.properties.isPlaceholder).length,i=e.project.features.filter(m=>m.properties.type==="point").length;let s=`<div><span>${u("stat_project")}:</span><span class="value">${o}</span></div><div><span>${u("stat_floors")}:</span><span class="value">${r}</span></div><div><span>${u("stat_areas")}:</span><span class="value">${l}</span></div><div><span>${u("stat_points")}:</span><span class="value">${i}</span></div>`;t.innerHTML=s;const a=document.getElementById("overview-floor-list");a&&(a.innerHTML="",n.forEach(m=>{const p=e.project.features.filter(x=>x.properties.floor===m&&x.properties.type==="area"&&!x.properties.isPlaceholder).length,v=e.project.features.filter(x=>x.properties.floor===m&&x.properties.type==="point").length,g=document.createElement("div");g.className="floor-card";const b=document.createElement("img");b.className="floor-thumb",e.cachedFloorPlanImages[m]&&(b.src=e.cachedFloorPlanImages[m].src,g.classList.add("has-thumb"));const c=document.createElement("div");c.className="floor-meta";const d=document.createElement("div");d.className="name",d.textContent=m;const h=document.createElement("div");h.className="counts",h.textContent=`${u("stat_areas")}: ${p} · ${u("stat_points")}: ${v}`,c.appendChild(d),c.appendChild(h),g.appendChild(b),g.appendChild(c),g.addEventListener("click",()=>{e.activeFloorId=m,pe(),M()}),a.appendChild(g)}))}function Bl(){$=document.getElementById("canvas"),Fn=document.getElementById("scrollbar-x"),jn=document.getElementById("scrollbar-y"),Nt=document.getElementById("thumb-x"),Dt=document.getElementById("thumb-y"),_o=document.getElementById("crosshair-h"),zo=document.getElementById("crosshair-v"),At=document.getElementById("floor-select"),ae=document.getElementById("projectName"),Ot=document.getElementById("element-type-select"),xe=document.getElementById("deleteBtn"),No=document.getElementById("element-options"),Do=document.getElementById("corner-box"),A=document.getElementById("info-modal"),Ao=document.getElementById("info-modal-close-btn"),Oo=A.querySelector(".modal-overlay"),_n=document.getElementById("properties-content"),zn=document.getElementById("properties-placeholder"),et=document.getElementById("properties-label-input"),tt=document.getElementById("properties-type-select"),$t=document.getElementById("properties-description-input"),qt=document.getElementById("properties-opening-hours-input"),Kr({propertiesContent:_n,propertiesPlaceholder:zn,propertiesLabelInput:et,propertiesTypeSelect:tt}),Nn=document.getElementById("context-menu"),Ht=document.getElementById("ctx-menu-copy"),$o=document.getElementById("ctx-menu-delete"),qo=document.getElementById("ctx-menu-rename"),Ht=document.getElementById("ctx-menu-copy"),Dn=document.getElementById("ctx-menu-type-submenu"),Rt=document.getElementById("ctx-floor-submenu"),Vt=document.getElementById("ctx-floor-add"),Gt=document.getElementById("ctx-floor-rename"),nt=document.getElementById("ctx-menu-add-overlap-point"),An=document.getElementById("input-prompt-modal"),On=document.getElementById("input-prompt-label"),$n=document.getElementById("input-prompt-input"),qn=document.getElementById("input-prompt-ok"),Hn=document.getElementById("input-prompt-cancel"),Rn=document.getElementById("confirm-modal"),Vn=document.getElementById("confirm-message"),Gn=document.getElementById("confirm-ok"),Wn=document.getElementById("confirm-cancel"),Kn=document.getElementById("loading-modal"),Un=document.getElementById("loading-message"),Jn=document.getElementById("loading-ok"),Wt=document.getElementById("type-manager-modal"),Ho=document.getElementById("type-manager-close-btn"),Yn=document.getElementById("type-manager-list"),Xn=document.getElementById("type-manager-details-content"),Zn=document.getElementById("type-manager-placeholder"),Kt=document.getElementById("type-name-input"),Qn=document.getElementById("type-editor-area"),Ut=document.getElementById("type-fill-color-input"),eo=document.getElementById("type-fill-color-swatch"),Jt=document.getElementById("type-fill-opacity-slider"),Yt=document.getElementById("type-stroke-color-input"),to=document.getElementById("type-stroke-color-swatch"),no=document.getElementById("type-editor-point"),oo=document.getElementById("type-icon-library"),Xt=document.getElementById("type-icon-color-input"),Ro=document.getElementById("type-manager-new-btn"),Zt=document.getElementById("type-manager-delete-btn"),Vo=document.getElementById("type-manager-save-btn"),Go=document.getElementById("manage-types-btn"),ot=document.getElementById("new-type-choice-modal"),Wo=document.getElementById("choose-type-area"),Ko=document.getElementById("choose-type-point"),Uo=document.getElementById("new-type-choice-cancel"),Qt=document.getElementById("lang-trigger"),G=document.getElementById("lang-menu"),hn=document.getElementById("active-lang-display"),bn=document.getElementById("theme-trigger"),ze=document.getElementById("theme-icon"),Ne=document.getElementById("lang-icon"),en=document.getElementById("type-font-color-input"),tn=document.getElementById("type-font-size-input"),rt=document.getElementById("type-text-style-header"),lt=document.getElementById("type-area-style-header"),it=document.getElementById("type-point-style-header"),ro=document.getElementById("type-preview"),st=document.getElementById("type-preview-header"),lo=document.getElementById("type-preview-area"),io=document.getElementById("type-preview-area-rect"),at=document.getElementById("type-preview-area-label"),so=document.getElementById("type-preview-point"),ao=document.getElementById("type-preview-point-icon"),ct=document.getElementById("type-preview-point-label"),Ur({canvas:$,scrollbarX:Fn,scrollbarY:jn,thumbX:Nt,thumbY:Dt}),Qr({canvas:$}),sl({typeManagerModal:Wt,typeManagerList:Yn,typeManagerDetailsContent:Xn,typeManagerPlaceholder:Zn,typeNameInput:Kt,typeEditorArea:Qn,typeFillColorInput:Ut,typeFillColorSwatch:eo,typeFillOpacitySlider:Jt,typeStrokeColorInput:Yt,typeStrokeColorSwatch:to,typeEditorPoint:no,typeIconLibrary:oo,typeIconColorInput:Xt,typeManagerDeleteBtn:Zt,newTypeChoiceModal:ot,typeFontColorInput:en,typeFontSizeInput:tn,typeTextStyleHeader:rt,typeAreaStyleHeader:lt,typePointStyleHeader:it,typePreviewContainer:ro,typePreviewHeader:st,typePreviewArea:lo,typePreviewAreaRect:io,typePreviewAreaLabel:at,typePreviewPoint:so,typePreviewPointIcon:ao,typePreviewPointLabel:ct}),yl({showInputPrompt:ie,showConfirm:pt}),vn=document.getElementById("renameFloorBtn"),xr({inputPromptModal:An,inputPromptLabel:On,inputPromptInput:$n,inputPromptOk:qn,inputPromptCancel:Hn,confirmModal:Rn,confirmMessage:Vn,confirmOk:Gn,confirmCancel:Wn,loadingModal:Kn,loadingMessage:Un,loadingOk:Jn}),Hr({contextMenu:Nn,ctxMenuTypeSubmenu:Dn,ctxMenuAddOverlapPoint:nt})}function Jo(){document.getElementById("backstage-close-btn").title=u("backToApp");const t=document.getElementById("backstage-panel");if(t&&t.classList.contains("visible")){const E=document.getElementById("backstage-title");if(E){const S=document.querySelector(".main-menu button.active")?.id.replace("-menu-trigger","");S==="file"?E.textContent=u("filePanelTitle"):S==="output"?E.textContent=u("outputPanelTitle"):S==="overview"&&(E.textContent=u("overviewPanelTitle"))}}{const S=document.getElementById("newProjectBtn")?.querySelector("span");S&&(S.textContent=u("newProject"))}{const S=document.getElementById("loadProjectBtn")?.querySelector("span");S&&(S.textContent=u("loadProject"))}{const S=document.getElementById("saveProjectBtn")?.querySelector("span");S&&(S.textContent=u("saveProject"))}{const S=document.getElementById("Einleitung")?.querySelector("span");S&&(S.textContent=u("introduction"))}{const S=document.getElementById("exportGeoJsonBtn")?.querySelector("span");S&&(S.textContent=u("exportGeoJson"))}const o=document.getElementById("showGeoJsonBtn"),n=document.getElementById("live-geojson-output"),r=n?n.style.display==="block":!1;{const E=o?.querySelector("span");E&&(E.textContent=u(r?"hideCode":"showLiveCode"))}const l=document.querySelector(".toolbar-section:nth-child(1) h2");l?.childNodes[0]&&(l.childNodes[0].textContent=u("project")+" ");const i=document.getElementById("projectName");{const E=i?.parentElement?.querySelector("label");E&&(E.textContent=u("projectName"))}i&&(i.placeholder=u("enterProjectName"));const s=document.querySelector(".toolbar-section:nth-child(2) h2");s?.childNodes[0]&&(s.childNodes[0].textContent=u("edit")+" ");{const S=document.getElementById("undoBtn")?.querySelector("span");S&&(S.textContent=u("undo"))}{const S=document.getElementById("redoBtn")?.querySelector("span");S&&(S.textContent=u("redo"))}const a=document.querySelector(".toolbar-section:nth-child(3) h2");a?.childNodes[0]&&(a.childNodes[0].textContent=u("floors")+" ");{const S=document.getElementById("floor-select")?.parentElement?.querySelector("label");S&&(S.textContent=u("currentFloor"))}{const S=document.getElementById("addFloorBtn")?.querySelector("span");S&&(S.textContent=u("newFloor"))}{const E=vn?.querySelector("span");E&&(E.textContent=u("rename"))}const m=document.querySelector("#floor-select + .button-group button:nth-child(3)");m&&(m.querySelector("span").textContent=u("floorplan"));const p=document.querySelector(".toolbar-section:nth-child(4) h2");p?.childNodes[0]&&(p.childNodes[0].textContent=u("tools")+" ");{const S=document.getElementById("mode-pan")?.querySelector("span");S&&(S.textContent=u("pan"))}{const S=document.getElementById("mode-select")?.querySelector("span");S&&(S.textContent=u("select"))}{const S=document.getElementById("mode-move-element")?.querySelector("span");S&&(S.textContent=u("moveElement"))}{const E=document.getElementById("mode-merge");if(E){const S=E.querySelector("span");S&&(S.textContent=u("merge"))}}{const S=document.getElementById("deleteBtn")?.querySelector("span");S&&(S.textContent=u("delete"))}{const E=document.querySelectorAll(".tool-buttons .toolbar-separator");E[0]&&(E[0].textContent=u("areas")),E[1]&&(E[1].textContent=u("linesAndPoints"))}{const S=document.getElementById("mode-area")?.querySelector("span");S&&(S.textContent=u("rectangle"))}{const S=document.getElementById("mode-square")?.querySelector("span");S&&(S.textContent=u("square"))}{const S=document.getElementById("mode-polygon")?.querySelector("span");S&&(S.textContent=u("polygon"))}if(Rt){const E=Rt.parentElement;E&&E.childNodes[0]&&(E.childNodes[0].textContent=u("floors"));const S=document.getElementById("ctx-floor-add");S&&(S.textContent=u("newFloor"));const Se=document.getElementById("ctx-floor-rename");Se&&(Se.textContent=u("renameFloor"))}{const S=document.getElementById("mode-circle")?.querySelector("span");S&&(S.textContent=u("circle"))}{const S=document.getElementById("mode-line")?.querySelector("span");S&&(S.textContent=u("line"))}{const S=document.getElementById("mode-arc")?.querySelector("span");S&&(S.textContent=u("arc"))}{const S=document.getElementById("mode-point")?.querySelector("span");S&&(S.textContent=u("point"))}{const S=document.getElementById("mode-area")?.querySelector("span");S&&(S.textContent=u("rectangle"))}{const S=document.getElementById("mode-square")?.querySelector("span");S&&(S.textContent=u("square"))}{const S=document.getElementById("element-type-select")?.parentElement?.querySelector("label");S&&(S.textContent=u("elementType"))}{const S=document.getElementById("manage-types-btn")?.querySelector("span");S&&(S.textContent=u("manageTypes"))}const v=document.querySelector("#properties-panel h2");v?.childNodes[0]&&(v.childNodes[0].textContent=u("properties")+" ");{const E=document.getElementById("properties-label-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("label"))}{const E=document.getElementById("beacon-uuid-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_uuid_label"))}{const E=document.getElementById("beacon-major-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_major_label"))}{const E=document.getElementById("beacon-minor-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_minor_label"))}{const E=document.getElementById("beacon-installation-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_installation_label"))}{const E=document.getElementById("beacon-range-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_range_label"))}{const E=document.getElementById("beacon-number-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_number_label"))}{const E=document.getElementById("beacon-note-de-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_note_de_label"))}{const E=document.getElementById("beacon-note-en-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("beacon_note_en_label"))}const g=document.getElementById("properties-label-input");g&&(g.placeholder=u("enterElementLabel"));{const S=document.getElementById("properties-type-select")?.parentElement?.querySelector("label");S&&(S.textContent=u("elementType"))}{const E=document.getElementById("properties-placeholder");E&&(E.textContent=u("noElementSelected"))}const b=document.querySelector(".toolbar-section:nth-child(5) h2");b?.childNodes[0]&&(b.childNodes[0].textContent=u("viewAndLayers")+" ");const c=document.getElementById("view-grid-sep");c&&(c.textContent=u("grid"));const d=document.getElementById("view-layers-sep");d&&(d.textContent=u("layers"));{const S=document.getElementById("toggleGridBtn")?.parentElement?.querySelector("span");S&&(S.textContent=u("showGrid"))}{const S=document.getElementById("toggleSnapBtn")?.parentElement?.querySelector("span");S&&(S.textContent=u("snapToGrid"))}{const S=document.getElementById("gridSizeInput")?.parentElement?.querySelector("label");S&&(S.textContent=u("size"))}{const S=document.getElementById("gridMetersInput")?.parentElement?.querySelector("label");S&&(S.textContent=u("metersPerCell"))}{const S=document.querySelector('.layer-toggle[data-layer="area"]')?.parentElement?.querySelector("span");S&&(S.textContent=u("layersAreas"))}{const S=document.querySelector('.layer-toggle[data-layer="path"]')?.parentElement?.querySelector("span");S&&(S.textContent=u("layersPaths"))}{const S=document.querySelector('.layer-toggle[data-layer="point"]')?.parentElement?.querySelector("span");S&&(S.textContent=u("layersPoints"))}const h=document.getElementById("show3DViewBtn");h&&(h.querySelector("span").textContent=document.getElementById("floor3DView")?.style.display==="flex"?u("backToApp"):u("preview3D"));{const E=document.querySelector("#type-manager-modal h2");E&&(E.textContent=u("manageTypesTitle"));const S=document.querySelector("#type-manager-modal h4");S&&(S.textContent=u("types"));const Se=document.getElementById("type-manager-new-btn");Se&&(Se.textContent=u("newType"));const ft=document.getElementById("type-name-input"),En=ft?.parentElement?.querySelector("label");En&&(En.textContent=u("typeName")),ft&&(ft.placeholder=u("exampleMarketing"))}rt&&(rt.textContent=u("textStyle")),lt&&(lt.textContent=u("areaStyle")),it&&(it.textContent=u("pointStyle"));{const E=document.getElementById("type-font-size-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("fontSize"),E.title=u("fontSizeDesc"))}{const E=document.getElementById("type-font-color-input")?.parentElement?.querySelector("label");E&&(E.textContent=u("fontColor"),E.title=u("fontColorDesc"))}const x=document.getElementById("ctx-menu-rename");x&&(x.textContent=u("rename"));const I=document.getElementById("ctx-menu-copy");I&&(I.textContent=u("copy"));const w=document.querySelector("#context-menu .has-submenu");w&&w.firstChild&&w.firstChild.textContent&&(w.firstChild.textContent=u("changeType"));const P=document.getElementById("ctx-menu-add-overlap-point");P&&(P.textContent=u("ctxAddOverlapPoint"));const C=document.getElementById("type-fill-color-input").parentElement.querySelector("label");C.textContent=u("fillColor"),C.title=u("fillColorDesc"),document.getElementById("type-fill-color-swatch").title=u("currentFillColor");const T=document.getElementById("type-fill-opacity-slider").parentElement.querySelector("label");T.textContent=u("fillOpacity"),T.title=u("fillOpacityDesc");const F=document.getElementById("type-stroke-color-input").parentElement.querySelector("label");F.textContent=u("strokeColor"),F.title=u("strokeColorDesc"),document.getElementById("type-stroke-color-swatch").title=u("currentStrokeColor");const D=document.querySelector("#type-editor-point > label");D.textContent=u("iconSelection"),D.title=u("iconSelectionDesc");const O=document.getElementById("type-icon-color-input").parentElement.querySelector("label");O.textContent=u("iconColor"),O.title=u("iconColorDesc");{const E=document.getElementById("type-manager-delete-btn");E&&(E.textContent=u("deleteType"))}{const E=document.getElementById("type-manager-placeholder");E&&(E.textContent=u("typeManagerPlaceholder"))}document.getElementById("type-manager-save-btn").textContent=u("saveChangesAndClose"),st&&(st.textContent=u("typePreview")),at&&(at.textContent=u("previewAreaLabel")),ct&&(ct.textContent=u("previewPointLabel")),document.querySelector("#new-type-choice-modal h4").textContent=u("createNewElementType"),document.querySelector("#new-type-choice-modal p").textContent=u("chooseBaseType"),document.getElementById("choose-type-area").textContent=u("choiceArea"),document.getElementById("choose-type-point").textContent=u("choicePoint"),document.getElementById("new-type-choice-cancel").textContent=u("cancel"),document.getElementById("input-prompt-ok").textContent=u("ok"),document.getElementById("input-prompt-cancel").textContent=u("cancel"),document.getElementById("confirm-ok").textContent=u("ok"),document.getElementById("confirm-cancel").textContent=u("cancel"),document.getElementById("ctx-menu-rename").textContent=u("rename"),document.getElementById("ctx-menu-copy").textContent=u("copy");{const E=document.getElementById("ctx-menu-delete");E&&(E.textContent=u("delete"))}{const E=document.querySelector(".context-menu .has-submenu");E&&E.childNodes[0]&&(E.childNodes[0].textContent=u("changeType"))}{const E=document.getElementById("file-menu-trigger");E&&(E.textContent=u("file"))}{const E=document.getElementById("output-menu-trigger");E&&(E.textContent=u("output"))}{const E=document.getElementById("overview-menu-trigger");E&&(E.textContent=u("overview"))}const ee={de:"Deutsch",en:"English"},Ie=e.activeLanguage,Zo=ee[Ie]||Ie.toUpperCase();if(hn.textContent=Zo,G){const E=G.querySelector('button[data-lang="en"]'),S=G.querySelector('button[data-lang="de"]');E&&(E.textContent="English"),S&&(S.textContent="Deutsch")}const gt=e.activeTheme==="dark";bn.title=u(gt?"lightMode":"darkMode"),ze&&(ze.src=gt?"/assets/lightMode.png":"/assets/darkMode.png"),Ne&&(Ne.src=gt?"/assets/language-dark.png":"/assets/language-light.png"),document.querySelector("#element-type-select optgroup:nth-child(1)")?.setAttribute("label",u("optgroupAreas")),document.querySelector("#element-type-select optgroup:nth-child(2)")?.setAttribute("label",u("optgroupPointElements")),document.querySelector("#element-type-select optgroup:nth-child(3)")?.setAttribute("label",u("optgroupConnectors"))}function Yo(t){if(e.activeLanguage===t)return;const o=e.activeLanguage;hr(t),localStorage.setItem("imd_editor_language",t),e.activeLanguage=t,hn.textContent=t==="en"?"English":"Deutsch";const n=u("unnamedProject",o),r=u("unnamedProject",t);e.project.properties.projectName===n&&(e.project.properties.projectName=r,ae&&(ae.value=r),k()),Jo(),U(),pe(),ue(),R(),M()}function Xo(t){e.activeTheme===t&&document.body.getAttribute("data-theme")===t||(e.activeTheme=t,document.body.setAttribute("data-theme",t),localStorage.setItem("imd_editor_theme",t),ze&&(ze.src=t==="dark"?"/assets/lightMode.png":"/assets/darkMode.png"),Ne&&(Ne.src=t==="dark"?"/assets/language-dark.png":"/assets/language-light.png"),Jo(),L())}function Ml(){$.addEventListener("wheel",vl,{passive:!1}),$.addEventListener("contextmenu",Sl),window.addEventListener("click",$e),$.addEventListener("mousedown",c=>{if(c.button===1||e.currentMode==="pan"&&c.button===0){Jr(c);return}if(c.button!==0)return;const d=Ze({x:c.offsetX,y:c.offsetY});if(e.currentMode==="select"&&ol(d))return;const h=ne(d);if((e.currentMode==="select"||e.currentMode==="move-element")&&h&&e.selectedFeatureIds.includes(h.properties.id)){el(d);return}xl(d)}),window.addEventListener("mouseup",c=>{Xr(),c.button===0&&(nl(),ll(),V&&V.stop3DDrag())}),window.addEventListener("mousemove",c=>{const d=$.getBoundingClientRect();if(e.mousePosScreen={x:c.clientX-d.left,y:c.clientY-d.top},e.mousePos=Ze(e.mousePosScreen),_o.style.top=`${e.mousePosScreen.y}px`,zo.style.left=`${e.mousePosScreen.x}px`,e.isPanning){Yr(c);return}if(e.isEditingPath){rl(e.mousePos);return}if(e.isMovingElement){tl(e.mousePos);return}if(e.threeDIsDragging&&V){V.do3DDrag(c);return}let h=!1;if(e.currentMode==="scissors"){let x;if(e.selectedFeatureIds.length===1){const I=e.project.features.find(w=>w.properties.id===e.selectedFeatureIds[0]);I&&I.geometry.type==="Polygon"&&(x=I)}else{const I=ne(e.mousePos);I&&I.geometry.type==="Polygon"&&(x=I)}if(x){const I=Sn(e.mousePos,x.geometry);(I.index!==e.hoveredEdgeIndex||I.index!==-1&&e.hoveredFeatureId!==x.properties.id)&&(e.hoveredEdgeIndex=I.index,e.hoveredFeatureId=I.index!==-1?x.properties.id:null,h=!0)}else e.hoveredEdgeIndex!==-1&&(e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,h=!0)}else if(e.isAltPressed&&e.currentMode==="select"&&e.selectedFeatureIds.length===1){const x=e.project.features.find(I=>I.properties.id===e.selectedFeatureIds[0]);if(x&&x.geometry.type==="Polygon"){const I=Sn(e.mousePos,x.geometry);(I.index!==e.hoveredEdgeIndex||I.index!==-1&&e.hoveredFeatureId!==x.properties.id)&&(e.hoveredEdgeIndex=I.index,e.hoveredFeatureId=I.index!==-1?x.properties.id:null,h=!0)}}else e.hoveredEdgeIndex!==-1&&(e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,h=!0);(e.tempShape||h||e.isShiftPressed)&&(L(),B())}),$.addEventListener("dblclick",c=>{c.preventDefault(),e.currentMode==="polygon"&&zr()}),Nt.addEventListener("mousedown",Mn),Dt.addEventListener("mousedown",Mn),Do.addEventListener("dblclick",()=>{e.scale=1,e.pan={x:0,y:0},Ee(),L()}),Qt.addEventListener("click",c=>{c.stopPropagation(),G.style.display=G.style.display==="block"?"none":"block"}),G.addEventListener("click",c=>{const h=c.target.dataset.lang;h&&(Yo(h),G.style.display="none")}),window.addEventListener("click",c=>{!Qt.contains(c.target)&&!G.contains(c.target)&&(G.style.display="none")}),bn.addEventListener("click",()=>{Xo(e.activeTheme==="light"?"dark":"light")}),ae.addEventListener("input",()=>{e.project.properties.projectName=ae.value,k(),U(),B()}),document.getElementById("newProjectBtn").addEventListener("click",async()=>{if(!await pt(u("alert_newProjectConfirm")))return;const d=oe(),h=d.length>0?d[0]:X,x=await ie(u("prompt_newFloorName"),h);bo(!1,x||X)}),document.getElementById("saveProjectBtn").addEventListener("click",()=>kn(ae.value)),document.getElementById("exportGeoJsonBtn").addEventListener("click",()=>kn(ae.value)),document.getElementById("loadProjectInput").addEventListener("change",c=>{const d=c.target.files?.[0];d&&(Ir(d),c.target.value="")}),document.getElementById("showGeoJsonBtn").addEventListener("click",()=>{const c=document.getElementById("live-geojson-output"),d=document.getElementById("showGeoJsonBtn"),h=c.style.display==="block";c.style.display=h?"none":"block",d.querySelector("span").textContent=u(h?"showLiveCode":"hideCode")}),document.getElementById("addFloorBtn").addEventListener("click",async()=>{const c=oe(),d=c.length===0?X:`Etage ${c.length+1}`,h=u("prompt_newFloorName"),x=await ie(h,d);x&&wn(x)}),vn.addEventListener("click",async()=>{if(!e.activeFloorId){alert(u("alert_noActiveFloor"));return}const c=u("prompt_renameFloor",e.activeLanguage,e.activeFloorId),d=await ie(c,e.activeFloorId);d&&Pn(d)}),At.addEventListener("change",()=>{e.activeFloorId=At.value,e.selectedFeatureIds=[],xe.disabled=!0,L()}),document.getElementById("floorplanInput").addEventListener("change",async c=>{const d=c.target.files?.[0];if(d)try{await kr(d)}finally{c.target.value=""}}),document.getElementById("undoBtn").addEventListener("click",Cn),document.getElementById("redoBtn").addEventListener("click",Bn),xe.addEventListener("click",()=>{if(e.selectedFeatureIds.length>1){const c=ne(e.mousePos);c&&(e.selectedFeatureIds=[c.properties.id])}ht()});const t=document.getElementById("copyBtn");t&&t.addEventListener("click",()=>{e.selectedFeatureIds.length,po()}),Vt&&Vt.addEventListener("click",()=>{const c=u("prompt_newFloorName");ie(c,e.activeFloorId||"").then(d=>{d&&wn(d),$e()})}),Gt&&Gt.addEventListener("click",()=>{if(!e.activeFloorId){alert(u("alert_noActiveFloor"));return}const c=u("prompt_renameFloor",e.activeLanguage,e.activeFloorId);ie(c,e.activeFloorId).then(d=>{d&&Pn(d),$e()})}),["select","pan","move-element","merge","area","square","polygon","circle","line","arc","point"].forEach(c=>{const d=document.getElementById(`mode-${c}`);d&&d.addEventListener("click",()=>{if(e.currentMode===c&&!["select","pan","move-element"].includes(c)){document.getElementById("mode-select")?.click();return}switch(e.currentMode=c,e.tempShape=null,["area","polygon","circle","line","arc","point"].includes(c)&&(e.selectedFeatureIds=[]),ue(),document.querySelectorAll(".tool-btn").forEach(w=>w.classList.remove("active")),d.classList.add("active"),c){case"pan":case"move-element":$.style.cursor="grab";break;case"select":$.style.cursor="default";break;case"merge":$.style.cursor="default",rn();{const w=new CustomEvent("imd-info",{detail:{title:u("merge"),message:u("mergeHintShort")}});document.dispatchEvent(w)}break;case"scissors":$.style.cursor="default";break;default:$.style.cursor="crosshair";break}const x=["area","square","polygon","circle"].includes(c),I=c==="point";No.style.display=x||I?"block":"none",x&&co("area"),I&&co("point"),xe.disabled=e.selectedFeatureIds.length===0,R(),L()})}),document.getElementById("show3DViewBtn").addEventListener("click",async()=>{const c=document.getElementById("floor3DView"),d=document.querySelector(".canvas-wrapper"),h=document.getElementById("show3DViewBtn").querySelector("span");c.style.display==="flex"?(c.style.display="none",d.style.display="grid",h.textContent=u("preview3D")):(V||(V=await vt(()=>import("./3d-_d8bCFHN.js"),__vite__mapDeps([0,1]))),je||(je=await vt(()=>import("./floor3D-hyBvWXzO.js"),[])),V.setup3DViewControls(),c.style.display="flex",d.style.display="none",h.textContent=u("backToApp"),e.threeDPan={x:50,y:50},e.threeDScale=.8,V.update3DFloorSelector(),je.render3DFloorStack(e.project,"floor3DRenderer"),c.style.cursor="grab",c.addEventListener("mousedown",V.start3DDrag),c.addEventListener("wheel",V.handle3DZoom,{passive:!1}))}),qr(L);const n=document.querySelector(".toolbar");n&&n.addEventListener("wheel",c=>{c.stopPropagation()},{passive:!0});function r(){const c=A.querySelector("h2"),d=A.querySelector("p"),h=A.querySelector("h4"),x=A.querySelector(".modal-content ul"),I=document.getElementById("intro-logo-wrapper"),w=document.getElementById("intro-logo"),P=document.getElementById("intro-logo-row");if(I&&w&&(I.style.display="block",w.src="/assets/company_logo.png",w.onerror=()=>{I.style.display="none"}),P){P.innerHTML="";const C=["/assets/company_logo.png","/assets/company_logo2.png","/assets/company_logo3.png"];for(const T of C){const F=document.createElement("img");F.className="intro-logo-img",F.alt="Logo",F.src=T,F.onerror=()=>F.remove(),P.appendChild(F)}P.style.display="flex"}c&&(c.textContent="Willkommen im Editor!"),d&&(d.textContent="Starten Sie, indem Sie Ihrem Projekt oben links einen Namen geben und rechts unter „Etagen“ einen Grundriss laden."),h&&(h.textContent="So bedienen Sie die Karte:",h.style.display="block"),x&&(x.style.display="block",x.innerHTML=["<li>Zoomen: Drehen Sie das Mausrad.</li>","<li>Verschieben: Halten Sie das Mausrad gedrückt und bewegen Sie die Maus.</li>","<li>3D-Vorschau: Nutzen Sie den Button unten links, um Ihr Modell räumlich zu sehen.</li>","<li><strong>Zeichnen & Bearbeiten:</strong></li>","<li>Form beenden: Ein Doppelklick schließt eine gezeichnete Fläche ab.</li>","<li>Abbrechen (ESC): Drücken Sie die ESC-Taste, um ein Werkzeug wegzulegen oder die Auswahl aufzuheben.</li>","<li>Zusammenfügen: Wählen Sie im Werkzeug „Zusammenfügen“ mehrere Flächen aus und drücken Sie Enter, um sie zu verschmelzen.</li>","<li><strong>Wichtige Tastenkürzel:</strong></li>","<li>Strg + Z / Y: Fehler rückgängig machen / wiederherstellen.</li>","<li>Strg + C / V: Elemente kopieren und einfügen.</li>","<li>Entf: Das ausgewählte Element löschen.</li>","<li>Shift (Umschalt): Gedrückt halten, um die Lupe zu aktivieren.</li>","<li>Alt + Klick: Fügt einer bestehenden Linie einen neuen Punkt hinzu.</li>",'<li style="margin-top:0.5rem;">Vergessen Sie nicht, Ihr Projekt regelmäßig über das Menü „Datei“ zu speichern!</li>'].join("")),A.classList.remove("hidden")}document.getElementById("Einleitung").addEventListener("click",r),Ao.addEventListener("click",()=>{A.classList.add("hidden")}),Oo.addEventListener("click",()=>{A.classList.add("hidden")}),document.addEventListener("imd-info",c=>{const d=c.detail||{},h=d.title||"Info",x=d.message||"",I=A.querySelector("h2"),w=A.querySelector("p"),P=A.querySelector("h4"),C=A.querySelector(".modal-content ul"),T=document.getElementById("intro-logo-wrapper"),F=document.getElementById("intro-logo-row");I&&(I.textContent=h),w&&(w.textContent=x),P&&(P.style.display="none"),C&&(C.style.display="none"),T&&(T.style.display="none"),F&&(F.style.display="none"),A.classList.remove("hidden")}),et.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&(c.properties.label=et.value,k(),bt(),B())}),$t.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&(c.properties.description=$t.value,k(),bt(),B())}),qt.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&(c.properties.opening_hours=qt.value,k(),bt(),B())}),tt.addEventListener("change",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&(c.properties.subType=tt.value,k(),M(),B(),R())});const l=document.getElementById("beacon-uuid-input"),i=document.getElementById("beacon-major-input"),s=document.getElementById("beacon-minor-input"),a=document.getElementById("beacon-installation-input"),m=document.getElementById("beacon-range-input"),p=document.getElementById("beacon-number-input"),v=document.getElementById("beacon-note-de-input"),g=document.getElementById("beacon-note-en-input");l?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"&&(c.properties.beacon_uuid=l.value,k(),B())}),i?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);if(c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"){const d=parseInt(i.value,10);Number.isNaN(d)?delete c.properties.beacon_major:c.properties.beacon_major=d,k(),B()}}),s?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);if(c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"){const d=parseInt(s.value,10);Number.isNaN(d)?delete c.properties.beacon_minor:c.properties.beacon_minor=d,k(),B()}}),a?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"&&(c.properties.beacon_installation=a.value,k(),B())}),m?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);if(c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"){const d=parseFloat(m.value);Number.isNaN(d)?delete c.properties.beacon_range:c.properties.beacon_range=d,k(),B()}}),p?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);if(c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"){const d=parseInt(p.value,10);Number.isNaN(d)?delete c.properties.beacon_number:c.properties.beacon_number=d,k(),B()}}),v?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"&&(c.properties.beacon_note_de=v.value,k(),B())}),g?.addEventListener("input",()=>{if(e.selectedFeatureIds.length!==1)return;const c=e.project.features.find(d=>d.properties.id===e.selectedFeatureIds[0]);c&&c.geometry.type==="Point"&&c.properties.subType==="beacon"&&(c.properties.beacon_note_en=g.value,k(),B())}),$o.addEventListener("click",ht),nt&&nt.addEventListener("click",()=>{kl(),$e()}),qo.addEventListener("click",wl),Ht.addEventListener("click",po),Go.addEventListener("click",al),Ho.addEventListener("click",Ln),Vo.addEventListener("click",cl),Ro.addEventListener("click",()=>ot.classList.remove("hidden")),Zt.addEventListener("click",dl),Wo.addEventListener("click",()=>Tn("area")),Ko.addEventListener("click",()=>Tn("point")),Uo.addEventListener("click",()=>ot.classList.add("hidden")),[Kt,Ut,Jt,Yt,Xt,en,tn].forEach(c=>c.addEventListener("input",Co)),window.addEventListener("keydown",c=>{if(document.activeElement?.tagName!=="INPUT"){if(c.key==="Escape"){Wt.classList.contains("hidden")?e.tempShape&&(e.tempShape=null,L(),xn()):Ln();const d=document.getElementById("mode-pan");d&&e.currentMode!=="pan"&&d.click()}if(c.key==="Shift"&&!e.isShiftPressed&&(e.isShiftPressed=!0,L()),c.key==="Control"&&!e.isCtrlPressed&&(e.isCtrlPressed=!0),c.key==="Alt"&&!e.isAltPressed&&(e.isAltPressed=!0,L()),c.key==="Delete"||c.key==="Backspace"){if(c.preventDefault(),e.editedFeatureId&&e.editedNodeIndex!==-1){const d=e.project.features.find(h=>h.properties.id===e.editedFeatureId);if(d&&d.geometry.type==="Polygon"){const h=d.geometry.coordinates[0];if(h.length>4){h.splice(e.editedNodeIndex,1),e.editedNodeIndex===0&&(h[h.length-1]=h[0]),e.editedNodeIndex=-1,k(),L();return}}}if(e.selectedFeatureIds.length>1&&!c.ctrlKey&&!c.metaKey){const d=ne(e.mousePos);d&&(e.selectedFeatureIds=[d.properties.id])}ht()}if(c.ctrlKey||c.metaKey)switch(c.key.toLowerCase()){case"z":c.preventDefault(),Cn();break;case"y":c.preventDefault(),Bn();break;case"c":c.preventDefault(),Pl();break;case"v":c.preventDefault(),Cl();break}c.key==="Enter"&&e.currentMode==="merge"&&e.project.features.filter(x=>x.properties.floor===e.activeFloorId).filter(x=>e.selectedFeatureIds.includes(x.properties.id)&&x.geometry.type==="Polygon").length>=2&&(c.preventDefault(),El())}}),window.addEventListener("keyup",c=>{c.key==="Shift"&&(e.isShiftPressed=!1,L()),c.key==="Control"&&(e.isCtrlPressed=!1),c.key==="Alt"&&(e.isAltPressed=!1,e.hoveredEdgeIndex=-1,e.hoveredFeatureId=null,L())}),document.querySelectorAll(".toolbar-header").forEach(c=>{c.addEventListener("click",()=>{c.classList.toggle("collapsed")})})}function Ll(){Bl(),tr(),Ml(),$r(),e.scale=.7,e.pan={x:0,y:0},Ee(),L();const t=localStorage.getItem("imd_editor_theme");Xo(t||"light");const o=localStorage.getItem("imd_editor_language");Yo(o||"de"),U(),ue(),R()}const uo=document.getElementById("simulateSignalBtn");uo?.addEventListener("click",()=>{e.showBeaconHeatmap=!e.showBeaconHeatmap;const t=uo.querySelector("span");t&&(t.textContent=e.showBeaconHeatmap?"Simulation aus":"Signal simulieren"),L()});const Tl=`<aside class="toolbar">\r
  <section class="toolbar-section" id="view-layers-section">\r
    <h2 class="toolbar-header">Projekt <span>▼</span></h2>\r
    <div class="toolbar-content">\r
      <label for="projectName"></label>\r
      <input type="text" id="projectName" placeholder="" />\r
    </div>\r
  </section>\r
\r
  <section class="toolbar-section">\r
    <h2 class="toolbar-header">Bearbeiten <span>▼</span></h2>\r
    <div class="toolbar-content">\r
      <div class="button-group">\r
        <button id="undoBtn" title="Rückgängig (Strg+Z)">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.38 11.23 17.28 8 12.5 8z"\r
            ></path>\r
          </svg>\r
          <span>Rückgängig</span>\r
        </button>\r
        <button id="redoBtn" title="Wiederherstellen (Strg+Y)">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.78 0-8.88 3.23-9.87 7.5l-2.37-.78C.39 10.31 5.22 6 11.5 6c2.81 0 5.37 1.09 7.28 2.86L22 6v9h-9l3.4-3.4z"\r
            ></path>\r
          </svg>\r
          <span>Wiederherstellen</span>\r
        </button>\r
      </div>\r
    </div>\r
  </section>\r
\r
  <section class="toolbar-section">\r
    <h2 class="toolbar-header">Etagen <span>▼</span></h2>\r
    <div class="toolbar-content">\r
      <label for="floor-select"></label>\r
      <select id="floor-select"></select>\r
      <div class="button-group">\r
        <button id="addFloorBtn" title="Neue Etage hinzufügen"><span>Neue Etage</span></button>\r
        <button id="renameFloorBtn" title="Aktive Etage umbenennen">\r
          <span>Umbenennen...</span>\r
        </button>\r
        <button\r
          title="Grundrissbild laden"\r
          onclick="document.getElementById('floorplanInput').click()"\r
        >\r
          <span>Grundriss...</span>\r
        </button>\r
      </div>\r
      <img\r
        id="floor-preview"\r
        alt="Grundriss-Vorschau"\r
        style="display: none; width: 100%; margin-top: 1rem; border-radius: var(--radius-sm)"\r
      />\r
    </div>\r
  </section>\r
\r
  <section class="toolbar-section">\r
    <h2 class="toolbar-header">Werkzeuge <span>▼</span></h2>\r
    <div class="toolbar-content">\r
      <div class="tool-buttons">\r
        <button id="mode-pan" class="tool-btn" title="Ansicht bewegen (H)">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">\r
              <path d="M12 2v4" />\r
              <path d="M12 18v4" />\r
              <path d="M2 12h4" />\r
              <path d="M18 12h4" />\r
              <path d="M7 7l-2-2" />\r
              <path d="M17 17l2 2" />\r
              <path d="M17 7l2-2" />\r
              <path d="M7 17l-2 2" />\r
            </g></svg\r
          ><span>Bewegen</span>\r
        </button>\r
        <button id="mode-select" class="tool-btn active" title="Auswählen (V)">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path fill="currentColor" d="M6 2l9 8-6 2 2 8-5-18z" /></svg\r
          ><span>Auswählen</span>\r
        </button>\r
        <button id="mode-merge" class="tool-btn" title="Zusammenfügen zu Fläche/Raum">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <g fill="none" stroke="currentColor" stroke-width="2">\r
              <rect x="4" y="6" width="10" height="10" rx="2" />\r
              <rect x="10" y="8" width="10" height="10" rx="2" />\r
            </g>\r
            <path d="M7 12h10" stroke="currentColor" stroke-width="2" /></svg\r
          ><span>Zusammenfügen</span>\r
        </button>\r
        <button id="mode-move-element" class="tool-btn" title="Element verschieben">\r
          <svg viewBox="0 0 24 24">\r
            <path\r
              d="M12,2L9,5h6L12,2z M12,22l3-3h-6L12,22z M2,12l3,3v-6L2,12z M22,12l-3-3v6L22,12z M12,8c-2.2,0-4,1.8-4,4s1.8,4,4,4 s4-1.8,4-4S14.2,8,12,8z"\r
            ></path></svg\r
          ><span>Verschieben</span>\r
        </button>\r
        <button id="deleteBtn" class="tool-btn danger" title="Löschen (Entf)" disabled>\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"\r
            ></path></svg\r
          ><span>Löschen</span>\r
        </button>\r
        <button id="copyBtn" class="tool-btn" title="Kopieren (Strg+C)">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"\r
            ></path></svg\r
          ><span>Copy</span>\r
        </button>\r
        <div class="toolbar-separator">Flächen</div>\r
        <button id="mode-area" class="tool-btn" title="Viereck zeichnen (R)">\r
          <svg viewBox="0 0 24 24"><path d="M3,3v18h18V3H3z M19,19H5V5h14V19z"></path></svg\r
          ><span>Viereck</span>\r
        </button>\r
        <button id="mode-square" class="tool-btn" title="Quadrat zeichnen">\r
          <svg viewBox="0 0 24 24"><rect x="5" y="5" width="14" height="14" rx="1" ry="1" /></svg\r
          ><span>Quadrat</span>\r
        </button>\r
        <button id="mode-polygon" class="tool-btn" title="Polygon zeichnen (P)">\r
          <svg viewBox="0 0 24 24">\r
            <path\r
              d="M12,2 L2,8 L2,16 L12,22 L22,16 L22,8 Z M4,9.6 L12,4.8 L20,9.6 L20,14.4 L12,19.2 L4,14.4 Z"\r
            ></path></svg\r
          ><span>Polygon</span>\r
        </button>\r
        <button id="mode-circle" class="tool-btn" title="Kreis zeichnen (C)">\r
          <svg viewBox="0 0 24 24">\r
            <path\r
              d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8 S16.4,20,12,20z"\r
            ></path></svg\r
          ><span>Kreis</span>\r
        </button>\r
        <div class="toolbar-separator">Linien & Punkte</div>\r
        <button id="mode-line" class="tool-btn" title="Linie zeichnen (L)">\r
          <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">\r
            <line x1="3" y1="21" x2="21" y2="3"></line></svg\r
          ><span>Linie</span>\r
        </button>\r
        <button id="mode-arc" class="tool-btn" title="Bogen zeichnen">\r
          <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">\r
            <path d="M3,21 C10,21 14,3 21,3"></path></svg\r
          ><span>Bogen</span>\r
        </button>\r
        <button id="mode-point" class="tool-btn" title="Punkt setzen">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"\r
            ></path></svg\r
          ><span>Punkt</span>\r
        </button>\r
      </div>\r
      <div id="element-options" style="display: none">\r
        <hr />\r
        <!-- Element Typ wählen -->\r
        <label for="element-type-select" class="form-label-large">Element-Typ</label>\r
        <select id="element-type-select" style="width: 100%"></select>\r
\r
        <!-- NEU: Schrift-Einstellungen für neue Elemente -->\r
        <button id="manage-types-btn" style="width: 100%; margin-top: 8px; justify-content: center">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\r
            <path\r
              d="M21 19v-2H3v2h18zM3 5v2h18V5H3zm12 6c0-1.66-1.34-3-3-3s-3 1.34-3 3 1.34 3 3 3 3-1.34 3-3z"\r
            ></path>\r
          </svg>\r
          <span>Typen verwalten...</span>\r
        </button>\r
      </div>\r
\r
      <section\r
        id="properties-panel"\r
        class="toolbar-section"\r
        style="display: none; padding: 0; margin-top: 1rem"\r
      >\r
        <h2 class="toolbar-header">Eigenschaften <span>▼</span></h2>\r
        <div class="toolbar-content">\r
          <div id="properties-content" style="display: none">\r
            <label for="properties-label-input"></label>\r
            <input type="text" id="properties-label-input" placeholder="" />\r
            <label for="properties-type-select" style="margin-top: 0.75rem"></label>\r
            <select id="properties-type-select"></select>\r
            <div id="beacon-fields" style="margin-top: 0.75rem; display: none">\r
              <label for="beacon-uuid-input"></label>\r
              <input type="text" id="beacon-uuid-input" placeholder="" />\r
              <label for="beacon-major-input" style="margin-top: 0.5rem"></label>\r
              <input type="number" id="beacon-major-input" placeholder="" />\r
              <label for="beacon-minor-input" style="margin-top: 0.5rem"></label>\r
              <input type="number" id="beacon-minor-input" placeholder="" />\r
              <label for="beacon-installation-input" style="margin-top: 0.5rem"></label>\r
              <input type="datetime-local" id="beacon-installation-input" placeholder="" />\r
              <label for="beacon-range-input" style="margin-top: 0.5rem"></label>\r
              <input type="number" id="beacon-range-input" placeholder="" />\r
              <label for="beacon-number-input" style="margin-top: 0.5rem"></label>\r
              <input type="number" id="beacon-number-input" placeholder="" />\r
              <label for="beacon-note-de-input" style="margin-top: 0.5rem"></label>\r
              <input type="text" id="beacon-note-de-input" placeholder="" />\r
              <label for="beacon-note-en-input" style="margin-top: 0.5rem"></label>\r
              <input type="text" id="beacon-note-en-input" placeholder="" />\r
            </div>\r
            <label for="properties-description-input" style="margin-top: 0.75rem"></label>\r
            <input type="text" id="properties-description-input" placeholder="" />\r
            <label for="properties-opening-hours-input" style="margin-top: 0.5rem"></label>\r
            <input type="text" id="properties-opening-hours-input" placeholder="" />\r
          </div>\r
          <p id="properties-placeholder">Kein Element ausgewählt.</p>\r
        </div>\r
      </section>\r
    </div>\r
  </section>\r
\r
  <section class="toolbar-section" id="view-layers-controls">\r
    <h2 class="toolbar-header">Ansicht & Layer <span>▼</span></h2>\r
    <div class="toolbar-content">\r
      <div class="toolbar-separator" id="view-grid-sep">Raster</div>\r
      <label class="checkbox-label"\r
        ><input type="checkbox" id="toggleGridBtn" checked /> <span>Raster anzeigen</span></label\r
      >\r
      <label class="checkbox-label"\r
        ><input type="checkbox" id="toggleSnapBtn" checked />\r
        <span>Am Raster ausrichten</span></label\r
      >\r
      <div class="grid-control">\r
        <label for="gridSizeInput">Größe:</label>\r
        <div class="grid-steppers">\r
          <button id="gridMinusBtn" class="mini-btn" title="kleiner">−</button>\r
          <input type="number" id="gridSizeInput" value="40" min="5" step="5" />\r
          <button id="gridPlusBtn" class="mini-btn" title="größer">+</button>\r
        </div>\r
      </div>\r
      <div class="grid-control">\r
        <label for="gridMetersInput" id="gridMetersLabel">Meter/Kasten:</label>\r
        <div class="grid-steppers">\r
          <button id="gridMetersMinusBtn" class="mini-btn" title="weniger">−</button>\r
          <input type="number" id="gridMetersInput" value="1" min="0.1" step="0.1" />\r
          <button id="gridMetersPlusBtn" class="mini-btn" title="mehr">+</button>\r
        </div>\r
      </div>\r
      <div class="unit-hint" id="gridInfo">1 Kasten ≈ 40 px</div>\r
      <div class="toolbar-separator" id="view-layers-sep">Layer</div>\r
      <label class="checkbox-label"\r
        ><input type="checkbox" class="layer-toggle" data-layer="area" checked />\r
        <span>Flächen</span></label\r
      >\r
      <label class="checkbox-label"\r
        ><input type="checkbox" class="layer-toggle" data-layer="path" checked />\r
        <span>Wege/Linien</span></label\r
      >\r
      <label class="checkbox-label"\r
        ><input type="checkbox" class="layer-toggle" data-layer="point" checked />\r
        <span>Punktelemente</span></label\r
      >\r
      <button id="show3DViewBtn" title="3D-Vorschau öffnen"><span>3D-Vorschau</span></button>\r
      <div class="toolbar-separator">Analyse</div>\r
      <div class="button-group">\r
        <button id="simulateSignalBtn" title="Beacon-Signal simulieren">\r
          <span>Signal simulieren</span>\r
        </button>\r
      </div>\r
    </div>\r
  </section>\r
</aside>\r
`,Fl=`<aside id="backstage-panel" class="backstage-panel">\r
  <div class="backstage-header">\r
    <button id="backstage-close-btn" title="Zurück zur Hauptansicht">\r
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\r
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path>\r
      </svg>\r
    </button>\r
    <div id="backstage-title" class="backstage-title"></div>\r
  </div>\r
\r
  <div id="backstage-file-content" class="backstage-content">\r
    <ul>\r
      <li>\r
        <button id="newProjectBtn" title="Neues Projekt erstellen">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"\r
            ></path></svg\r
          ><span>Neues Projekt</span>\r
        </button>\r
      </li>\r
      <li>\r
        <button\r
          id="loadProjectBtn"\r
          title="Projektdatei laden"\r
          onclick="document.getElementById('loadProjectInput').click()"\r
        >\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10z"\r
            ></path></svg\r
          ><span>Projekt laden</span>\r
        </button>\r
      </li>\r
      <li>\r
        <button id="saveProjectBtn" title="Projekt speichern">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path\r
              d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"\r
            ></path></svg\r
          ><span>Projekt speichern</span>\r
        </button>\r
      </li>\r
      <li>\r
        <button id="Einleitung" title="Kurze Einführung anzeigen">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <circle cx="12" cy="12" r="10" fill="currentColor" />\r
            <path d="M11 7h2v2h-2zm0 4h2v6h-2z" fill="#fff" /></svg\r
          ><span>Einleitung</span>\r
        </button>\r
      </li>\r
    </ul>\r
  </div>\r
\r
  <div id="backstage-output-content" class="backstage-content">\r
    <ul>\r
      <li>\r
        <button id="exportGeoJsonBtn" title="Projekt als GeoJSON exportieren">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></svg\r
          ><span>GeoJSON exportieren</span>\r
        </button>\r
      </li>\r
      <li>\r
        <button id="showGeoJsonBtn" title="Live-GeoJSON anzeigen">\r
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\r
            <path\r
              d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"\r
            ></path></svg\r
          ><span>Live Code anzeigen</span>\r
        </button>\r
      </li>\r
    </ul>\r
    <div class="code-view-wrapper">\r
      <pre id="live-geojson-output"></pre>\r
    </div>\r
  </div>\r
\r
  <div id="backstage-overview-content" class="backstage-content">\r
    <div id="overview-stats-panel"></div>\r
    <div id="overview-floor-list"></div>\r
  </div>\r
</aside>\r
`,jl=`<div id="info-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content">\r
    <button id="info-modal-close-btn" class="modal-close-btn">&times;</button>\r
    <div id="intro-logo-wrapper" style="display: none; text-align: center; margin-bottom: 0.5rem">\r
      <img\r
        id="intro-logo"\r
        alt="Logo"\r
        src="/assets/company_logo.png"\r
        style="height: 64px; width: auto; filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.2))"\r
      />\r
    </div>\r
    <div id="intro-logo-row" class="intro-logos" style="display: none"></div>\r
    <h2></h2>\r
    <p></p>\r
    <h4></h4>\r
    <ul>\r
      <li><strong>Werkzeuge:</strong></li>\r
      <li><strong>Zoomen:</strong></li>\r
      <li><strong>Verschieben der Ansicht:</strong></li>\r
      <li><strong>Elemente verschieben:</strong></li>\r
      <li><strong>Speichern:</strong></li>\r
    </ul>\r
  </div>\r
</div>\r
\r
<div id="type-manager-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content" style="max-width: 650px">\r
    <button id="type-manager-close-btn" class="modal-close-btn">&times;</button>\r
    <h2></h2>\r
    <div style="display: flex; gap: 1.5rem; margin-top: 1rem; min-height: 350px">\r
      <div\r
        style="\r
          flex: 1;\r
          border-right: 1px solid var(--color-border);\r
          padding-right: 1.5rem;\r
          display: flex;\r
          flex-direction: column;\r
        "\r
      >\r
        <h4></h4>\r
        <ul\r
          id="type-manager-list"\r
          style="\r
            list-style: none;\r
            padding: 0;\r
            max-height: 300px;\r
            overflow-y: auto;\r
            border: 1px solid var(--color-border);\r
            border-radius: var(--radius-sm);\r
            flex-grow: 1;\r
          "\r
        ></ul>\r
        <button\r
          id="type-manager-new-btn"\r
          style="width: 100%; margin-top: 1rem; justify-content: center"\r
        >\r
          + Neuer Typ\r
        </button>\r
      </div>\r
      <div id="type-manager-details" style="flex: 2">\r
        <div id="type-manager-details-content" class="hidden">\r
          <label for="type-name-input"></label>\r
          <input type="text" id="type-name-input" style="width: 100%" placeholder="" />\r
\r
          <!-- SCHRIFT-STIL GRUPPE -->\r
          <div id="type-editor-text-settings">\r
            <hr style="margin: 1.5rem 0 0.5rem 0" />\r
            <h5\r
              id="type-text-style-header"\r
              style="margin: 0 0 0.5rem 0; color: var(--color-primary)"\r
            ></h5>\r
            <div\r
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: center"\r
            >\r
              <div>\r
                <label for="type-font-size-input"></label>\r
                <input\r
                  type="number"\r
                  id="type-font-size-input"\r
                  min="8"\r
                  max="32"\r
                  step="1"\r
                  style="width: 100%"\r
                />\r
              </div>\r
              <div>\r
                <label for="type-font-color-input"></label>\r
                <input\r
                  type="color"\r
                  id="type-font-color-input"\r
                  style="\r
                    width: 100%;\r
                    height: 40px;\r
                    padding: 0;\r
                    border: none;\r
                    background: none;\r
                    cursor: pointer;\r
                  "\r
                />\r
              </div>\r
            </div>\r
          </div>\r
\r
          <!-- FLÄCHEN-STIL GRUPPE -->\r
          <div id="type-editor-area">\r
            <hr style="margin: 1.5rem 0 0.5rem 0" />\r
            <h5\r
              id="type-area-style-header"\r
              style="margin: 0 0 0.5rem 0; color: var(--color-primary)"\r
            ></h5>\r
            <div\r
              style="\r
                display: grid;\r
                grid-template-columns: 1fr 50px;\r
                gap: 1rem;\r
                align-items: center;\r
                margin-top: 1rem;\r
              "\r
            >\r
              <div>\r
                <label for="type-fill-color-input"></label>\r
                <input\r
                  type="color"\r
                  id="type-fill-color-input"\r
                  style="\r
                    width: 100%;\r
                    height: 40px;\r
                    padding: 0;\r
                    border: none;\r
                    background: none;\r
                    cursor: pointer;\r
                  "\r
                />\r
              </div>\r
              <div\r
                id="type-fill-color-swatch"\r
                title=""\r
                style="\r
                  width: 40px;\r
                  height: 40px;\r
                  border: 1px solid var(--color-border);\r
                  border-radius: var(--radius-sm);\r
                "\r
              ></div>\r
            </div>\r
            <label\r
              for="type-fill-opacity-slider"\r
              style="display: block; margin-top: 0.5rem"\r
            ></label>\r
            <input\r
              type="range"\r
              id="type-fill-opacity-slider"\r
              min="0"\r
              max="1"\r
              step="0.05"\r
              style="width: 100%"\r
            />\r
            <div\r
              style="\r
                display: grid;\r
                grid-template-columns: 1fr 50px;\r
                gap: 1rem;\r
                align-items: center;\r
                margin-top: 1rem;\r
              "\r
            >\r
              <div>\r
                <label for="type-stroke-color-input"></label>\r
                <input\r
                  type="color"\r
                  id="type-stroke-color-input"\r
                  style="\r
                    width: 100%;\r
                    height: 40px;\r
                    padding: 0;\r
                    border: none;\r
                    background: none;\r
                    cursor: pointer;\r
                  "\r
                />\r
              </div>\r
              <div\r
                id="type-stroke-color-swatch"\r
                title=""\r
                style="\r
                  width: 40px;\r
                  height: 40px;\r
                  border: 1px solid var(--color-border);\r
                  border-radius: var(--radius-sm);\r
                "\r
              ></div>\r
            </div>\r
          </div>\r
\r
          <!-- PUNKT-STIL GRUPPE -->\r
          <div id="type-editor-point">\r
            <hr style="margin: 1.5rem 0 0.5rem 0" />\r
            <h5\r
              id="type-point-style-header"\r
              style="margin: 0 0 0.5rem 0; color: var(--color-primary)"\r
            ></h5>\r
            <label style="display: block; margin-top: 1rem"></label>\r
            <div\r
              id="type-icon-library"\r
              style="\r
                display: grid;\r
                grid-template-columns: repeat(auto-fill, 40px);\r
                gap: 8px;\r
                max-height: 150px;\r
                overflow-y: auto;\r
                border: 1px solid var(--color-border);\r
                padding: 8px;\r
                border-radius: var(--radius-sm);\r
              "\r
            ></div>\r
            <label for="type-icon-color-input" style="display: block; margin-top: 1rem"></label>\r
            <input type="color" id="type-icon-color-input" style="width: 100%" />\r
          </div>\r
\r
          <div id="type-preview" class="type-preview hidden">\r
            <hr style="margin: 1.5rem 0 0.5rem 0" />\r
            <h5\r
              id="type-preview-header"\r
              style="margin: 0 0 0.5rem 0; color: var(--color-primary)"\r
            ></h5>\r
            <div id="type-preview-area" class="type-preview__area">\r
              <div id="type-preview-area-rect">\r
                <span id="type-preview-area-label">Sample area</span>\r
              </div>\r
            </div>\r
            <div id="type-preview-point" class="type-preview__point">\r
              <div id="type-preview-point-icon"></div>\r
              <span id="type-preview-point-label">Sample point</span>\r
            </div>\r
          </div>\r
\r
          <button id="type-manager-delete-btn" class="danger" style="margin-top: 2rem">\r
            Typ löschen\r
          </button>\r
        </div>\r
        <p id="type-manager-placeholder">\r
          Wählen Sie links einen Typ aus oder erstellen Sie einen neuen.\r
        </p>\r
      </div>\r
    </div>\r
    <div\r
      style="\r
        text-align: right;\r
        margin-top: 2rem;\r
        border-top: 1px solid var(--color-border);\r
        padding-top: 1rem;\r
      "\r
    >\r
      <button id="type-manager-save-btn">Änderungen übernehmen & schließen</button>\r
    </div>\r
  </div>\r
</div>\r
\r
<div id="new-type-choice-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content" style="max-width: 400px">\r
    <h4>Neuen Element-Typ erstellen</h4>\r
    <p>Wählen Sie den Basis-Typ aus:</p>\r
    <div style="display: flex; gap: 1rem; margin-top: 1rem">\r
      <button id="choose-type-area" style="flex: 1; justify-content: center">Fläche</button>\r
      <button id="choose-type-point" style="flex: 1; justify-content: center">Punkt</button>\r
    </div>\r
    <button\r
      id="new-type-choice-cancel"\r
      style="width: 100%; margin-top: 1rem; background-color: var(--color-secondary)"\r
    >\r
      Abbrechen\r
    </button>\r
  </div>\r
</div>\r
<div id="context-menu" class="context-menu">\r
  <ul>\r
    <li id="ctx-menu-rename">Umbenennen...</li>\r
    <li id="ctx-menu-copy">Kopieren</li>\r
    <li id="ctx-menu-delete" class="danger">Löschen</li>\r
    <li class="separator"></li>\r
    <li class="has-submenu">\r
      Typ ändern\r
      <ul id="ctx-menu-type-submenu" class="submenu"></ul>\r
    </li>\r
    <li class="separator"></li>\r
    <li id="ctx-menu-add-overlap-point">Punkt im Schnittbereich setzen</li>\r
    <li class="has-submenu">\r
      Etage\r
      <ul id="ctx-floor-submenu" class="submenu">\r
        <li id="ctx-floor-add">Hinzufügen...</li>\r
        <li id="ctx-floor-rename">Umbenennen...</li>\r
      </ul>\r
    </li>\r
  </ul>\r
</div>\r
\r
<div id="input-prompt-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content" style="max-width: 420px">\r
    <h4 id="input-prompt-label"></h4>\r
    <input id="input-prompt-input" type="text" class="modal-input" />\r
    <div class="modal-actions">\r
      <button id="input-prompt-ok" class="btn-primary">OK</button>\r
      <button id="input-prompt-cancel">Abbrechen</button>\r
    </div>\r
  </div>\r
</div>\r
\r
<div id="confirm-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content" style="max-width: 420px">\r
    <p id="confirm-message"></p>\r
    <div class="modal-actions">\r
      <button id="confirm-ok" class="btn-primary">OK</button>\r
      <button id="confirm-cancel">Abbrechen</button>\r
    </div>\r
  </div>\r
</div>\r
\r
<!-- Lade-/Status-Modal -->\r
<div id="loading-modal" class="modal hidden">\r
  <div class="modal-overlay"></div>\r
  <div class="modal-content" style="max-width: 420px; text-align: center">\r
    <div class="spinner" aria-hidden="true"></div>\r
    <p id="loading-message" style="margin-top: 0.75rem"></p>\r
    <div class="modal-actions" style="justify-content: center">\r
      <button id="loading-ok" class="btn-primary">OK</button>\r
    </div>\r
  </div>\r
</div>\r
`;function _l(){const t=document.getElementById("toolbar-container"),o=document.getElementById("backstage-container"),n=document.getElementById("modals-container");t&&(t.innerHTML=Tl),o&&(o.innerHTML=Fl),n&&(n.innerHTML=jl)}document.addEventListener("DOMContentLoaded",()=>{_l(),setTimeout(()=>{Ll(),br();try{const n=localStorage.getItem("imd_editor_project");n&&ut(JSON.parse(n))}catch{}k(),console.log("IMD Editor erfolgreich initialisiert.");const o=location.pathname.match(/^\/(floor|etage)\/(.+)$/);if(o){const n=decodeURIComponent(o[2]);e.activeFloorId=n;const r=document.getElementById("show3DViewBtn");r&&r.click();const l=document.querySelector(".app-header");l&&(l.style.display="none");const i=document.getElementById("toolbar-container");i&&(i.style.display="none");const s=document.getElementById("backstage-container");s&&(s.style.display="none");const a=document.querySelector(".canvas-wrapper");a&&(a.style.display="none");const m=document.getElementById("floor3DView");m&&(m.style.display="flex",m.style.height="100vh")}},0)});export{oe as a,K as b,mo as c,u as g,e as s,pe as u};

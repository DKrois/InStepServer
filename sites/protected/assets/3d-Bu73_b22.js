import{s as t,g as d,a as X,u as Y}from"./index-D2oOUytM.js";import{render3DFloorStack as q}from"./floor3D-C2vtg_FK.js";let g=null;function z(){const o=document.getElementById("interactive-3d-group");o&&o.setAttribute("transform",`translate(${t.threeDPan.x}, ${t.threeDPan.y}) scale(${t.threeDScale})`)}function Z(o){!g||o.button!==0||(t.threeDIsDragging=!0,t.threeDStartPos={x:o.clientX,y:o.clientY},g.style.cursor="grabbing")}function K(o){if(!t.threeDIsDragging)return;const h=o.clientX-t.threeDStartPos.x,n=o.clientY-t.threeDStartPos.y;t.threeDPan.x+=h,t.threeDPan.y+=n,t.threeDStartPos={x:o.clientX,y:o.clientY},z()}function Q(){t.threeDIsDragging&&(t.threeDIsDragging=!1,g&&(g.style.cursor="grab"))}function ee(o){if(o.preventDefault(),!g)return;const h=.05,n=t.threeDScale,f=o.deltaY<0?n*(1+h):n/(1+h);t.threeDScale=Math.max(.1,Math.min(f,5)),z()}function te(){if(g=document.getElementById("floor3DView"),!g)return;const o=/^\/(floor|etage)\//.test(location.pathname),h=`
    <div id="floor3DHeader" class="floor-3d-header" style="display:flex;align-items:center;gap:12px;">
      <img src="assets/logo_outline.png" alt="Logo" style="height:28px;" />
      <select id="floor3DSelect" style="margin-right: auto;"></select>
      <div class="window-controls" style="display:flex;gap:10px;">
        <button id="floor3DMinimizeBtn" title="${d("threeD_minimize")}" style="background:none;border:none;color:inherit;padding:4px;border-radius:6px;display:flex;align-items:center;justify-content:center">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14" />
          </svg>
        </button>
        <button id="floor3DMaximizeBtn" title="${d("threeD_toggle_fullscreen")}" style="background:none;border:none;color:inherit;padding:4px;border-radius:6px;display:flex;align-items:center;justify-content:center">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="6" y="6" width="12" height="12" rx="1" />
          </svg>
        </button>
        <button id="floor3DCloseBtn" title="${d("backToApp")}" style="background:none;border:none;color:inherit;padding:4px;border-radius:6px;display:flex;align-items:center;justify-content:center">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <path d="M6 6l12 12M18 6l-12 12" />
          </svg>
        </button>
      </div>
    </div>`,n=`
    <div id="floor3DHeader" class="floor-3d-header" style="display:flex;align-items:center;justify-content:space-between;padding:6px 10px;">
      <img src="assets/logo_outline.png" alt="Logo" style="height:34px;" />
      <div class="floor-3d-title" style="font-weight:600;letter-spacing:0.2px;">
        <span id="floor3DTitle">${d("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}</span>
      </div>
    </div>`;g.innerHTML=`
    ${o?n:h}
    <div id="floor3DRenderer" style="flex-grow: 1; overflow: auto; position: relative; scrollbar-gutter: stable both-edges;">
      <div id="floor3DContent" style="width: 100%; height: 100%; position: relative;"></div>
    </div>
    <div id="floor3DOverlay" style="position:absolute; right:12px; bottom:12px; z-index:1002; pointer-events:auto;">
      <button id="floor3DScreenshotBtn" class="tool-btn" title="${d("screenshot")}">
        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="7" width="18" height="12" rx="2" fill="none" />
          <circle cx="12" cy="13" r="3.5" fill="none" />
          <path d="M8 7l1.5-2h5L16 7" fill="none" />
        </svg>
        <span>${d("screenshot")}</span>
      </button>
    </div>
  `;const f=()=>{const l=document.getElementById("floor3DRenderer"),s=document.getElementById("floor3DContent"),x=document.getElementById("floor3DHeader");if(!l||!s)return;if(/^\/(floor|etage)\//.test(location.pathname)){const k=x?Math.round(x.getBoundingClientRect().height):0;l.style.height=`calc(100vh - ${k}px)`,l.style.width="100vw",s.style.width="100%",s.style.height="100%",document.documentElement.style.height="100%",document.body.style.height="100%",document.body.style.overflow="hidden"}else l.style.height="",l.style.width="",s.style.width="100%",s.style.height="100%"};f(),window.addEventListener("resize",f,{passive:!0});const C=document.getElementById("show3DViewBtn").querySelector("span"),F=()=>{g.style.display="none",document.querySelector(".canvas-wrapper").style.display="grid",C.textContent=d("preview3D")},P=()=>{g.style.display="none",document.querySelector(".canvas-wrapper").style.display="grid",C.textContent=d("backToApp")},_=()=>{const l=t.activeLanguage==="de"?"etage":"floor",s=t.activeFloorId||"";try{localStorage.setItem("imd_editor_project",JSON.stringify(t.project))}catch{}const x=`${location.origin}/${l}/${encodeURIComponent(s)}`;window.open(x,"_blank")},U=()=>{const l=document.getElementById("floor3DRenderer");if(!l)return;const s=l.querySelector("svg");if(!s)return;const j=new XMLSerializer().serializeToString(s),k=new Blob([j],{type:"image/svg+xml;charset=utf-8"}),b=URL.createObjectURL(k),I=new Image;I.onload=()=>{const M=l.getBoundingClientRect(),c=16,r=Math.max(2,Math.floor(window.devicePixelRatio||2)),m=document.createElement("canvas");m.width=Math.max(1,Math.floor(M.width*r)+c*2),m.height=Math.max(1,Math.floor(M.height*r)+c*2);const e=m.getContext("2d");if(!e){URL.revokeObjectURL(b);return}const V=getComputedStyle(document.body).getPropertyValue("--color-surface").trim()||"#ffffff";e.fillStyle=V,e.fillRect(0,0,m.width,m.height),e.imageSmoothingEnabled=!0,e.drawImage(I,c,c,Math.floor(M.width*r),Math.floor(M.height*r));const v=(t.project.properties.projectName||"Projekt")+" – "+(t.activeFloorId||"Etage"),S=new Image;S.onload=()=>{const u=Math.floor(28*r),D=Math.floor(14*r);e.font=`${D}px Segoe UI, Arial, sans-serif`;const B=Math.ceil(e.measureText(v).width),p=u+Math.floor(12*r)+B+Math.floor(12*r),y=Math.max(u,Math.floor(30*r)),i=c+6,a=c+6,E=document.body.getAttribute("data-theme")==="dark",N=E?"rgba(38,22,56,0.78)":"rgba(255,255,255,0.88)",O=E?"rgba(230,225,239,0.12)":"rgba(0,0,0,0.08)",w=Math.floor(8*r);e.shadowColor="rgba(0,0,0,0.12)",e.shadowBlur=Math.floor(8*r),e.shadowOffsetX=Math.floor(2*r),e.shadowOffsetY=Math.floor(2*r),e.lineWidth=Math.max(1,Math.floor(r*.75)),e.beginPath(),e.moveTo(i+w,a),e.arcTo(i+p,a,i+p,a+y,w),e.arcTo(i+p,a+y,i,a+y,w),e.arcTo(i,a+y,i,a,w),e.arcTo(i,a,i+p,a,w),e.closePath(),e.fillStyle=N,e.fill(),e.shadowColor="transparent",e.strokeStyle=O,e.stroke();const H=a+Math.floor((y-u)/2);e.drawImage(S,i+Math.floor(8*r),H,u,u),e.textBaseline="middle",e.fillStyle=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333",e.strokeStyle=E?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.85)",e.lineWidth=Math.max(2,r);const T=i+Math.floor(8*r)+u+Math.floor(12*r),R=a+Math.floor(y/2);e.strokeText(v,T,R),e.fillText(v,T,R),URL.revokeObjectURL(b);const $=document.createElement("a"),A=t.activeLanguage==="de"?"etage":"floor",W=t.activeFloorId||"screenshot";$.download=`${A}-${W}.png`,$.href=m.toDataURL("image/png"),$.click()},S.onerror=()=>{const u=Math.floor(14*r);e.font=`${u}px Segoe UI, Arial, sans-serif`,e.fillStyle=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333",e.strokeStyle="rgba(255,255,255,0.8)",e.lineWidth=Math.max(2,r),e.strokeText(v,c+8,c+24*r),e.fillText(v,c+8,c+24*r),URL.revokeObjectURL(b);const D=document.createElement("a"),B=t.activeLanguage==="de"?"etage":"floor",p=t.activeFloorId||"screenshot";D.download=`${B}-${p}.png`,D.href=m.toDataURL("image/png"),D.click()},S.src="assets/logo_transparent.png"},I.src=b};o||(document.getElementById("floor3DCloseBtn")?.addEventListener("click",F),document.getElementById("floor3DMinimizeBtn")?.addEventListener("click",P),document.getElementById("floor3DMaximizeBtn")?.addEventListener("click",_)),document.getElementById("floor3DScreenshotBtn")?.addEventListener("click",U);const L=document.getElementById("floor3DTitle");L&&(L.textContent=`${d("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}`)}function oe(){const o=document.getElementById("floor3DSelect");if(!o)return;const h=X();o.innerHTML="",h.forEach(n=>{const f=document.createElement("option");f.value=n,f.textContent=n,o.appendChild(f)}),o.value=t.activeFloorId||h[0]||"",o.onchange=()=>{t.activeFloorId=o.value,Y(),q(t.project,"floor3DContent");const n=document.getElementById("floor3DTitle");n&&(n.textContent=`${d("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}`)}}export{K as do3DDrag,ee as handle3DZoom,te as setup3DViewControls,Z as start3DDrag,Q as stop3DDrag,oe as update3DFloorSelector,z as update3DGroupTransform};

import{s as t,g as p,a as X,u as W}from"./index-DG_hzbAb.js";import{render3DFloorStack as Y}from"./floor3D-hyBvWXzO.js";let s=null;function T(){const o=document.getElementById("interactive-3d-group");o&&o.setAttribute("transform",`translate(${t.threeDPan.x}, ${t.threeDPan.y}) scale(${t.threeDScale})`)}function J(o){!s||o.button!==0||(t.threeDIsDragging=!0,t.threeDStartPos={x:o.clientX,y:o.clientY},s.style.cursor="grabbing")}function Z(o){if(!t.threeDIsDragging)return;const c=o.clientX-t.threeDStartPos.x,n=o.clientY-t.threeDStartPos.y;t.threeDPan.x+=c,t.threeDPan.y+=n,t.threeDStartPos={x:o.clientX,y:o.clientY},T()}function K(){t.threeDIsDragging&&(t.threeDIsDragging=!1,s&&(s.style.cursor="grab"))}function Q(o){if(o.preventDefault(),!s)return;const c=.05,n=t.threeDScale,d=o.deltaY<0?n*(1+c):n/(1+c);t.threeDScale=Math.max(.1,Math.min(d,5)),T()}function ee(){if(s=document.getElementById("floor3DView"),!s)return;const o=/^\/(floor|etage)\//.test(location.pathname),c=`
    <div id="floor3DHeader" class="floor-3d-header" style="display:flex;align-items:center;gap:12px;">
      <img src="/assets/logo_outline.png" alt="Logo" style="height:28px;" />
      <select id="floor3DSelect" style="margin-right: auto;"></select>
      <button id="floor3DScreenshotBtn" title="Screenshot" style="display:flex;align-items:center;gap:8px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M4 7h3l2-2h6l2 2h3v12H4V7zm8 2a5 5 0 100 10 5 5 0 000-10z" fill="currentColor"/></svg>
        <span>Screenshot</span>
      </button>
      <div class="window-controls" style="display:flex;gap:6px;">
        <button id="floor3DMinimizeBtn" title="Minimieren">—</button>
        <button id="floor3DMaximizeBtn" title="Vollbild umschalten (Neues Fenster)">□</button>
        <button id="floor3DCloseBtn" title="${p("backToApp")}">X</button>
      </div>
    </div>`,n=`
    <div id="floor3DHeader" class="floor-3d-header" style="display:flex;align-items:center;justify-content:space-between;padding:6px 10px;">
      <img src="/assets/logo_outline.png" alt="Logo" style="height:34px;" />
      <div class="floor-3d-title" style="font-weight:600;letter-spacing:0.2px;">
        <span id="floor3DTitle">${p("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}</span>
      </div>
      <button id="floor3DScreenshotBtn" title="Screenshot" style="display:flex;align-items:center;gap:8px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M4 7h3l2-2h6l2 2h3v12H4V7zm8 2a5 5 0 100 10 5 5 0 000-10z" fill="currentColor"/></svg>
        <span>Screenshot</span>
      </button>
    </div>`;s.innerHTML=`
    ${o?n:c}
    <div id="floor3DRenderer" style="flex-grow: 1; overflow: hidden; position: relative;"></div>
  `;const d=document.getElementById("show3DViewBtn").querySelector("span"),z=()=>{s.style.display="none",document.querySelector(".canvas-wrapper").style.display="grid",d.textContent=p("preview3D")},j=()=>{s.style.display="none",document.querySelector(".canvas-wrapper").style.display="grid",d.textContent=p("backToApp")},R=()=>{const u=t.activeLanguage==="de"?"etage":"floor",v=t.activeFloorId||"";try{localStorage.setItem("imd_editor_project",JSON.stringify(t.project))}catch{}const $=`${location.origin}/${u}/${encodeURIComponent(v)}`;window.open($,"_blank")},F=()=>{const u=document.getElementById("floor3DRenderer");if(!u)return;const v=u.querySelector("svg");if(!v)return;const P=new XMLSerializer().serializeToString(v),U=new Blob([P],{type:"image/svg+xml;charset=utf-8"}),w=URL.createObjectURL(U),M=new Image;M.onload=()=>{const S=u.getBoundingClientRect(),i=16,r=Math.max(2,Math.floor(window.devicePixelRatio||2)),h=document.createElement("canvas");h.width=Math.max(1,Math.floor(S.width*r)+i*2),h.height=Math.max(1,Math.floor(S.height*r)+i*2);const e=h.getContext("2d");if(!e){URL.revokeObjectURL(w);return}const V=getComputedStyle(document.body).getPropertyValue("--color-surface").trim()||"#ffffff";e.fillStyle=V,e.fillRect(0,0,h.width,h.height),e.imageSmoothingEnabled=!0,e.drawImage(M,i,i,Math.floor(S.width*r),Math.floor(S.height*r));const y=(t.project.properties.projectName||"Projekt")+" – "+(t.activeFloorId||"Etage"),b=new Image;b.onload=()=>{const g=Math.floor(28*r),D=Math.floor(14*r);e.font=`${D}px Segoe UI, Arial, sans-serif`;const I=Math.ceil(e.measureText(y).width),f=g+Math.floor(12*r)+I+Math.floor(12*r),m=Math.max(g,Math.floor(30*r)),l=i+6,a=i+6,B=document.body.getAttribute("data-theme")==="dark",_=B?"rgba(38,22,56,0.78)":"rgba(255,255,255,0.88)",N=B?"rgba(230,225,239,0.12)":"rgba(0,0,0,0.08)",x=Math.floor(8*r);e.shadowColor="rgba(0,0,0,0.12)",e.shadowBlur=Math.floor(8*r),e.shadowOffsetX=Math.floor(2*r),e.shadowOffsetY=Math.floor(2*r),e.lineWidth=Math.max(1,Math.floor(r*.75)),e.beginPath(),e.moveTo(l+x,a),e.arcTo(l+f,a,l+f,a+m,x),e.arcTo(l+f,a+m,l,a+m,x),e.arcTo(l,a+m,l,a,x),e.arcTo(l,a,l+f,a,x),e.closePath(),e.fillStyle=_,e.fill(),e.shadowColor="transparent",e.strokeStyle=N,e.stroke();const H=a+Math.floor((m-g)/2);e.drawImage(b,l+Math.floor(8*r),H,g,g),e.textBaseline="middle",e.fillStyle=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333",e.strokeStyle=B?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.85)",e.lineWidth=Math.max(2,r);const L=l+Math.floor(8*r)+g+Math.floor(12*r),C=a+Math.floor(m/2);e.strokeText(y,L,C),e.fillText(y,L,C),URL.revokeObjectURL(w);const E=document.createElement("a"),O=t.activeLanguage==="de"?"etage":"floor",A=t.activeFloorId||"screenshot";E.download=`${O}-${A}.png`,E.href=h.toDataURL("image/png"),E.click()},b.onerror=()=>{const g=Math.floor(14*r);e.font=`${g}px Segoe UI, Arial, sans-serif`,e.fillStyle=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333",e.strokeStyle="rgba(255,255,255,0.8)",e.lineWidth=Math.max(2,r),e.strokeText(y,i+8,i+24*r),e.fillText(y,i+8,i+24*r),URL.revokeObjectURL(w);const D=document.createElement("a"),I=t.activeLanguage==="de"?"etage":"floor",f=t.activeFloorId||"screenshot";D.download=`${I}-${f}.png`,D.href=h.toDataURL("image/png"),D.click()},b.src="/assets/logo_transparent.png"},M.src=w};o||(document.getElementById("floor3DCloseBtn")?.addEventListener("click",z),document.getElementById("floor3DMinimizeBtn")?.addEventListener("click",j),document.getElementById("floor3DMaximizeBtn")?.addEventListener("click",R)),document.getElementById("floor3DScreenshotBtn")?.addEventListener("click",F);const k=document.getElementById("floor3DTitle");k&&(k.textContent=`${p("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}`)}function te(){const o=document.getElementById("floor3DSelect");if(!o)return;const c=X();o.innerHTML="",c.forEach(n=>{const d=document.createElement("option");d.value=n,d.textContent=n,o.appendChild(d)}),o.value=t.activeFloorId||c[0]||"",o.onchange=()=>{t.activeFloorId=o.value,W(),Y(t.project,"floor3DRenderer");const n=document.getElementById("floor3DTitle");n&&(n.textContent=`${p("threeD_fullscreen_title")}: ${t.project.properties.projectName||""} – ${t.activeFloorId||""}`)}}export{Z as do3DDrag,Q as handle3DZoom,ee as setup3DViewControls,J as start3DDrag,K as stop3DDrag,te as update3DFloorSelector,T as update3DGroupTransform};

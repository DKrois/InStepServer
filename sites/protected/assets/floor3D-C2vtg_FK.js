import{s as d,b as ot,c as z}from"./index-D2oOUytM.js";const H=150,T=50,j=4;function st(S,x,m,e,i,F){const C="http://www.w3.org/2000/svg",b=S.slice(0,S.length-1),c=S.map(t=>`${t[0]+T},${t[1]+H}`).join(" "),u=document.createElementNS(C,"polygon");u.setAttribute("points",c),u.setAttribute("fill",F),u.setAttribute("stroke",m),u.setAttribute("stroke-width",String(j)),x.appendChild(u);const A=[];for(let t=0;t<b.length;t++){const n=b[t],w=b[(t+1)%b.length],k=[n[0]+T,n[1]+H],h=[w[0]+T,w[1]+H],g=[n,w,h,k].map(E=>E.join(",")).join(" "),D=(n[1]+w[1])/2<3e3;A.push({wallPoints:g,isBackWall:D})}A.sort((t,n)=>t.isBackWall===n.isBackWall?0:t.isBackWall?-1:1),A.forEach(({wallPoints:t})=>{const n=document.createElementNS(C,"polygon");n.setAttribute("points",t),n.setAttribute("fill",i),n.setAttribute("stroke",m),n.setAttribute("stroke-width",String(j)),x.appendChild(n)});const r=S.map(t=>t.join(",")).join(" "),p=document.createElementNS(C,"polygon");p.setAttribute("points",r),p.setAttribute("fill",e),p.setAttribute("stroke",m),p.setAttribute("stroke-width",String(j)),x.appendChild(p)}function lt(S,x){const m=document.getElementById(x);if(!m){console.error(`Container mit der ID "${x}" nicht gefunden.`);return}m.innerHTML="";const e="http://www.w3.org/2000/svg",i=document.createElementNS(e,"svg");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("viewBox","-500 -500 4000 4000");const F=getComputedStyle(document.body).getPropertyValue("--color-surface").trim()||"#ffffff",C=getComputedStyle(document.body).getPropertyValue("--color-secondary").trim()||"#f6ebfc",b=document.createElementNS(e,"defs"),c=document.createElementNS(e,"linearGradient");c.id="bgGrad",c.setAttribute("x1","0"),c.setAttribute("y1","0"),c.setAttribute("x2","0"),c.setAttribute("y2","1");const u=document.createElementNS(e,"stop");u.setAttribute("offset","0%"),u.setAttribute("stop-color",C);const A=document.createElementNS(e,"stop");A.setAttribute("offset","100%"),A.setAttribute("stop-color",F),c.appendChild(u),c.appendChild(A);const r=document.createElementNS(e,"filter");r.id="softShadow",r.setAttribute("x","-20%"),r.setAttribute("y","-20%"),r.setAttribute("width","140%"),r.setAttribute("height","140%");const p=document.createElementNS(e,"feGaussianBlur");p.setAttribute("in","SourceAlpha"),p.setAttribute("stdDeviation","6");const t=document.createElementNS(e,"feOffset");t.setAttribute("dx","6"),t.setAttribute("dy","6"),t.setAttribute("result","offsetblur");const n=document.createElementNS(e,"feMerge"),w=document.createElementNS(e,"feMergeNode"),k=document.createElementNS(e,"feMergeNode");k.setAttribute("in","SourceGraphic"),n.appendChild(w),n.appendChild(k),r.appendChild(p),r.appendChild(t),r.appendChild(n),b.appendChild(c),b.appendChild(r),i.appendChild(b);const h=document.createElementNS(e,"rect");h.setAttribute("x","-500"),h.setAttribute("y","-500"),h.setAttribute("width","4000"),h.setAttribute("height","4000"),h.setAttribute("fill","url(#bgGrad)"),i.appendChild(h);const g=document.createElementNS(e,"g");g.id="interactive-3d-group",g.setAttribute("transform",`translate(${d.threeDPan.x}, ${d.threeDPan.y}) scale(${d.threeDScale})`),g.setAttribute("filter","url(#softShadow)"),i.appendChild(g);const D=ot(),E=S.features.filter(s=>s.properties.floor===d.activeFloorId&&s.geometry.type==="Polygon"&&!s.properties.isPlaceholder);if(E.length===0){m.appendChild(i);return}let P=1/0,M=1/0,G=-1/0,B=-1/0;E.forEach(s=>{const o=z(s.geometry);P=Math.min(P,o.x),M=Math.min(M,o.y),G=Math.max(G,o.x+o.width),B=Math.max(B,o.y+o.height)});const L=Math.max(1,G-P),X=Math.max(1,B-M),R=Math.max(.2,Math.min(3,Math.min(3600/L,3600/X))),V=1500,O=1500,K=P+L/2,q=M+X/2,J=V-K,Q=O-q;d.threeDPan={x:J,y:Q},d.threeDScale=R,g.setAttribute("transform",`translate(${d.threeDPan.x}, ${d.threeDPan.y}) scale(${d.threeDScale})`);const N=document.createElementNS(e,"g");N.setAttribute("transform","translate(0, 0)");function _(s,o){const l=s.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(l){const $=parseInt(l[1],10),v=parseInt(l[2],10),I=parseInt(l[3],10);return`rgba(${$}, ${v}, ${I}, ${o})`}const f=s.trim();if(/^#([\da-f]{6})$/i.test(f)){const $=parseInt(f.slice(1,3),16),v=parseInt(f.slice(3,5),16),I=parseInt(f.slice(5,7),16);return`rgba(${$}, ${v}, ${I}, ${o})`}return`rgba(0,0,0,${o})`}E.forEach(s=>{const o=s.geometry,l=D[s.properties.subType]||D.default,f=l.stroke||"#54176e",$=l.fill?_(l.fill,.45):"rgba(53,138,216,0.35)",v=_(f,.25),I=_(f,.12);st(o.coordinates[0],N,f,$,v,I);const W=document.createElementNS(e,"polygon"),U=o.coordinates[0].map(y=>`${y[0]+T+15},${y[1]+H+15}`).join(" ");W.setAttribute("points",U),W.setAttribute("fill","rgba(0,0,0,0.06)"),W.setAttribute("stroke","none"),N.appendChild(W);const Y=s.properties.label;if(Y){const y=z(o),Z=y.x+y.width/2,tt=y.y+y.height/2,a=document.createElementNS(e,"text");a.setAttribute("x",String(Z)),a.setAttribute("y",String(tt)),a.setAttribute("text-anchor","middle"),a.setAttribute("dominant-baseline","middle");const et=getComputedStyle(document.body).getPropertyValue("--color-text").trim()||"#333333";a.setAttribute("fill",et),a.setAttribute("stroke",d.activeTheme==="dark"?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.7)"),a.setAttribute("stroke-width","1.5");const nt=l.fontSize?Math.max(12,l.fontSize*2):24;a.setAttribute("style",`font-weight:bold; font-size:${nt}px;`),a.textContent=Y,N.appendChild(a)}}),g.appendChild(N),m.appendChild(i)}export{lt as render3DFloorStack};
